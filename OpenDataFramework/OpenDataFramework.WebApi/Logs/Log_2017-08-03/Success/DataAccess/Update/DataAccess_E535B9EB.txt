Request:
                         Url:http://localhost/op/api/DataAccess/Update?_rCtzxQKJczD=0.22440023393425523
                        Data:{"EntityName":"资源","Request":{"Data":[{"DataId":"d76334de-553c-4cb4-8f71-913691994629","RowVersion":"0,0,0,0,0,1,174,6","类型":"js","名称":"index","内容":"\"use strict\";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!e||\"object\"!=typeof e&&\"function\"!=typeof e?t:e}function _inherits(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),$ns={utils:{},actions:{},api:{},data:{},layouts:{},controls:{},components:{},pages:{}};window.OpenDataFramework=$ns,function(t){t.utils.Common=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:\"CreateGuid\",value:function(){for(var t=\"\",e=1;e<=32;e++){t+=Math.floor(16*Math.random()).toString(16),8!==e&&12!==e&&16!==e&&20!==e||(t+=\"-\")}return t}},{key:\"IsNullOrEmpty\",value:function(t){return null===t||void 0===t||\"\"===e.Trim(t.toString())}},{key:\"Trim\",value:function(t){return void 0===t||null===t?\"\":t.toString().replace(/(^\\s*)|(\\s*$)/g,\"\").replace(new RegExp(\"(^　*)|(　*$)\",\"g\"),\"\")}},{key:\"AddUrlRandom\",value:function(t){if(e.IsNullOrEmpty(t))return\"\";var n=e.GetRandomChars(),i=Math.random();return t+=t.indexOf(\"?\")>0?\"&\":\"?\",t+=\"_r\"+n+\"=\"+i}},{key:\"GetRandomChars\",value:function(t){t=t||10;for(var e=\"ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz\",n=[],i=0;i<t;i++)n.push(e.charAt(Math.floor(Math.random()*e.length)));return n.join(\"\")}},{key:\"InitValue\",value:function(t,e,n){e.forEach(function(e){t[e]=void 0===t[e]?n:t[e]})}},{key:\"Alert\",value:function(e){return new t.components.AlertConfirm({Message:e}).Show()}},{key:\"Confirm\",value:function(e){return new t.components.AlertConfirm({Message:e,IsConfirm:!0}).Show()}},{key:\"ArrayFirst\",value:function(t){return t&&t.length>0?t[0]:null}},{key:\"IsEquals\",value:function(t,n,i){if(void 0===t&&void 0===n)return!0;if(null===t&&null===n)return!0;var s=e.IsNullOrEmpty(t)?\"\":t.toString(),a=e.IsNullOrEmpty(n)?\"\":n.toString();return i?s.toLowerCase()===a.toLowerCase():s===a}},{key:\"GetQueryString\",value:function(t){var e={};t=t||location.search.substring(1);for(var n=t.split(\"&\"),i=0;i<n.length;i++){var s=n[i].indexOf(\"=\");if(-1!==s){var a=n[i].substring(0,s),o=n[i].substring(s+1);e[a]=unescape(o)}}return e}},{key:\"SetStorage\",value:function(t,e,n){try{if(n=n||0,localStorage.setItem(t,e),n>0){t+=\"_Time\";var i=((new Date).getTime()+60*n*1e3).toString()+\"_\"+n.toString();localStorage.setItem(t,i)}}catch(t){}}},{key:\"GetStorage\",value:function(t){var n=\"\";try{n=localStorage.getItem(t);var i=t+\"_Time\",s=localStorage.getItem(i);if(!e.IsNullOrEmpty(s)){var a=s.split(\"_\"),o=parseFloat(a[0]),r=parseFloat(a[1]);if(o>0){(new Date).getTime()>o?(n=\"\",localStorage.removeItem(t),localStorage.removeItem(i)):(o=((new Date).getTime()+60*r*1e3).toString()+\"_\"+r.toString(),localStorage.setItem(i,o))}}}catch(t){}return e.IsNullOrEmpty(n)?\"\":n}},{key:\"ClearStorage\",value:function(){localStorage.clear()}},{key:\"Split\",value:function(t,n){if(e.IsNullOrEmpty(t))return[];t=e.RemoveWhiteEnter(t);var i=[],s=[t];return n.forEach(function(t){i=s,s=[],i.forEach(function(e){s=s.concat(e.split(t))})}),s}},{key:\"GetZIndex\",value:function(){return e.ZIndex=e.ZIndex||1e3,e.ZIndex+=1,e.ZIndex}},{key:\"ComputeStringWidth\",value:function(t){if(e.IsNullOrEmpty(t))return 0;for(var n=0,i=-1,s=0;s<t.length;s++)i=t.charCodeAt(s),n+=i>=0&&i<=128?1:2;return 6*n}},{key:\"GetNumberValue\",value:function(t){if(e.IsNullOrEmpty(t))return 0;t=t.toString().replace(/,/g,\"\"),t=t.replace(/M/g,\"\");var n=parseFloat(t);return isNaN(n)?0:n}},{key:\"GetBoolValue\",value:function(t){if(e.IsNullOrEmpty(t))return!1;var n=t.toString().toLowerCase();return\"true\"===n||\"1\"===n}},{key:\"GetObjectValue\",value:function(t,n,i){var s={};n&&n.length>0&&n.forEach(function(n){e.IsNullOrEmpty(t[n])||(s[n]=e.GetNumberValue(t[n]))}),i&&i.length>0&&i.forEach(function(n){return s[n]=e.GetBoolValue(t[n])});for(var a in t)void 0===s[a]&&(s[a]=t[a]);return s}},{key:\"RemoveWhiteEnter\",value:function(t){for(t=t.replace(/\\n/g,\"\");t.indexOf(\"  \")>=0;)t=t.replace(/  /g,\" \");return e.Trim(t)}}]),e}()}($ns),function(t){var n=t.utils.Common;t.utils.HtmlTag=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:\"GetById\",value:function(t){return document.getElementById(t)}},{key:\"SetHtml\",value:function(t,e){t&&void 0!==e&&(t.innerHTML=e)}},{key:\"BindEvent\",value:function(e,n,i,s){if(e){var a=n.split(\".\"),o=\"\";2===a.length?(n=a[0],o=a[1]):o=n,void 0===e[\"Event_\"+n]&&(e[\"Event_\"+n]={EventAction:function(t){r.EventList.forEach(function(e){return e.Action(t)})},EventList:[]});var r=e[\"Event_\"+n];if(s)if(1===r.EventList.length)t.RemoveEvent(e,n,r.EventAction),r.EventList=[];else{for(var l=-1,u=0;u<r.EventList.length;u++)if(r.EventList[u].Name===o){l=u;break}l>=0&&r.EventList.splice(l,1)}else{0===r.EventList.filter(function(t){return t.Name===o}).length&&r.EventList.push({Name:o,Action:i}),1===r.EventList.length&&t.AddEvent(e,n,r.EventAction)}}}},{key:\"OffBindEvent\",value:function(e,n){t.BindEvent(e,n,null,!0)}},{key:\"AddEvent\",value:function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent(\"on\"+e,n):t[\"on\"+e]=n}},{key:\"RemoveEvent\",value:function(t,e,n){t.detachEvent?t.detachEvent(\"on\"+e,n):t.removeEventListener?t.removeEventListener(e,n,!1):t[\"on\"+e]=null}},{key:\"GetElement\",value:function(e){return\"string\"==typeof e?t.GetById(e):e}},{key:\"GetValue\",value:function(e){return e=t.GetElement(e),e&&e.value?e.value:\"\"}},{key:\"SetValue\",value:function(e,n){(e=t.GetElement(e))&&(e.value=n)}},{key:\"SetDisabled\",value:function(e,n){(e=t.GetElement(e))&&(e.disabled=n)}},{key:\"GetDisabled\",value:function(e){return!!(e=t.GetElement(e))&&e.disabled}},{key:\"Find\",value:function(n,i){if(!n||!i||!n.hasChildNodes())return null;var s=i.split(\">\"),a=s[0];s.splice(0,1);for(var o=[],r=null,l=0;l<n.childNodes.length;l++)r=n.childNodes[l],r.nodeName.toLowerCase()===a.toLowerCase()&&o.push(r);if(s.length>0){i=s.join(\">\");var u=[],h=null;return o.forEach(function(n){null!=(h=t.Find(e,i))&&(u=u.concat(h))}),u}return o}},{key:\"AppendHtml\",value:function(e,n){var i=document.createElement(\"div\");for(t.SetHtml(i,n);i.childNodes.length>0;)e.appendChild(i.childNodes[0])}},{key:\"GetElementsByTagName\",value:function(t,e){return t&&t.getElementsByTagName(e)}},{key:\"SetHide\",value:function(t){t&&t.style&&(t.style.display=\"none\")}},{key:\"SetShow\",value:function(t){t&&t.style&&(t.style.display=\"\")}},{key:\"GetBodyWidth\",value:function(){return document.body.offsetWidth}},{key:\"GetBodyHeight\",value:function(){return document.body.offsetHeight}},{key:\"GetWindowWidth\",value:function(){return window.innerWidth}},{key:\"GetWindowHeight\",value:function(){return window.innerHeight}},{key:\"GetWidth\",value:function(e){return e&&e.style?\"\"===e.style.width?null!==e.parentNode?t.GetWidth(e.parentNode):t.GetBodyWidth():e.style.width.indexOf(\"%\")>0?t.GetWidth(e.parentNode)*parseFloat(e.style.width)/100:parseFloat(e.style.width):e.body?t.GetBodyWidth():0}},{key:\"SetWidth\",value:function(t,e){if(t&&t.style){var n=parseFloat(e);isNaN(n)||(t.style.width=n.toString()+\"px\")}}},{key:\"GetHeight\",value:function(e){return e&&e.style?\"\"===e.style.height?null!==e.parentNode?t.GetHeight(e.parentNode):t.GetBodyHeight():e.style.height.indexOf(\"%\")>0?t.GetHeight(e.parentNode)*parseFloat(e.style.height)/100:parseFloat(e.style.height):e.body?t.GetBodyHeight():0}},{key:\"SetHeight\",value:function(t,e){if(t&&t.style){var n=parseFloat(e);isNaN(n)||(t.style.height=n.toString()+\"px\")}}},{key:\"SetStyle\",value:function(t,e){if(t&&t.style&&e)for(var n in e)t.style[n]=e[n]}},{key:\"SetStyleValue\",value:function(t,e,n){t&&t.style&&(t.style[e]=n)}},{key:\"RemoveClass\",value:function(t,e){t&&void 0!==t.className&&(t.className=n.Trim(t.className.replace(new RegExp(e,\"g\"),\"\").replace(new RegExp(\"  \",\"g\"),\"\")))}},{key:\"AddClass\",value:function(t,e){if(t&&void 0!==t.className){var i=n.Trim(t.className).replace(new RegExp(e,\"g\"),\"\").replace(new RegExp(\"  \",\"g\"),\"\");i=i+\" \"+e,t.className=n.Trim(i)}}},{key:\"RemoveElement\",value:function(t,e){if(t&&e&&t.removeChild&&t.hasChildNodes)if(t.contains)t.contains(e)&&t.removeChild(e);else{for(var n=!1,i=0;i<t.childNodes.length;i++)if(t.childNodes[i]===e){n=!0;break}n&&t.removeChild(e)}}},{key:\"GetOffSet\",value:function(e){if(e){var n=t.GetTopLeft(e.parentNode);return{top:e.offsetTop+n.top,left:e.offsetLeft+n.left,width:e.offsetWidth,height:e.offsetHeight}}return null}},{key:\"GetTopLeft\",value:function(e,n){return n=n||{top:0,left:0},e&&\"absolute\"===t.GetStyleValue(e,\"position\")?n={top:n.top+parseFloat(e.style.top),left:n.left+parseFloat(e.style.left)}:e&&e!==document.body?t.GetTopLeft(e.parentNode,n):n}},{key:\"GetStyleValue\",value:function(e,n){if(!e)return\"\";if(e.style&&e.style[n])return e.style[n];var i=t.GetStyles(e);return i&&i[n]?i[n]:\"\"}},{key:\"ComputeStringWidth\",value:function(e){if(n.IsNullOrEmpty(e))return 0;t.SpanId=t.SpanId||n.CreateGuid();var i=t.GetById(t.SpanId);null===i&&(i=document.createElement(\"span\"),i.id=t.SpanId,i.style.visibility=\"hidden\",document.body.appendChild(i)),i.innerHTML=\"\";var s=i.offsetWidth;return i.innerHTML=e,s=i.offsetWidth-s,i.innerHTML=\"\",s}},{key:\"GetStyles\",value:function(t){return t?t.ownerDocument?t.ownerDocument.defaultView.getComputedStyle(t):t.currentStyle?t.currentStyle:null:null}}]),t}()}($ns),function(t){var e=t.utils.Common;t.api.Index=function(){function t(n){_classCallCheck(this,t),this.Id=e.CreateGuid(),n&&Object.assign(this,n)}return _createClass(t,[{key:\"PostFetch\",value:function(t,e){var n=this;return fetch(this.GetFullUrl(t),{method:\"POST\",body:JSON.stringify(e)}).then(function(t){return n.SetResult(t).then(function(t){return n.GetResponse(t)})})}},{key:\"PostStreamFetch\",value:function(t,n){var i=this;return fetch(e.AddUrlRandom(t),{method:\"POST\",headers:{\"Content-Type\":\"application/octet-stream\"},body:n}).then(function(t){return i.SetResult(t).then(function(t){return i.GetResponse(t)})})}},{key:\"GetResponse\",value:function(t){if(t&&t.Ack){if(t.Ack.IsSuccess)return Promise.resolve(t.Data);if(t.Ack.StatusMessage)return Promise.reject(t.Ack.StatusMessage)}return Promise.reject(\"请求异常！\")}},{key:\"SetResult\",value:function(t){return t.ok?t.json():Promise.reject(t.status+\":\"+(t.statusText?t.statusText:\"请求错误！\"))}},{key:\"GetFullUrl\",value:function(t){return t=this.GetRootPath()+t,e.AddUrlRandom(t)}},{key:\"GetRootPath\",value:function(){return\"api/\"}}]),t}()}($ns),function(t){var e=t.api.Index;t.api.DataAccess=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:\"Request\",value:function(t,e,n){var i={EntityName:e,Request:n};return this.PostFetch(\"DataAccess/\"+t,i)}},{key:\"Query\",value:function(t,e){return this.Request(\"Query\",t,e)}},{key:\"Create\",value:function(t,e){return this.Request(\"Create\",t,e)}},{key:\"Update\",value:function(t,e){return this.Request(\"Update\",t,e)}},{key:\"Delete\",value:function(t,e){return this.Request(\"Delete\",t,e)}}]),e}(e)}($ns),function(t){var e=[],n=[],i={};t.data.Index=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:\"AddStatePool\",value:function(n){t.SetState(n),e.push(n)}},{key:\"SetState\",value:function(t,e){for(var n in t)i[n]=t[n](i[n],e)}},{key:\"GetState\",value:function(){return i}},{key:\"Dispatch\",value:function(s){e.forEach(function(e){return t.SetState(e,s)}),n.forEach(function(t){return t(i)})}},{key:\"Connect\",value:function(t){t(i),n.push(t)}},{key:\"GetStateValue\",value:function(t,e,n,i){if(t[e]){var s=t[e][n];if(i!==s)return Promise.resolve(s)}return Promise.resolve(null)}}]),t}()}($ns),function(t){var e={QueryResponse:null,DeleteResponse:null};t.data.Index.InitListPageEntityState=function(n){var i={};i[n]=function(t,i){if(!i)return e;switch(i.type){case n+\"_Search_Data\":return t.QueryResponse=i.data,t;case n+\"_Delete\":return t.DeleteResponse=i.data,t;default:return t}},t.data.Index.AddStatePool(i)}}($ns),function(t){var e={EditResponse:null};t.data.Index.InitEditPageEntityState=function(n){var i={};i[n]=function(t,i){if(!i)return e;switch(i.type){case n+\"_Create\":case n+\"_Update\":return t.EditResponse=i.data,t;default:return t}},t.data.Index.AddStatePool(i)}}($ns),function(t){var e=t.utils.Common;t.data.Cache=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:\"GetDataList\",value:function(e,i,s,a){var o=n.GetCache(e);return o?Promise.resolve(o):new t.actions.Index(n).GetDataList(i,s,a).then(function(t){return t.IsSuccess?(n.SetCache(e,t.Data.DataList),Promise.resolve(t.Data.DataList)):Promise.resolve(null)})}},{key:\"GetCache\",value:function(t){var n=e.GetStorage(t);return e.IsNullOrEmpty(n)?null:JSON.parse(n)}},{key:\"SetCache\",value:function(t,n){e.SetStorage(t,JSON.stringify(n))}},{key:\"GetPropertyDataList\",value:function(t){if(t.DataSource){var e=t.DataSource,i=e.CacheName,s=e.EntityName,a=e.SelectNames,o=e.Conditions,r=e.TextName,l=e.ValueName;t.ValueName=l,t.TextName=r;var u=i||s,h=o||[];return n.GetDataList(u,s,a,h).then(function(e){return t.DataList=e||[],t.ExpandSetDataList&&(t.DataList=t.ExpandSetDataList(t.DataList)),Promise.resolve()})}}}]),n}()}($ns),function(t){var e=t.utils.Common,n=t.api.DataAccess,i=t.data.Index,s=i.Dispatch,a=i.GetStateValue;t.actions.Index=function(){function t(i){_classCallCheck(this,t),this.Id=e.CreateGuid(),this.EventNames=[\"click\"],this.Target=i,this.Api=new n}return _createClass(t,[{key:\"Invoke\",value:function(t,e){}},{key:\"DispatchAction\",value:function(t){return function(e,n,i){return t().then(function(t){return i&&i(t),e&&e({type:n,data:t}),Promise.resolve({IsSuccess:!0,Data:t})},function(t){var i=t&&t.message?t.message:t;return e&&e({type:n,data:{ActionFailedMessage:i}}),Promise.resolve({IsSuccess:!1,Message:i})})}}},{key:\"Edit\",value:function(t,n){var i=this,a=this.Target,o=a.Entity,r=a.KeyName,l=a.EditDialog,u=this.Target.GetEditData();if(!1!==u){if(this.Target.IsLocalData)return n||(u[this.Target.Entity.PrimaryKey]=e.CreateGuid()),this.Target.SaveData(u),this.Target.ClearControlValue(),void l.Close();t.SetDisabled(!0);var h={Data:[u]},c=n?\"Update\":\"Create\";this.DispatchAction(function(){return i.Api[c](o.Name,h)})(s,r+\"_\"+c).then(function(n){n.IsSuccess?e.Alert(\"操作成功！\").then(function(){i.Target.ClearControlValue(),l.Close()}):e.Alert(n.Message).then(function(){return t.SetDisabled(!1)})})}}},{key:\"GetDataValue\",value:function(t,e,n){var i=this;return a(t,e,n,this[n]).then(function(t){return null!=t&&(i[n]=t),Promise.resolve(null!=t)})}},{key:\"GetDataList\",value:function(t,e,n){var i=this,s={SelectNames:e,Conditions:n};return this.DispatchAction(function(){return i.Api.Query(t,s)})()}},{key:\"GetEntityData\",value:function(t,e,n){var i=this,s={IsRowVersion:!0,SelectNames:e,Conditions:[{Name:t.PrimaryKey,Logic:\"=\",Value:n}]};return t.ComplexQueryList&&t.ComplexQueryList.length>0&&(s.ComplexQueryList=[],t.ComplexQueryList.forEach(function(e){s.ComplexQueryList.push(Object.assign({Conditions:[{Name:t.PrimaryKey,Logic:\"=\",Value:n}]},e))})),this.DispatchAction(function(){return i.Api.Query(t.Name,s)})()}}]),t}()}($ns),function(t){var e=t.actions.Index,n=t.utils,i=n.Common,s=(n.HtmlTag,t.data.Index),a=s.Dispatch,o=s.Connect;t.actions.SearchAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Page=t,n.Label=n.Label||\"查询\",n.PageIndex=n.PageIndex||1,n.ConditionList=n.ConditionList||[],n.InitConditionList=n.InitConditionList||[],n.Init(),n}return _inherits(e,t),_createClass(e,[{key:\"GetConditionList\",value:function(){return this.ConditionList=this.Page.GetSearchCondition(),this.ConditionList}},{key:\"Invoke\",value:function(t,e){this.PageIndex=1,this.Search(t,e,!1)}},{key:\"Search\",value:function(t,e,n,i){var s=this,o=this.Page,r=o.Entity,l=o.SelectNames,u=o.IsPage,h=o.PageSize,c=o.KeyName;n||this.GetConditionList(),r.IsSelectKey&&l.splice(0,0,r.PrimaryKey);var d={IsPage:u,IsRowVersion:!0,PageIndex:this.PageIndex,PageSize:h,SelectNames:l,Conditions:this.ConditionList,OrderBys:this.Page.GetOrderByList()};this.DispatchAction(function(){return s.Api.Query(r.Name,d)})(a,c+\"_Search_Data\",function(t){i&&(t.Ids=i)}).then(function(t){t.IsSuccess&&t.Data.PageRecord>=0&&(s.PageRecord=t.Data.PageRecord)})}},{key:\"Init\",value:function(){var t=this,e=this.Page.Entity;o(function(n){var i=\"EditPage_\"+e.Id;t.GetDataValue(n,i,\"EditResponse\").then(function(e){e&&t.SetEditResponse()}),t.GetDataValue(n,t.Page.KeyName,\"DeleteResponse\").then(function(e){e&&t.SetDeleteResponse()})})}},{key:\"SetEditResponse\",value:function(){var t=this.EditResponse;null!=t&&t.Ids&&(\"Create\"===t.RequestType&&this.InsertRefresh(),this.Search(null,null,!0,t.Ids))}},{key:\"InsertRefresh\",value:function(){this.Page.SetInitConditionList(this.InitConditionList),this.ConditionList=this.InitConditionList.map(function(t){return t})}},{key:\"ExcelRefresh\",value:function(){this.InsertRefresh(),this.Search(null,null,!0)}},{key:\"SetDeleteResponse\",value:function(){var t=this.DeleteResponse;null!=t&&t.IsDelete&&(1===t.RowCount&&this.PageIndex>1&&(this.PageIndex-=1),this.Search(null,null,!0))}}]),e}(e),t.actions.NewAddAction=function(e){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.Page=t,e.Label=e.Label||\"新增\",e}return _inherits(n,e),_createClass(n,[{key:\"Invoke\",value:function(e,n){new t.pages.EditPage({Entity:this.Page.Entity}).Load()}}]),n}(e),t.actions.EditAction=function(e){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.DataGrid=t,e.Label=e.Label||\"修改\",e}return _inherits(n,e),_createClass(n,[{key:\"Invoke\",value:function(e,n){var i=this;new t.pages.EditPage({Entity:this.DataGrid.Entity,IsLocalData:this.DataGrid.IsLocalData,SaveData:function(t){return i.DataGrid.SaveData(t)},RowData:n.RowData,IsUpdate:!0}).Load()}}]),n}(e),t.actions.DeleteAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.DataGrid=t,n.Label=n.Label||\"删除\",n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){var n=this;if(this.DataGrid.IsLocalData)return void this.DataGrid.DeleteData(e.RowData[this.DataGrid.Entity.PrimaryKey]);i.Confirm(\"确认要删除吗？\").then(function(){var t=n.DataGrid,s=t.Entity,o=t.RowCount,r=t.KeyName,l={};l[s.PrimaryKey]=e.RowData[s.PrimaryKey],l.RowVersion=e.RowData.RowVersion;var u={Data:[l]};n.DispatchAction(function(){return n.Api.Delete(s.Name,u)})(a,r+\"_Delete\",function(t){return t.RowCount=o}).then(function(t){t.IsSuccess||i.Alert(t.Message)})})}}]),e}(e),t.actions.PagingAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.DataPaging=t,n.SearchAction=n.DataPaging.SearchAction,n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){this.SearchAction.PageIndex=this.GetPageIndex(),this.SearchAction.Search(t,e,!0)}},{key:\"GetPageIndex\",value:function(){var t=this.SearchAction.PageIndex;switch(this.Type){case\"First\":return 1;case\"Pre\":return t-1;case\"Next\":return t+1;case\"Last\":return this.DataPaging.PageCount;default:this.pageIndex}}}]),e}(e),t.actions.PagingFirstAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=\"<<\",n.Title=\"首页\",n.Type=\"First\",n}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingPreAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=\"<\",n.Title=\"上页\",n.Type=\"Pre\",n}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingNextAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=\">\",n.Title=\"下页\",n.Type=\"Next\",n}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingLastAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=\">>\",n.Title=\"尾页\",n.Type=\"Last\",n}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingIndexQueryAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=\"确定\",n.DataPaging=t,n.SearchAction=n.DataPaging.SearchAction,n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){var n=this.DataPaging.GetInputPageIndex();!1!==n&&(this.SearchAction.PageIndex=n,this.SearchAction.Search(t,e,!0))}}]),e}(e),t.actions.ExcelExportAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=\"Excel导出\",n.Width=80,n.Page=t,n.SearchAction=t.SearchActions[0],n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){var n=this;if(this.SearchAction.PageRecord>5e4)return void i.Alert(\"对不起，您要导出的数据量超过5万条，请先进行相应的数据筛选！\");i.Confirm(\"确定将数据Excel导出吗？\").then(function(){return n.ExcelExport(e)})}},{key:\"ExcelExport\",value:function(t){var e=this;t.SetDisabled(!0);var n=this.Page,s=n.Entity,a=n.SelectNames,o={IsExcel:!0,Title:s.Label,SelectNames:a,Conditions:this.SearchAction.ConditionList,OrderBys:this.Page.GetOrderByList(),HeaderInfos:this.Page.GetHeaderInfoList()};this.DispatchAction(function(){return e.Api.Query(s.Name,o)})().then(function(n){t.SetDisabled(!1),n.IsSuccess&&n.Data.FileName?e.DownLoad(n.Data.FileName):n.Message&&i.Alert(n.Message)})}},{key:\"DownLoad\",value:function(t){var e=\"download.aspx?fn=\"+t;window.open(e,\"_self\")}}]),e}(e),t.actions.ExcelImportAction=function(e){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.Label=\"Excel导入\",e.Width=80,e.Page=t,e.SearchAction=t.SearchActions[0],e}return _inherits(n,e),_createClass(n,[{key:\"Invoke\",value:function(e,n){new t.components.ExcelImport({Entity:this.Page.Entity,SearchAction:this.SearchAction,Api:this.Api}).Import()}}]),n}(e),t.actions.ChangePasswordAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=\"修改密码\",n.Page=t,n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){}}]),e}(e)}($ns),function(t){var e=t.actions.Index;t.actions.DialogOkAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Dialog=t,n.Label=n.Label||\"确定\",n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){this.Dialog.OkAction&&this.Dialog.OkAction.Invoke(t,e)}}]),e}(e),t.actions.DialogCancelAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Dialog=t,n.Label=n.Label||\"取消\",n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){this.Dialog.Close()}}]),e}(e)}($ns),function(t){var e=t.actions.Index;t.utils.Common;t.actions.CreateAction=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Page=t,n}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){this.Edit(e)}}]),e}(e),t.actions.UpdateAction=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:\"Invoke\",value:function(t,e){this.Edit(e,!0)}}]),e}(e),t.actions.GridViewAddAction=function(e){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.Label=\"添加\",e.GridView=t,e}return _inherits(n,e),_createClass(n,[{key:\"Invoke\",value:function(e,n){var i=this;new t.pages.EditPage({Entity:this.GridView.Entity,IsLocalData:!0,SaveData:function(t){return i.GridView.SaveData(t)}}).Load()}}]),n}(e)}($ns),function(t){var e=t.utils,n=e.Common,i=e.HtmlTag;t.controls.Index=function(){function e(t){_classCallCheck(this,e),this.Id=n.CreateGuid(),this.Attributes=[],t&&Object.assign(this,t),this.Height=this.Height||30}return _createClass(e,[{key:\"GetHtml\",value:function(){return\"\"}},{key:\"EventLoad2\",value:function(){}},{key:\"DataLoad2\",value:function(){}},{key:\"EventLoad\",value:function(){this.Element=i.GetById(this.Id),this.EventLoad2()}},{key:\"GetRowClassName\",value:function(){return\"\"}},{key:\"DataLoad\",value:function(){this.DataLoad2()}},{key:\"GetAttributeHtml\",value:function(){var t=this;return this.Attributes.map(function(e){return t.GetAttributeItem(e)}).join(\"\")}},{key:\"GetAttributeItem\",value:function(t){return\" \"+t.Name+'=\"'+t.Value+'\"'}},{key:\"SetAttribute\",value:function(t,e){this.Attributes.push({Name:t,Value:e})}},{key:\"GetInputHtml\",value:function(t){var e=[];return e.push('<input id=\"'+this.Id+'\" type=\"'+t+'\"'),e.push(this.GetAttributeHtml()),e.push(\"/>\"),e.join(\"\")}},{key:\"GetValue\",value:function(){if(\"CheckBox\"===this.ControlType)return this.GetCheckBoxValue();var t=i.GetValue(this.Element);return this.Value=n.IsNullOrEmpty(t)?\"\":n.Trim(t),this.Value}},{key:\"SetValue\",value:function(t){if(\"CheckBox\"===this.ControlType)return void this.SetCheckBoxValue(t);t=void 0===t?\"\":t,this.Value=t,i.SetValue(this.Element,t)}},{key:\"SetDisabled\",value:function(t){i.SetDisabled(this.Element,t)}},{key:\"GetDisabled\",value:function(){return i.GetDisabled(this.Element)}},{key:\"GetStyle\",value:function(t){return 0===t.length?\"\":' style=\"'+t.join(\"\")+'\"'}},{key:\"GetClass\",value:function(){return this.ClassName?\" class=\"+this.ClassName:\"\"}},{key:\"GetDataList\",value:function(){return t.data.Cache.GetPropertyDataList(this)}}]),e}()}($ns),function(t){var e=t.controls.Index,n=t.utils,i=n.Common,s=n.HtmlTag;t.controls.SpanLabel=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.LabelWidth&&(n.Width=n.LabelWidth),n.Width=n.Width||100,i.InitValue(n,[\"IsColon\",\"IsWidth\"],!0),n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){if(!this.Label||\"CheckBox\"===this.ControlType||\"GridView\"===this.ControlType)return this.Width=0,\"\";var t=this.IsColon?\"：\":\"\",e=[];this.IsWidth&&e.push(\"width:\"+this.Width+\"px;\");var n=this.GetStyle(e),i=this.GetClass();return'<span id=\"'+this.Id+'\"'+n+i+\">\"+this.Label+t+\"</span>\"}},{key:\"SetValue\",value:function(t){s.SetHtml(this.Element,t)}}]),e}(e),t.controls.DataSpan=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){return this.Value=i.IsNullOrEmpty(this.Value)?\"\":this.Value,this.IsLabel||this.SetValue(),'<span id=\"'+this.Id+'\" style=\"padding:1px 2px 1px 2px;\">'+this.Value+\"</span>\"}},{key:\"SetValue\",value:function(){if(this.Options&&this.Options.length>0?this.SetValuText(this.Options,\"Value\",\"Text\"):this.DataList&&this.DataList.length>0&&this.SetValuText(this.DataList,this.ValueName,this.TextName),\"CheckBox\"===this.ControlType){this.CheckedText=void 0===this.CheckedText?\"是\":this.CheckedText,this.UnCheckedText=void 0===this.UnCheckedText?\"否\":this.UnCheckedText;var t=void 0===this.CheckedValue||this.CheckedValue;this.Value=i.IsEquals(this.Value,t,!0)?this.CheckedText:this.UnCheckedText}}},{key:\"SetValuText\",value:function(t,e,n,a){var o=this,r=t.filter(function(t){return void 0!==t[e]&&i.IsEquals(t[e],o.Value)});r.length>0&&(this.Value=r[0][n],a&&s.SetHtml(this.Element,this.Value))}},{key:\"DataLoad2\",value:function(){var t=this;!this.DataList&&this.DataSource&&this.GetDataList().then(function(){return t.SetValuText(t>DataList,t.ValueName,t.TextName,!0)})}}]),e}(e)}($ns),function(t){var e=t.controls.Index,n=t.utils,i=n.Common,s=n.HtmlTag;t.controls.TextBox=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.ControlWidth&&(n.Width=n.ControlWidth),n.Width=n.Width||200,n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){this.SetAttribute(\"name\",this.Name),this.MaxLength>0&&this.SetAttribute(\"maxlength\",this.MaxLength),this.IsInput()&&this.SetAttribute(\"autocomplete\",\"off\"),this.ClassName&&this.SetAttribute(\"class\",this.ClassName),this.PlaceHolder&&this.SetAttribute(\"placeholder\",this.PlaceHolder),this.Checked&&this.SetAttribute(\"checked\",\"checked\"),this.DefaultValue&&this.SetAttribute(\"value\",this.DefaultValue);var t=[];switch(this.IsInput()&&t.push(\"width:\"+this.Width+\"px;\"),t.length>0&&this.SetAttribute(\"style\",t.join(\"\")),this.ControlType){case\"Password\":return this.GetInputHtml(\"password\");case\"CheckBox\":return this.GetCheckBoxHtml(this.GetInputHtml(\"checkbox\"));case\"TextDate\":return this.GetInputHtml(\"date\");default:return this.GetInputHtml(\"text\")}}},{key:\"GetCheckBoxHtml\",value:function(t){var e=this.Label.replace(\"是否\",\"\");return'<div class=\"DivCheckBox\" style=\"margin-left:'+(this.LabelWidth+5)+'px;\"><label>'+t+\"<span>\"+e+\"</span></label></div>\"}},{key:\"GetCheckBoxValue\",value:function(){var t=void 0===this.CheckedValue||this.CheckedValue,e=void 0!==this.UnCheckedValue&&this.UnCheckedValue;return this.Element.checked?t:e}},{key:\"SetCheckBoxValue\",value:function(t){var e=i.IsNullOrEmpty(t)?\"\":t.toString().toLowerCase(),n=void 0===this.CheckedValue||this.CheckedValue;this.Element.checked=e===n.toString().toLowerCase()}},{key:\"IsInput\",value:function(){return\"CheckBox\"!==this.ControlType&&\"Radio\"!==this.ControlType}},{key:\"EventLoad3\",value:function(){}},{key:\"DataLoad3\",value:function(){}},{key:\"EventLoad2\",value:function(){var t=this;this.EnterControl&&s.BindEvent(this.Element,\"keypress\",function(e){return t.KeypressEnter(e)}),this.EventLoad3()}},{key:\"DataLoad2\",value:function(){this.DataLoad3()}},{key:\"KeypressEnter\",value:function(t){if(this.EnterControl.Element){13==(window.event?t.keyCode:t.which)&&(this.EnterControl.Element.focus(),this.EnterControl.Element.click())}}}]),e}(e)}($ns),function(t){var e=t.controls.Index,n=t.utils.HtmlTag;t.controls.Button=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Width=n.Width||60,n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){this.SetAttribute(\"value\",this.Action.Label),this.Action.Title&&this.SetAttribute(\"title\",this.Action.Title),this.ClassName&&this.SetAttribute(\"class\",this.ClassName);var t=[];return t.push(\"width:\"+this.Width+\"px;\"),this.SetAttribute(\"style\",t.join(\"\")),this.GetInputHtml(\"button\")}},{key:\"EventLoad2\",value:function(){var t=this;this.Action.EventNames.forEach(function(e){n.BindEvent(t.Element,e,function(e){return t.Action.Invoke(e,t)})}),this.Action.IsOkFocus&&this.Element.focus()}}]),e}(e),t.controls.LinkButton=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Label=n.Label||n.Action.Label,n}\nreturn _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){return'<div style=\"text-align:center;\"><a href=\"javascript:void(0);\" id='+this.Id+\">\"+this.Label+\"</a></div>\"}},{key:\"EventLoad2\",value:function(){var t=this;this.Action.EventNames.forEach(function(e){n.BindEvent(t.Element,e,function(e){return t.Action.Invoke(e,t)})})}}]),e}(e)}($ns),function(t){var e=t.controls,n=e.Index,i=e.Button,s=t.utils,a=s.Common;s.HtmlTag;t.controls.GridView=function(e){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.Styles=e.Styles||{DivAddRight:\"DivAddRight\"},e.Entity.Label=e.Entity.Label||e.Entity.Name,e.ControlWidth&&(e.Width=e.ControlWidth),e.Init(),e}return _inherits(n,e),_createClass(n,[{key:\"Init\",value:function(){var e=this;this.Entity.ExpandPageInit&&this.Entity.ExpandPageInit.call(this,t),this.Entity.Properties.forEach(function(t){return e.InitProperty(t)}),this.DataProperties=this.Entity.Properties.filter(function(t){return t.IsData}).map(function(t){return Object.assign({},t,t.DataOptions)}),this.GridViewLayout=new t.layouts.GridView(this.GetGridViewComponents()),this.AddButton=new i({Action:new t.actions.GridViewAddAction(this)}),this.Height+=30}},{key:\"GetRowClassName\",value:function(){return\"DivRowGridView\"}},{key:\"InitProperty\",value:function(t){a.InitValue(t,[\"IsData\"],void 0!==t.DataOptions),a.InitValue(t,[\"IsEdit\"],void 0!==t.EditOptions)}},{key:\"GetHtml\",value:function(){var t=[],e=this.AddButton.GetHtml();return t.push('<div class=\"'+this.Styles.DivAddRight+'\">'+e+\"</div>\"),t.push(this.GridViewLayout.GetHtml()),t.join(\"\")}},{key:\"SaveData\",value:function(t){this.DataGridComponent.SaveData(t)}},{key:\"GetGridViewComponents\",value:function(){return this.DataGridComponent=new t.components.DataGrid({Entity:this.Entity,IsLocalData:!0,Height:this.Height,Properties:this.DataProperties,IsFixedWidth:!0}),{DataGridComponent:this.DataGridComponent}}},{key:\"GetValue\",value:function(){return this.DataGridComponent.GetValue()}},{key:\"SetValue\",value:function(t){this.DataGridComponent.SetValue(t)}},{key:\"EventLoad2\",value:function(){this.DataGridComponent.EventLoad(),this.AddButton.EventLoad()}},{key:\"DataLoad2\",value:function(){this.DataGridComponent.DataLoad(),this.AddButton.DataLoad()}}]),n}(n)}($ns),function(t){var e=t.controls.Index,n=t.utils,i=n.Common,s=n.HtmlTag;t.controls.DownList=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.ControlWidth&&(n.Width=n.ControlWidth),n.Width=n.Width||200,i.InitValue(n,[\"IsEmpty\"],!0),n.ClassName=n.ClassName||\"DownList\",n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){this.SetAttribute(\"name\",this.Name),this.ClassName&&this.SetAttribute(\"class\",this.ClassName);var t=[];t.push(\"width:\"+(this.Width+3)+\"px;\"),t.length>0&&this.SetAttribute(\"style\",t.join(\"\"));var e=[];return e.push('<select id=\"'+this.Id+'\"'),e.push(this.GetAttributeHtml()),e.push(\">\"),e.push(this.GetOptionsHtml()),e.push(\"<select>\"),e.join(\"\")}},{key:\"GetOptionsHtml\",value:function(){var t=[];if(this.IsEmpty&&t.push(\"<option></option>\"),this.Options&&this.Options.length>0){var e=void 0,n=void 0;this.Options.forEach(function(i){void 0!=i.Value&&void 0!=i.Text?(e=i.Value,n=i.Text):(e=i,n=i),t.push('<option value=\"'+e+'\">'+n+\"</option>\")})}else!this.IsEmpty&&t.push(\"<option></option>\");return t.join(\"\")}},{key:\"LoadOptionHtml\",value:function(){var t=this,e=[],n=this.DataSource,a=n.TextName,o=n.ValueName;if(this.IsEmpty&&e.push(\"<option></option>\"),this.DataList&&this.DataList.length>0){var r=void 0,l=void 0,u=void 0;this.DataList.forEach(function(n){r=n[o],l=n[a],u=i.IsEquals(r,t.Value)?' selected=\"selected\"':\"\",e.push('<option value=\"'+r+'\"'+u+\">\"+l+\"</option>\")})}else!this.IsEmpty&&e.push(\"<option></option>\");s.SetHtml(this.Element,e.join(\"\"))}},{key:\"DataLoad2\",value:function(){var t=this;this.DataSource&&this.GetDataList(),this.DataSource&&(s.SetHtml(this.Element,\"<option>数据源加载中……</option>\"),this.GetDataList().then(function(){return t.LoadOptionHtml()}))}}]),e}(e)}($ns),function(t){var e=t.controls.Index,n=t.utils;n.Common,n.HtmlTag;t.controls.TextArea=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.ControlWidth&&(n.Width=n.ControlWidth),n.Width=n.Width||200,n.ClassName=n.ClassName||\"TextArea\",n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){this.SetAttribute(\"name\",this.Name),this.ClassName&&this.SetAttribute(\"class\",this.ClassName);var t=[];t.push(\"width:\"+this.Width+\"px;\");var e=this.Height-8;t.push(\"height:\"+e+\"px;\"),t.length>0&&this.SetAttribute(\"style\",t.join(\"\"));var n=[];return n.push('<textarea  cols=\"100\" rows=\"100\"\" id=\"'+this.Id+'\"'),n.push(this.GetAttributeHtml()),n.push(\">\"),n.push(\"</textarea>\"),n.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.controls.TextBox,n=t.utils,i=n.Common,s=n.HtmlTag;t.controls.TextSelect=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.DataList=n.DataList||[],n.SelectDataList=[],n.ValueName=n.ValueName||\"Value\",n.TextName=n.TextName||\"Text\",n.SelectValue=\"\",n.SelectText=\"\",n.MaxItemLength=100,n}return _inherits(e,t),_createClass(e,[{key:\"EventLoad3\",value:function(){var t=this;s.BindEvent(this.Element,\"click\",function(e){t.LoadSelect(e)}),s.BindEvent(this.Element,\"change\",function(e){t.InputChange(e)}),s.BindEvent(this.Element,\"keydown\",function(e){t.SearchByKeyword(e)}),s.BindEvent(this.Element,\"keypress\",function(e){t.SearchByKeyword(e)})}},{key:\"SearchByKeyword\",value:function(t){var e=this;this.TimeoutId&&window.clearInterval(this.TimeoutId),this.TimeoutId=window.setTimeout(function(){return e.BandKeywordData()},150)}},{key:\"BandKeywordData\",value:function(){this.SelectDataList=this.SearchData(),this.SetSelectOffSet();var t=this.SelectOffSet,e=t.Width,n=t.Height;s.SetStyle(this.SelectTag,{width:e+\"px\",height:n+\"px\"}),s.SetHtml(this.ContentTag,this.GetItemHtml(this.SelectDataList)),this.BindSelectEvents()}},{key:\"InputChange\",value:function(t){var e=i.Trim(t.target.value);i.IsEquals(e,this.SelectText)||(this.SelectValue=\"\",this.SelectText=\"\",t.target.value=\"\")}},{key:\"LoadSelect\",value:function(){if(0!=this.DataList.length){var t=s.GetOffSet(this.Element);this.SelectOffSet={Top:t.top+t.height+1,Left:t.left+1},s.AppendHtml(document.body,this.GetSelectHtml()),this.SelectEventLoad()}}},{key:\"SetSelectOffSet\",value:function(){var t=this.GetDataMaxWidth(this.SelectDataList)+20;t=t>this.Width+2?t:this.Width+2;var e=30*this.SelectDataList.length;e=e>300?300:e,this.SelectOffSet.Width=t,this.SelectOffSet.Height=e}},{key:\"GetSelectHtml\",value:function(){this.SelectDataList=this.SearchData(),this.SetSelectOffSet();var t=this.SelectOffSet,e=t.Top,n=t.Left,s=t.Width,a=t.Height,o=i.GetZIndex(),r=[];return r.push('<div class=\"TextSelect\" style=\"z-index:'+o+\";top:\"+e+\"px;left:\"+n+\"px;width:\"+s+\"px;height:\"+a+'px;\" id=\"divSelect_'+this.Id+'\">'),r.push('<div class=\"SelectArea\" id=\"divContent_'+this.Id+'\">'),r.push(this.GetItemHtml(this.SelectDataList)),r.push(\"</div></div>\"),r.join(\"\")}},{key:\"GetItemHtml\",value:function(t){var e=this,n=[],s=\"\",a=\"\";return n.push(\"<ul>\"),t.forEach(function(t){t.Id=i.CreateGuid(),s=t[e.ValueName],a=t[e.TextName],i.IsNullOrEmpty(s)||i.IsNullOrEmpty(a)||n.push('<li><a class=\"DivRadiusBorder\" id='+t.Id+' href=\"javascript:void(0);\">'+a+\"</a></li>\")}),n.push(\"</ul>\"),n.join(\"\")}},{key:\"GetDataMaxWidth\",value:function(t){var e=this,n=0,s=0,a=null;return t.forEach(function(t){(a=t[e.TextName])&&(s=i.ComputeStringWidth(a),n=s>n?s:n)}),n}},{key:\"SearchData\",value:function(){var t=this,e=s.GetValue(this.Element),n=[],i=0;if(e){var a=\"\",o=\"\";this.DataList.forEach(function(i){a=i[t.ValueName],o=i[t.TextName],a&&o&&o.indexOf(e)>=0&&n.push(i)})}else{i=this.DataList.length>this.MaxItemLength?this.MaxItemLength:this.DataList.length;for(var r=0;r<i;r++)n.push(this.DataList[r])}return n}},{key:\"SelectEventLoad\",value:function(){var t=this;this.SelectTag=s.GetById(\"divSelect_\"+this.Id),this.ContentTag=s.GetById(\"divContent_\"+this.Id),s.OffBindEvent(document.body,\"click.TextSelect\"),s.BindEvent(document.body,\"click.TextSelect\",function(e){var n=t.SelectOffSet,i=n.Top,s=n.Left,a=n.Width,o=n.Height,r=e.pageX,l=e.pageY,u=!0;r<s||r>s+a?u=!1:(l<i-35||l>i+o)&&(u=!1),u||(console.log(!0),t.Destory()),console.log(u)}),this.BindSelectEvents()}},{key:\"BindSelectEvents\",value:function(){var t=this;this.SelectDataList.forEach(function(e){s.BindEvent(s.GetById(e.Id),\"click\",function(e){t.SetSelectItem(e.target.id)})})}},{key:\"SetSelectItem\",value:function(t){var e=this.SelectDataList.filter(function(e){return e.Id===t});1===e.length&&(this.SelectText=e[0][this.TextName],this.SelectValue=e[0][this.ValueName],s.SetValue(this.Element,this.SelectText),this.Destory())}},{key:\"GetValue\",value:function(){return this.SelectValue||\"\"}},{key:\"SetValue\",value:function(t){var e=this;this.SelectValue=t;var n=this.DataList.filter(function(n){return i.IsEquals(n[e.ValueName],t)});1===n.length&&(this.SelectText=n[0][this.TextName],s.SetValue(this.Element,this.SelectText))}},{key:\"DataLoad3\",value:function(){var t=this;this.DataSource&&(this.Element.placeholder=\"数据源加载中……\",this.GetDataList().then(function(){t.Element.placeholder=\"\",!t.SelectText&&t.SelectValue&&t.SetValue(t.SelectValue)}))}},{key:\"Destory\",value:function(){console.log(this.SelectTag.id),s.RemoveElement(document.body,this.SelectTag),s.OffBindEvent(document.body,\"click.TextSelect\")}}]),e}(e)}($ns),function(t){var e=t.utils.Common,n=t.data.Index.GetStateValue;t.components.Index=function(){function t(n){_classCallCheck(this,t),this.Id=e.CreateGuid(),n&&Object.assign(this,n)}return _createClass(t,[{key:\"GetHtml\",value:function(){return\"\"}},{key:\"InitTagObject\",value:function(){}},{key:\"EventLoad2\",value:function(){}},{key:\"DataLoad2\",value:function(){}},{key:\"EventLoad\",value:function(){this.InitTagObject(),this.ComponentList&&this.ComponentList.forEach(function(t){return t.EventLoad()}),this.ControlList&&this.ControlList.forEach(function(t){return t.EventLoad()}),this.EventLoad2()}},{key:\"DataLoad\",value:function(){this.ComponentList&&this.ComponentList.forEach(function(t){return t.DataLoad()}),this.ControlList&&this.ControlList.forEach(function(t){return t.DataLoad()}),this.DataLoad2()}},{key:\"GetDataValue\",value:function(t,e){var i=this;return n(t,this.KeyName,e,this[e]).then(function(t){return null!=t&&(i[e]=t),Promise.resolve(null!=t)})}},{key:\"IsFailMessage\",value:function(t){return!!t.ActionFailedMessage&&(e.Alert(t.ActionFailedMessage),!0)}}]),t}()}($ns),function(t){var e=t.components.Index,n=t.controls.Button;t.components.Buttons=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Actions=i.Actions||[],i.ControlList=i.Actions.map(function(t){return new n({Action:t,Width:t.Width})}),i.Styles=i.Styles||{UlButton:\"UlButton\"},i}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){var t=[];return t.push('<ul cass=\"UlButton\">'),t=t.concat(this.ControlList.map(function(t){return\"<li>\"+t.GetHtml()+\"</li>\"})),t.push(\"</ul>\"),t.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.components.Index,n=t.controls,i=n.SpanLabel,s=n.TextBox,a=n.GridView,o=n.DownList,r=n.TextArea,l=n.TextSelect,u=t.utils.Common;t.components.PropertyItem=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.InitControls(),n.IsPassword=\"Password\"===n.Property.ControlType,n}return _inherits(e,t),_createClass(e,[{key:\"InitControls\",value:function(){this.ControlList=[],this.ControlList.push(new i(this.Property)),this.ControlList.push(this.GetControl())}},{key:\"GetControl\",value:function(){switch(this.Property.ControlType){case\"GridView\":return new a(this.Property);case\"DownList\":return new o(this.Property);case\"TextArea\":return new r(this.Property);case\"TextSelect\":return new l(Object.assign({EnterControl:this.EnterControl},this.Property));default:return new s(Object.assign({EnterControl:this.EnterControl},this.Property))}}},{key:\"GetRowClassName\",value:function(){return this.ControlList[1].GetRowClassName()}},{key:\"GetHtml\",value:function(){var t=[],e=null,n=0,i=0;return t.push(\"<dl>\"),e=this.ControlList[0],t.push(\"<dt>\"+e.GetHtml()+\"</dt>\"),n+=e.Width,i=e.Height,e=this.ControlList[1],t.push(\"<dd>\"+e.GetHtml()+\"</dd>\"),n+=e.Width+10,i=e.Height>i?e.Height:i,this.Width=n,this.Height=i,t.push(\"</dl>\"),t.join(\"\")}},{key:\"GetValue\",value:function(){return this.ControlList[1].GetValue()}},{key:\"Validate\",value:function(t){var e=this.Property,n=e.IsNullable,i=e.Label,s=e.MaxLength,a=\"\",o=!0;return!1===n&&u.IsNullOrEmpty(t)&&(a=i+\"不能为空！\",o=!1),o&&s>0&&t&&t.length>s&&(a=i+\"字符长度超过\"+s+\"个！\",o=!1),o||u.Alert(a),o}},{key:\"SetValue\",value:function(t){this.ControlList[1].SetValue(t)}}]),e}(e)}($ns),function(t){var e=t.components.Index,n=t.controls,i=n.DataSpan,s=n.LinkButton,a=t.utils.HtmlTag;t.components.DataItem=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.BorderColor=n.BorderColor||\"#a6c9e2\",n.InitControls(),n}return _inherits(e,t),_createClass(e,[{key:\"InitControls\",value:function(){var t=this;this.ControlList=[],this.Data&&(this.ControlList=this.Properties.map(function(e){return t.GetControl(e)}))}},{key:\"GetControl\",value:function(t){switch(t.ControlType){case\"LinkButton\":return new s(Object.assign({RowData:this.Data},t));default:return new i(Object.assign({Value:this.Data[t.Name]},t))}}},{key:\"InitTagObject\",value:function(){this.TrTag=a.GetById(this.Id)}},{key:\"EventLoad2\",value:function(){var t=this;a.BindEvent(this.TrTag,\"click\",function(e){return t.ClickRow(e)})}},{key:\"DataLoad2\",value:function(){if(this.Data&&this.SelectIdList&&this.SelectIdList.length>0){var t=this.Data[this.PrimaryKey],e=this.SelectIdList.filter(function(e){return e===t});e&&e.length>0&&this.SetSelectRow()}}},{key:\"ClickRow\",value:function(){this.TrTag.Selected||(this.TrTag.parentNode.childNodes.forEach(function(t){t.Selected=!1,a.RemoveClass(t,\"SelectTr\")}),this.SetSelectRow())}},{key:\"SetSelectRow\",value:function(){a.AddClass(this.TrTag,\"SelectTr\"),this.TrTag.Selected=!0}},{key:\"GetValue\",value:function(){return this.Data}},{key:\"GetHtml\",value:function(){var t=this,e=[];e.push(\"<tr id=\"+this.Id+' style=\"border-bottom:1px solid '+this.BorderColor+'\">');var n=\"\",i=\"\";return this.ControlList.forEach(function(s,a){i=0===t.RowIndex?\"width:\"+s.ColumnWidth+\"px;\":\"\",n=a>0?n=\"border-left:1px solid \"+t.BorderColor+\";\":\"\",e.push('<td style=\"width:'+s.ColumnWidth+\"px;\"+n+'\">'),e.push(s.GetHtml()+\"</td>\")}),e.push(\"</tr>\"),e.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.components.Index,n=t.controls.DataSpan,i=t.utils.HtmlTag;t.components.GridHeader=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.BorderColor=n.BorderColor||\"#a6c9e2\",n.Styles=n.Styles||{DivHeader:\"DivHeader\"},n.InitControls(),n}return _inherits(e,t),_createClass(e,[{key:\"InitControls\",value:function(){this.ControlList=this.Properties.map(function(t){return new n(Object.assign({Value:t.Label||t.Name,IsLabel:!0},t))})}},{key:\"InitTagObject\",value:function(){this.TableTag=i.GetById(this.Id)}},{key:\"GetHtml\",value:function(){var t=this,e=[],n=this.IsFixedWidth?this.Width.toString()+\"px\":\"100%\";e.push('<div class=\"'+this.Styles.DivHeader+'\">'),e.push('<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:'+n+'\" id=\"'+this.Id+'\"><thead><tr>');var i=\"\";return this.ControlList.forEach(function(n,s){i=s>0?i=\"border-left:1px solid \"+t.BorderColor+\";\":\"\",e.push('<th style=\"width:'+n.ColumnWidth+\"px;\"+i+'\">'),e.push(n.GetHtml()+\"</th>\")}),e.push(\"</tr></thead></table></div>\"),e.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.components,n=e.Index,i=e.GridHeader,s=e.DataItem,a=t.data.Index.Connect,o=t.utils,r=o.Common,l=o.HtmlTag,u=t.actions,h=u.EditAction,c=u.DeleteAction;t.components.DataGrid=function(e){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.Styles=e.Styles||{DivGrid:\"DivGrid\",DivGridContent:\"DivGridContent\"},e.InitControls(),e}return _inherits(n,e),_createClass(n,[{key:\"InitControls\",value:function(){var e=this;this.DataList=[],this.GetDataActions(),this.Properties.forEach(function(n){!n.Action&&n.ActionInvoke&&(n.Action=new t.actions.Index(e),n.Action.Invoke=n.ActionInvoke)}),this.Properties=this.Properties.sort(function(t,e){return t.X>e.X?1:-1}),this.Properties=this.Properties.concat(this.DataActions.map(function(t){return{ColumnWidth:60,Label:t.Label,ControlType:\"LinkButton\",Action:t}})),this.ComputeWidth(),this.GridHeaderComponent=new i({Properties:this.Properties,Width:this.Width,IsFixedWidth:this.IsFixedWidth}),this.ComponentList=[this.GridHeaderComponent]}},{key:\"ComputeWidth\",value:function(){var t=this;this.Width=0;var e=0;this.Properties.forEach(function(n){t.Width+=n.ColumnWidth>0?n.ColumnWidth:0,e+=n.ColumnWidth>0?0:1}),this.GridWidth=800,e>0&&this.GridWidth>this.Width&&(this.ColumnWidth=Math.floor((this.GridWidth-this.Width-10)/e),this.Properties.forEach(function(e){e.ColumnWidth=e.ColumnWidth>0?e.ColumnWidth:t.ColumnWidth}))}},{key:\"GetDataActions\",value:function(){return this.DataActions=[],this.DataActions.push(new h(this)),this.DataActions.push(new c(this)),this.DataActions}},{key:\"GetHtml\",value:function(){var t=[],e=this.IsFixedWidth?this.Width.toString()+\"px\":\"100%\";t.push('<div class=\"'+this.Styles.DivGrid+'\">'),t.push(this.ComponentList[0].GetHtml());var n=\"\",i=[];return this.Height>0&&i.push(\"height:\"+(this.Height-60)+\"px;\"),i.length>0&&(n=' style=\"'+i.join(\"\")+'\"'),t.push('<div class=\"'+this.Styles.DivGridContent+'\"'+n+\">\"),t.push('<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:'+e+';\" id=\"'+this.Id+'\">'),t.push(\"<tbody></tbody></table></div></div>\"),t.join(\"\")}},{key:\"InitTagObject\",value:function(){this.TableTag=l.GetById(this.Id),this.TableTbodyTag=r.ArrayFirst(l.Find(this.TableTag,\"tbody\"))}},{key:\"EventLoad2\",value:function(){var t=this.TableTag.parentNode,e=this.GridHeaderComponent.TableTag;l.BindEvent(t,\"scroll\",function(t){e.CurrentLeft!==t.target.scrollLeft&&(e.CurrentLeft=t.target.scrollLeft,e.style.left=-t.target.scrollLeft+\"px\")})}},{key:\"DataLoad\",value:function(){var e=this;this.Properties.forEach(function(e){t.data.Cache.GetPropertyDataList(e)}),a(function(t){e.GetDataValue(t,\"QueryResponse\").then(function(t){t&&e.SetQueryResponse()})})}},{key:\"SaveData\",value:function(t){var e=this.Entity.PrimaryKey,n=this.DataList.filter(function(n){return n[e]===t[e]});n&&1===n.length?n[0]=Object.assign(n[0],t):this.DataList.push(t),this.BindData([t[e]])}},{key:\"DeleteData\",value:function(t){for(var e=-1,n=this.Entity.PrimaryKey,i=0;i<this.DataList.length;i++)if(this.DataList[i][n]===t){e=i;break}e>=0&&(this.DataList.splice(e,1),this.BindData([]))}},{key:\"GetValue\",value:function(){return this.DataList}},{key:\"SetValue\",value:function(t){t&&t.length>0&&(this.DataList=t.map(function(t){return t})),this.BindData([])}},{key:\"BindData\",value:function(t){var e=this;this.RowCount=this.DataList.length,this.DataItemComponentList=this.DataList.map(function(n,i){return new s({RowIndex:i,Properties:e.Properties,Data:n,PrimaryKey:e.Entity.PrimaryKey,SelectIdList:t})});var n=this.DataItemComponentList.map(function(t,e){return t.GetHtml()});l.SetHtml(this.TableTbodyTag,n.join(\"\")),this.DataItemComponentList.forEach(function(t){t.EventLoad(),t.DataLoad()})}},{key:\"SetQueryResponse\",value:function(){var t=this.QueryResponse;if(null!=t&&!this.IsFailMessage(t)&&null!=t.DataList){var e=t.Ids?t.Ids.split(\",\"):[];this.DataList=t.DataList,this.BindData(e)}}}]),n}(n)}($ns),function(t){var e=t.components.Index,n=t.data.Index.Connect,i=t.controls,s=i.Button,a=i.SpanLabel,o=i.TextBox,r=t.actions.PagingIndexQueryAction,l=t.utils,u=l.Common,h=l.HtmlTag;t.components.DataPaging=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.InitControls(),e.Styles=e.Styles||{DivPage:\"DivPage\"},e}return _inherits(i,e),_createClass(i,[{key:\"InitControls\",value:function(){var t=new s({Action:new r(this),Width:50});this.ControlList=[],this.ControlList.push(this.GetPagingButton(\"PagingFirstAction\")),this.ControlList.push(this.GetPagingButton(\"PagingPreAction\")),this.ControlList.push(new a({Label:1,IsColon:!1,IsWidth:!1,ClassName:\"SpanIndex\"})),this.ControlList.push(this.GetPagingButton(\"PagingNextAction\")),this.ControlList.push(this.GetPagingButton(\"PagingLastAction\")),this.ControlList.push(new a({Label:\"到\",IsColon:!1,IsWidth:!1})),this.ControlList.push(new o({Name:\"IndexCount\",MaxLength:10,Width:50,EnterControl:t})),this.ControlList.push(new a({Label:\"页\",IsColon:!1,IsWidth:!1})),this.ControlList.push(t),this._ctls={First:this.ControlList[0],Pre:this.ControlList[1],Next:this.ControlList[3],Last:this.ControlList[4],IndexCount:this.ControlList[6],IndexQuery:this.ControlList[8]}}},{key:\"GetPagingButton\",value:function(e){return new s({Action:new t.actions[e](this),ClassName:\"Button\",Width:35})}},{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"'+this.Styles.DivPage+'\" style=\"display:none;\" id=\"'+this.Id+'\">'),t.push('<div class=\"DivLeft\"><span class=\"SpanRecord\" id=\"record_'+this.Id+'\"></span></div>'),t.push('<div class=\"DivRight\"><ul>'),t=t.concat(this.ControlList.map(function(t){return\"<li>\"+t.GetHtml()+\"</li>\"})),t.push(\"</ul></div></div>\"),t.join(\"\")}},{key:\"InitTagObject\",value:function(){this.PageTag=h.GetById(this.Id),this.SpanRecord=h.GetById(\"record_\"+this.Id)}},{key:\"DataLoad\",value:function(){var t=this;n(function(e){t.GetDataValue(e,\"QueryResponse\").then(function(e){e&&t.SetQueryResponse()})})}},{key:\"SetQueryResponse\",value:function(){var t=this.QueryResponse;null!=t&&(this.IsFailMessage(t)||(t.PageRecord>=0&&(this.PageRecord=t.PageRecord),this.BindPage()))}},{key:\"BindPage\",value:function(){if(this.PageIndex=this.SearchAction.PageIndex,0==this.PageRecord)return this.PageIndex=1,this.PageCount=0,void h.SetHide(this.PageTag);this.PageRecord%this.PageSize==0?this.PageCount=parseInt(this.PageRecord/this.PageSize):this.PageCount=parseInt(this.PageRecord/this.PageSize)+1,this.PageIndex=this.PageIndex<1?1:this.PageIndex,this.PageIndex=this.PageIndex>this.PageCount?this.PageCount:this.PageIndex,this.ControlList[2].SetValue(this.PageIndex);var t=(this.PageIndex-1)*this.PageSize+1,e=this.PageIndex*this.PageSize;e=e>this.PageRecord?this.PageRecord:e;var n=t+\" - \"+e+\" 共 \"+this.PageCount+\" 页 \"+this.PageRecord+\" 条记录\";h.SetHtml(this.SpanRecord,n),this.SetPageControlDisabled(),h.SetShow(this.PageTag)}},{key:\"SetPageControlDisabled\",value:function(){var t=this,e=this.JudgePage();e.Enableds.forEach(function(e){return t._ctls[e].SetDisabled(!1)}),e.Disbleds.forEach(function(e){return t._ctls[e].SetDisabled(!0)})}},{key:\"JudgePage\",value:function(){var t={};return this.PageCount<=1?(t.Enableds=[],t.Disbleds=[\"First\",\"Pre\",\"Next\",\"Last\",\"IndexCount\",\"IndexQuery\"]):1==this.PageIndex?(t.Enableds=[\"Next\",\"Last\",\"IndexCount\",\"IndexQuery\"],t.Disbleds=[\"First\",\"Pre\"]):this.PageIndex==this.PageCount?(t.Enableds=[\"First\",\"Pre\",\"IndexCount\",\"IndexQuery\"],t.Disbleds=[\"Next\",\"Last\"]):(t.Enableds=[\"First\",\"Pre\",\"Next\",\"Last\",\"IndexCount\",\"IndexQuery\"],t.Disbleds=[]),t}},{key:\"GetInputPageIndex\",value:function(){var t=this.ControlList[6],e=parseInt(t.GetValue());return e>0&&e<=this.PageCount?(this.PageIndex=e,t.SetValue(\"\"),this.PageIndex):(u.Alert(\"对不起，请输入1至\"+this.PageCount+\"之间的自然数页索引！\").then(function(){return t.Element.focus()}),!1)}}]),i}(e)}($ns),function(t){var e=t.components.Index,n=t.utils,i=n.Common,s=n.HtmlTag,a=t.actions,o=a.DialogOkAction,r=a.DialogCancelAction,l=t.components.Buttons;t.components.Dialog=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Styles=n.Styles||{DialogBackground:\"DialogBackground\",DivDialog:\"DivDialog\"},i.InitValue(n,[\"IsClosed\",\"IsOkButton\"],!0),n.DialogKey=\"Dialog_\"+n.Id.substring(0,8),n}return _inherits(e,t),_createClass(e,[{key:\"InitControls\",value:function(){this.Actions=this.Actions||this.GetActions(),this.ButtonsComponent=new l({Actions:this.Actions}),this.ComponentList=[this.ButtonsComponent],this.Width+=50,this.Height+=100}},{key:\"GetActions\",value:function(){var t=[],e=new o(this);return this.OkLabel&&(e.Label=this.OkLabel),this.IsOkButton&&t.push(e),this.IsClosed&&t.push(new r(this)),t}},{key:\"GetHtml\",value:function(){var t=s.GetWindowWidth(),e=s.GetWindowHeight(),n=i.GetZIndex(),a=[];a.push('<div class=\"'+this.Styles.DialogBackground+'\" id=\"bg_'+this.Id+'\" style=\"z-index:'+n+';\">'),a.push(\"</div>\");var o=Math.round(e/2-this.Height/2-30),r=Math.round(t/2-this.Width/2);return o=o<10?10:o,r=r<10?10:r,t=this.Width,e=this.Height,n=i.GetZIndex(),a.push('<div class=\"DivRadiusBorder '+this.Styles.DivDialog+'\" id=\"'+this.Id+'\"'),a.push(' style=\"position:absolute;width:'+t+\"px;height:\"+e+\"px;z-index:\"+n+\";top:\"+o+\"px;left:\"+r+'px;\">'),a.push(this.GetHeaderHtml()),e-=80,a.push('<div class=\"DivContent\" style=\"height:'+e+'px;\">'+this.Html+\"</div>\"),a.push(this.GetButtonsHtml()),a.push(\"</div>\"),a.join(\"\")}},{key:\"GetButtonsHtml\",value:function(){return'<div class=\"DivButton\">'+this.ButtonsComponent.GetHtml()+\"</div>\"}},{key:\"GetHeaderHtml\",value:function(){var t=[];return t.push('<div class=\"DivRadiusBorder DivTitleHeader\" id=\"header_'+this.Id+'\">'),t.push('<span class=\"SpanTitle\">'+this.Title+\"</span>\"),this.IsClosed&&t.push('<a href=\"javascript:void(0);\" id=\"close_'+this.Id+'\"><span class=\"ui-icon ui-icon-closethick\"></span></a>'),t.push(\"</div>\"),t.join(\"\")}},{key:\"Show\",value:function(){var t=this;this.InitControls(),s.AppendHtml(document.body,this.GetHtml()),this.DivBackground=s.GetById(\"bg_\"+this.Id),this.DivDialog=s.GetById(this.Id),this.IsClosed&&s.BindEvent(s.GetById(\"close_\"+this.Id),\"click\",function(){return t.Close()});var e=s.GetById(\"header_\"+this.Id);s.BindEvent(e,\"mousedown\",function(e){return t.Down(e)}),s.OffBindEvent(window,\"mousemove.\"+this.DialogKey),s.BindEvent(window,\"mousemove.\"+this.DialogKey,function(e){return t.Move(e)}),s.BindEvent(e,\"mouseup\",function(e){return t.Up(e)}),this.EventLoad(),this.DataLoad()}},{key:\"Down\",value:function(t){this.IsStart=!0;var e=s.GetOffSet(this.DivDialog);this.StartX=t.pageX-e.left,this.StartY=t.pageY-e.top}},{key:\"Move\",value:function(t){if(this.IsStart){this.IsMove=!0;var e=s.GetWindowWidth(),n=s.GetWindowHeight(),i=t.pageX-this.StartX,a=t.pageY-this.StartY;i=i+this.Width>e-20?e-this.Width-20:i,a=a+this.Height>n-20?n-this.Height-20:a,i=i<1?1:i,a=a<1?1:a,s.SetStyle(this.DivDialog,{left:i+\"px\",top:a+\"px\"})}}},{key:\"Up\",value:function(t){this.IsMove&&(this.IsStart=!1)}},{key:\"Close\",value:function(){s.RemoveElement(document.body,this.DivDialog),s.RemoveElement(document.body,this.DivBackground),s.OffBindEvent(window,\"mousemove.\"+this.DialogKey)}}]),e}(e)}($ns),function(t){var e=t.utils.Common;t.components.AlertConfirm=function(){function n(t){_classCallCheck(this,n),this.Id=e.CreateGuid(),t&&Object.assign(this,t),this.Init()}return _createClass(n,[{key:\"Init\",value:function(){this.Message=e.IsNullOrEmpty(this.Message)?\"\":this.Message.toString(),this.Message=this.Message.replace(/</g,\"&lt;\"),this.Message=this.Message.replace(/>/g,\"&gt;\"),this.ImgDivClassName=this.IsConfirm?\"DivConfirm\":\"DivWarn\";var t=300,n=100,i=15*this.Message.length;i>500?(t=500,n=150):i>t&&(t=i),this.Width=t,this.Height=n}},{key:\"GetHtml\",value:function(){var t=[];return t.push('<table class=\"Alert\" border=\"0\"cellpadding=\"0\" cellspacing=\"0\"><tr align=\"left\">'),t.push('<td valign=\"top\" width=\"40px\"><div class=\"'+this.ImgDivClassName+'\"></div></td>'),t.push('<td valign=\"top\"><div class=\"Text\"><span>'+this.Message+\"</span></div></td>\"),t.push(\"</tr></table>\"),t.join(\"\")}},{key:\"ShowDialog\",value:function(e){var n=new t.components.Dialog({Width:this.Width,Height:this.Height,Html:this.GetHtml(),IsClosed:!1,OkAction:{Invoke:function(){n.Close(),e()}},Title:this.IsConfirm?\"确认信息\":\"提示信息\"}),i=[new t.actions.DialogOkAction(n)];i[0].IsOkFocus=!0,this.IsConfirm&&(n.IsClosed=!0,i.push(new t.actions.DialogCancelAction(n))),n.Actions=i,n.Show()}},{key:\"Show\",value:function(){var t=this;return new Promise(function(e,n){t.ShowDialog(e)})}}]),n}()}($ns),function(t){var e=t.utils,n=e.Common,i=e.HtmlTag;t.components.ExcelImport=function(){function e(t){_classCallCheck(this,e),this.Id=n.CreateGuid(),t&&Object.assign(this,t)}return _createClass(e,[{key:\"Import\",value:function(){window.FileReader?this.ExcelImportForFileReader():n.Alert(\"对不起，浏览器不支持Excel导入方式，请使用Chrome或IE8及以上浏览器！\")}},{key:\"ExcelImportForFileReader\",value:function(){var e=this;this.ExcelImportDialog=new t.components.Dialog({Width:600,Height:100,Html:this.GetHtml(),Title:\"Excel导入\",OkLabel:\"导入\",OkAction:{Invoke:function(t,n){e.ExecExcelImport(n)}}}),this.ExcelImportDialog.Show()}},{key:\"ExecExcelImport\",value:function(t){var e=i.GetById(\"file_\"+this.Id),s=e.files;if(0==s.length)return void n.Alert(\"对不起，请选择Excel导入文件！\");var a=s[0],o=\"\";return\"application/vnd.ms-excel\"==a.type?o=\".xls\":\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"==a.type&&(o=\".xlsx\"),\"\"==o?void n.Alert(\"对不起，只能导入Excel文件！\"):a.size>1048576?void n.Alert(\"对不起，Excel文件大小不能大于1M\"):(t.SetDisabled(!0),void this.SendFileRequest(a,o,t))}},{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"DivText\"><dl><dt><span>Excel文件：</span></dt>'),t.push('<dd><input type=\"file\" id=\"file_'+this.Id+'\"'),t.push(' accept=\"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\" style=\"width:500px;\" class=\"TextBox\"></dd>'),t.push(\"</dl></div>\"),t.join(\"\")}},{key:\"SendFileRequest\",value:function(t,e,i){var s=this,a=\"ExcelImportHandler.ashx?EntityName=\"+this.Entity.Name+\"&ft=\"+e,o=new FileReader;o.onloadend=function(){s.Api.PostStreamFetch(a,o.result).then(function(t){i.SetDisabled(!1),t.MessageList&&t.MessageList.length>0?(s.ShowMessageList(t),t.Message&&0===t.Message.indexOf(\"操作成功\")&&(s.SearchAction.ExcelRefresh(),s.ExcelImportDialog.Close())):t.Message&&n.Alert(unescape(t.Message)).then(function(){0===t.Message.indexOf(\"操作成功\")&&(s.SearchAction.ExcelRefresh(),s.ExcelImportDialog.Close())})},function(t){i.SetDisabled(!1);var e=t&&t.message?t.message:t;n.Alert(e)})},o.readAsArrayBuffer(t)}},{key:\"ShowMessageList\",value:function(e){var i=[],s=\"错误提示\";i.push('<div class=\"DivList\">'),n.IsNullOrEmpty(e.Message)||(i.push('<div class=\"DivText\"><span>'+e.Message+\"</span></div>\"),0==e.Message.indexOf(\"操作成功\")&&(s=\"信息\")),i.push('<div class=\"DivData\"><div class=\"DivGridView\">'),i.push('<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">'),i.push('<thead><tr><td width=\"40\">行号</td><td width=\"800\">'+s+\"</td></tr></thead>\"),i.push(\"<tbody>\"),e.MessageList.forEach(function(t){i.push(\"<tr>\"),i.push(\"<td>\"+t.RowNum+\"</td>\"),i.push(\"<td>\"+t.Message+\"</td>\"),i.push(\"</tr>\")}),i.push(\"</tbody></table></div></div></div>\"),this.ExcelMessageDialog=new t.components.Dialog({Width:850,Height:500,Html:i.join(\"\"),Title:\"Excel导入提示信息\",IsOkButton:!1}),this.ExcelMessageDialog.Show()}}]),e}()}($ns),function(t){var e=t.components.Index,n=t.controls,i=n.SpanLabel,s=n.LinkButton,a=t.actions.ChangePasswordAction;t.components.Login=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Init(),n}return _inherits(e,t),_createClass(e,[{key:\"Init\",value:function(){var t=this.Page.LoginUser,e=t.LoginName+\"，欢迎您\"\n;t.LastLoginDate?e=e+\"，上一次登录时间：\"+t.LastLoginDate:e+=\"，第一次登录系统\",this.ControlList=[],this.ControlList.push(new i({IsWidth:!1,IsColon:!1,Label:e})),this.ControlList.push(new s({Action:new a(this.Page)}))}},{key:\"GetHtml\",value:function(){var t=[];t.push('<div class=\"DivLogin\"><ul>'),t=t.concat(this.ControlList.map(function(t){return\"<li>\"+t.GetHtml()+\"</li>\"}));var e=escape(\"登录\");return t.push('<li><div style=\"text-align:center;\"><a href=\"Index.aspx?page='+e+'\">退出</a></div></li>'),t.push(\"</ul></div>\"),t.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.components.Index,n=t.utils,i=n.Common,s=n.HtmlTag;t.components.Menu=function(e){function n(t){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t))}return _inherits(n,e),_createClass(n,[{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"DivMenu\" id='+this.Id+\">\"),t.push('<div class=\"DivMenu1\">'),t.push(\"</div>\"),t.push('<div class=\"DivMenu2\">'),t.push(\"</div>\"),t.push(\"</div>\"),t.join(\"\")}},{key:\"InitTagObject\",value:function(){this.MenuTag=s.GetById(this.Id)}},{key:\"DataLoad2\",value:function(){var t=this;this.GetFirstMenuList().then(function(){t.GetPageMenuList().then(function(){t.GetAdminMenu().then(function(){t.SetMenuList()})})})}},{key:\"GetFirstMenuList\",value:function(){var t=this;return this.GetKeyValueList(\"菜单\",\"=\",\"菜单\").then(function(e){if(t.FirstMenuList=[],null!=e){var n=i.ArrayFirst(e);n&&(t.FirstMenuList=i.Split(n[\"值\"],[\"，\",\",\"]).map(function(t){return{Name:t}}))}return Promise.resolve()})}},{key:\"GetKeyValueList\",value:function(e,n,i){return t.data.Cache.GetDataList(e,\"键值配置\",[\"键名\",\"值\"],[{Name:\"键名\",Logic:n,Value:i}])}},{key:\"GetAdminMenu\",value:function(){var t=this;return this.GetKeyValueList(\"管理员菜单\",\"in\",\"管理员，管理员菜单\").then(function(e){if(t.AdminUserList=[],t.AdminMenuList=[],null!=e&&(e.forEach(function(e){\"管理员\"===e[\"键名\"]&&(t.AdminUserList=i.Split(e[\"值\"],[\"，\",\",\"])),\"管理员菜单\"===e[\"键名\"]&&(t.AdminMenuList=i.Split(e[\"值\"],[\"，\",\",\"]))}),t.Page.LoginUser)){var n=t.AdminUserList.filter(function(e){return i.IsEquals(e,t.Page.LoginUser.LoginName)});t.IsAdmin=1===n.length}return Promise.resolve()})}},{key:\"GetPageMenuList\",value:function(){var t=this,e=this.FirstMenuList.map(function(t){return\"菜单-\"+t.Name});return this.GetKeyValueList(\"页面菜单\",\"in\",e.join(\",\")).then(function(e){return t.PageDataList=[],null!=e&&e.forEach(function(e){i.Split(e[\"值\"],[\"，\",\",\"]).forEach(function(n){t.PageDataList.push({Name:n,MenuName:e[\"键名\"].replace(\"菜单-\",\"\")})})}),Promise.resolve()})}},{key:\"SetMenuList\",value:function(){var t=this;this.MenuList=[];var e=[],n=null,s=!1,a=!1,o=\"\";this.IsAdmin?e=this.FirstMenuList:this.FirstMenuList.forEach(function(s){n=t.AdminMenuList.filter(function(t){return i.IsEquals(t,s.Name)}),0===n.length&&e.push(s)}),e.forEach(function(e){(n=t.PageDataList.filter(function(t){return t.MenuName===e.Name}))&&n.length>0&&(a=!1,e.ChildMenuList=n.map(function(e){return o=e.Name,s=t.Page.Name===o,s&&(a=!0),{Name:o,Selected:s,Url:t.GetUrl(o)}}),e.Selected=a,e.Id=i.CreateGuid(),t.MenuList.push(e))}),this.LoadMenuHtml(e)}},{key:\"LoadMenuHtml\",value:function(t){var e=this;s.SetHtml(this.MenuTag,this.GetMenuHtml()),t.forEach(function(n){s.BindEvent(s.GetById(n.Id),\"click\",function(){t.forEach(function(t){t.Selected=n.Id===t.Id}),e.LoadMenuHtml(t)})})}},{key:\"GetUrl\",value:function(t){return\"Index.aspx?page=\"+escape(t)}},{key:\"GetMenuHtml\",value:function(){var t=[];t.push('<div class=\"DivMenu1\"><div class=\"DivMenuRight\">');var e=null;this.MenuList.forEach(function(n){n.Selected?(t.push(\"<p>\"+n.Name+\"</p>\"),e=n):t.push('<a href=\"javascript:void(0);\" id='+n.Id+\">\"+n.Name+\"</a>\")}),t.push(\"</div></div>\"),t.push('<div class=\"DivMenu2\"><ul>');var n=\"\";return e&&e.ChildMenuList.length>0&&e.ChildMenuList.forEach(function(e){n=e.Selected?' class=\"Active\"':\"\",t.push('<li><a href=\"'+e.Url+'\"'+n+\">\"+e.Name+\"</a></li>\")}),t.push(\"</ul></div>\"),t.join(\"\")}}]),n}(e)}($ns),function(t){var e=t.utils.Common;t.layouts.Index=function(){function t(n){_classCallCheck(this,t),this.Id=e.CreateGuid(),this.ComponentList=[],n&&Object.assign(this,n)}return _createClass(t,[{key:\"ExpandRowComponents\",value:function(){}},{key:\"GetRowList\",value:function(){var t=this,e=0;this.ComponentList.forEach(function(t){t.Property.X>e&&(e=t.Property.X)}),this.RowCount=e,this.RowList=[];for(var n=null,i=null,s=null,a=0;a<e;a++)!function(e){i=t.ComponentList.filter(function(t){return t.Property.X===e+1}),i=i.sort(function(t,e){return t.Property.Y>e.Property.Y?1:-1}),i.length>0&&i[0].GetRowClassName&&(s=i[0].GetRowClassName()),n={Components:i,ClassName:s},t.ExpandRowComponents(n,e),n.Components.length>0&&t.RowList.push(n)}(a);return this.RowList}}]),t}()}($ns),function(t){var e=t.layouts.Index;t.layouts.Search=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Styles=n.Styles||{DivSearch:\"DivSearch\",DivRow:\"DivRow\"},n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){var t=this;this.GetRowList();var e=[];return e.push('<div class=\"'+this.Styles.DivSearch+'\">'),e=e.concat(this.RowList.map(function(e){return t.GetRowHtml(e)})),e.push(\"</div>\"),e.join(\"\")}},{key:\"GetRowHtml\",value:function(t){var e=[];return e.push('<div class=\"'+this.Styles.DivRow+'\"><ul>'),e=e.concat(t.Components.map(function(t){return\"<li>\"+t.GetHtml()+\"</li>\"})),e.push(\"</ul></div>\"),e.join(\"\")}},{key:\"ExpandRowComponents\",value:function(t,e){e===this.RowCount-1&&this.ButtonComponentList&&this.ButtonComponentList.length>0&&(t.Components=t.Components.concat(this.ButtonComponentList))}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.GridView=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Styles=n.Styles||{DivGridView:\"DivGridView\"},n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"'+this.Styles.DivGridView+'\">'),t.push(this.DataGridComponent.GetHtml()),this.DataPagingComponent&&t.push(this.DataPagingComponent.GetHtml()),t.push(\"</div>\"),t.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.EditLayout=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Styles=n.Styles||{DivEdit:\"DivEdit\",DivRow:\"DivRow\"},n.Width=0,n.Height=0,n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){var t=this;this.GetRowList();var e=[];return e.push('<div class=\"'+this.Styles.DivEdit+'\">'),e=e.concat(this.RowList.map(function(e){return t.GetRowHtml(e)})),e.push(\"</div>\"),e.join(\"\")}},{key:\"GetRowHtml\",value:function(t){var e=[],n=0,i=0,s=t.ClassName?t.ClassName:this.Styles.DivRow;return e.push('<div class=\"'+s+'\"><ul>'),t.Components.forEach(function(t){e.push(\"<li>\"+t.GetHtml()+\"</li>\"),n+=t.Width,i=t.Height>i?t.Height:i}),this.Width=n>this.Width?n:this.Width,this.Height+=i,e.push(\"</ul></div>\"),e.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.DataOperationLayout=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Styles=n.Styles||{DivOperation:\"DivOperation\"},n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"'+this.Styles.DivOperation+'\">'),t.push(this.OpeartionComponent.GetHtml()),t.push(\"</div>\"),t.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.MenuLayout=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Styles=n.Styles||{DivLoginMenu:\"DivLoginMenu\"},n}return _inherits(e,t),_createClass(e,[{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"'+this.Styles.DivLoginMenu+'\">'),t.push(this.LoginComponent.GetHtml()),t.push(this.MenuComponent.GetHtml()),t.push(\"</div>\"),t.join(\"\")}}]),e}(e)}($ns),function(t){var e=t.utils.Common,n=t.actions;n.SearchAction,n.NewAddActions;t.pages.Index=function(){function t(n){var i=this;_classCallCheck(this,t),this.Id=e.CreateGuid(),this.Entity={Properties:[]},n&&Object.assign(this,n),this.Styles=this.Styles||{HtmlPage:\"HtmlPage\"},this.InitEntity(),this.Entity.Properties.forEach(function(t){return i.InitProperty(t)}),this.KeyName=this.PageName+\"_\"+this.Entity.Id}return _createClass(t,[{key:\"Load\",value:function(){this.PageInit(),this.PageLoad()}},{key:\"PageInit\",value:function(){}},{key:\"InitEntity\",value:function(){this.Entity.Label=this.Entity.Label||this.Entity.Name,this.Entity.Id=this.Entity.Id||e.CreateGuid(),e.InitValue(this.Entity,[\"IsSelectKey\"],!0)}},{key:\"InitProperty\",value:function(t){e.InitValue(t,[\"IsSearch\"],void 0!==t.SearchOptions),e.InitValue(t,[\"IsData\"],void 0!==t.DataOptions),e.InitValue(t,[\"IsEdit\"],void 0!==t.EditOptions),t.Label=t.Label||t.Name}},{key:\"PageLoad\",value:function(){}}]),t}()}($ns),function(t){var e=t.utils,n=e.Common,i=e.HtmlTag,s=t.pages.Index,a=t.layouts,o=a.Search,r=a.GridView,l=a.DataOperationLayout,u=a.MenuLayout,h=t.components,c=h.Buttons,d=h.PropertyItem,p=h.DataGrid,f=h.DataPaging,v=t.actions,y=v.SearchAction,m=v.NewAddAction,g=v.ExcelExportAction,C=v.ExcelImportAction;t.pages.ListPage=function(e){function s(t){_classCallCheck(this,s);var e=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return e.Title=e.Title||e.Entity.Label+\"列表\",document.title=e.Title,n.InitValue(e,[\"IsPage\"],!0),e.PageSize=e.PageSize||10,e}return _inherits(s,e),_createClass(s,[{key:\"PageInit\",value:function(){this.QueryString=n.GetQueryString(),this.LoginUser={UserId:\"\",LoginName:\"admin\"},t.data.Index.InitListPageEntityState(this.KeyName),this.Entity.ExpandPageInit&&this.Entity.ExpandPageInit.call(this,t),this.SearchProperties=this.Entity.Properties.filter(function(t){return t.IsSearch}).map(function(t){return Object.assign({},t,t.SearchOptions)}),this.DataProperties=this.Entity.Properties.filter(function(t){return t.IsData}).map(function(t){return Object.assign({},t,t.DataOptions)}),this.SelectNames=this.DataProperties.map(function(t){return t.Name}),this.SerachLayout=new o(this.GetSearchComponents()),this.GridViewLayout=new r(this.GetGridViewComponents()),this.DataOperationLayout=new l(this.GetOperationComponents()),this.MenuLayout=new u(this.GetMenuComponents())}},{key:\"GetMenuComponents\",value:function(){return this.MenuComponent=new t.components.Menu({Page:this}),this.LoginComponent=new t.components.Login({Page:this}),{MenuComponent:this.MenuComponent,LoginComponent:this.LoginComponent}}},{key:\"GetOperationComponents\",value:function(){var t=this.IsExcelExport;this.IsExcelImport;return this.OpeartionActions=[],!1!==t&&this.OpeartionActions.push(new g(this)),!1!==t&&this.OpeartionActions.push(new C(this)),this.OperationButtonsComponent=new c({Actions:this.OpeartionActions}),{OpeartionComponent:this.OperationButtonsComponent}}},{key:\"GetOrderByList\",value:function(){return[{Name:\"CreateDate\",IsDesc:!0}]}},{key:\"GetGridViewComponents\",value:function(){return this.DataGridComponent=new p({Entity:this.Entity,Properties:this.DataProperties,KeyName:this.KeyName}),this.IsPage?this.DataPagingComponent=new f({KeyName:this.KeyName,PageSize:this.PageSize,SearchAction:this.SearchActions[0]}):this.DataPagingComponent=null,{DataGridComponent:this.DataGridComponent,DataPagingComponent:this.DataPagingComponent}}},{key:\"GetSearchComponents\",value:function(){var t=this;return this.SearchButtonsComponent=new c({Actions:this.GetSearchActions()}),this.SearchComponents=this.SearchProperties.map(function(e){return new d({Property:e,EnterControl:t.SearchButtonsComponent.ControlList[0]})}),{ComponentList:this.SearchComponents,ButtonComponentList:[this.SearchButtonsComponent]}}},{key:\"GetSearchActions\",value:function(){return this.SearchActions=[],this.SearchActions.push(new y(this)),this.SearchActions.push(new m(this)),this.SearchActions}},{key:\"PageLoad\",value:function(){i.SetHtml(document.body,this.GetHtml()),this.EventLoad(),this.DataLoad(),this.SearchActions[0].Invoke()}},{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"'+this.Styles.HtmlPage+'\">'),t.push(this.MenuLayout.GetHtml()),t.push(this.SerachLayout.GetHtml()),this.OpeartionActions.length>0&&t.push(this.DataOperationLayout.GetHtml()),t.push(this.GridViewLayout.GetHtml()),t.push(\"</div>\"),t.join(\"\")}},{key:\"EventLoad\",value:function(){this.MenuComponent.EventLoad(),this.LoginComponent.EventLoad(),this.SearchComponents.forEach(function(t){return t.EventLoad()}),this.SearchButtonsComponent.EventLoad(),this.DataGridComponent.EventLoad(),this.DataPagingComponent&&this.DataPagingComponent.EventLoad(),this.SearchActions[0].InitConditionList=this.GetSearchCondition(),this.OpeartionActions.length>0&&this.OperationButtonsComponent.EventLoad()}},{key:\"DataLoad\",value:function(){this.MenuComponent.DataLoad(),this.LoginComponent.DataLoad(),this.SearchComponents.forEach(function(t){return t.DataLoad()}),this.SearchButtonsComponent.DataLoad(),this.DataGridComponent.DataLoad(),this.DataPagingComponent&&this.DataPagingComponent.DataLoad(),this.OpeartionActions.length>0&&this.OperationButtonsComponent.DataLoad()}},{key:\"GetSearchCondition\",value:function(){var t={};return this.SearchComponents.forEach(function(e){return t[e.Property.Name]=e.GetValue()}),this.SearchProperties.map(function(e){return{Name:e.Name,Logic:e.Logic||\"=\",Value:t[e.Name]||\"\"}}).filter(function(t){return!n.IsNullOrEmpty(t.Value)})}},{key:\"SetInitConditionList\",value:function(t){var e={};t.forEach(function(t){return e[t.Name]=t.Value});var n=\"\";this.SearchComponents.forEach(function(t){n=void 0===e[t.Property.Name]?\"\":e[t.Property.Name],t.SetValue(n)})}},{key:\"GetHeaderInfoList\",value:function(){return this.DataProperties.map(function(t){return{Name:t.Name,Label:t.Label}})}}]),s}(s)}($ns),function(t){var e=t.pages.Index,n=t.utils.Common,i=t.components,s=i.PropertyItem,a=(i.Dialog,t.layouts.EditLayout),o=t.actions,r=o.CreateAction,l=o.UpdateAction;t.pages.EditPage=function(e){function i(t){_classCallCheck(this,i),t.PageName=t.PageName||\"EditPage\";var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return n.InitValue(e,[\"IsDialog\"],!0),e.Title=e.Title||(e.IsUpdate?\"修改\":\"新增\")+e.Entity.Label,e.Styles.EditPage=e.Styles.EditPage||\"EditPage\",e}return _inherits(i,e),_createClass(i,[{key:\"PageInit\",value:function(){t.data.Index.InitEditPageEntityState(this.KeyName),this.Entity.ExpandPageInit&&this.Entity.ExpandPageInit.call(this,t),this.EditProperties=this.Entity.Properties.filter(function(t){return t.IsEdit}).map(function(t){return Object.assign({IsVisible:!0},t,t.EditOptions)}),this.EditLayout=new a(this.GetEditComponents()),this.IndexAction=new t.actions.Index(this)}},{key:\"GetEditComponents\",value:function(){return this.EditComponents=this.EditProperties.filter(function(t){return t.IsVisible}).map(function(t){return new s({Property:t})}),{ComponentList:this.EditComponents}}},{key:\"PageLoad\",value:function(){if(this.IsDialog){var e=this.GetHtml(),n=this.Width>0?this.Width:this.EditLayout.Width,i=this.Height>0?this.Height:this.EditLayout.Height;this.EditDialog=new t.components.Dialog({Width:n,Height:i,Html:e,Title:this.Title,OkAction:this.IsUpdate?new l(this):new r(this)}),this.EditDialog.Show()}else HtmlTag.SetHtml(document.body,this.GetHtml());this.EventLoad(),this.DataLoad()}},{key:\"GetHtml\",value:function(){var t=[];return t.push('<div class=\"'+this.Styles.EditPage+'\">'),t.push(this.EditLayout.GetHtml()),t.push(\"</div>\"),t.join(\"\")}},{key:\"EventLoad\",value:function(){this.EditComponents.forEach(function(t){return t.EventLoad()})}},{key:\"DataLoad\",value:function(){var t=this;this.EditComponents.forEach(function(t){return t.DataLoad()}),this.IsUpdate&&(this.IsLocalData?this.EditComponents.forEach(function(e){return e.SetValue(t.RowData[e.Property.Name])}):this.GetEntityData())}},{key:\"GetEntityData\",value:function(){var e=this;this.IndexAction.GetEntityData(this.Entity,this.EditProperties.map(function(t){return t.Name}),this.RowData[this.Entity.PrimaryKey]).then(function(i){if(i.IsSuccess){var s=n.ArrayFirst(i.Data.DataList);s&&(e.EntityData=s,e.Entity.ExpandGetEditData&&e.Entity.ExpandGetEditData.call(e,s,t),e.EditComponents.forEach(function(t){return t.SetValue(s[t.Property.Name])}))}else n.Alert(i.Message)})}},{key:\"GetEditData\",value:function(){var e={};this.IsUpdate&&(e[this.Entity.PrimaryKey]=this.RowData[this.Entity.PrimaryKey],e.RowVersion=this.RowData.RowVersion);for(var i=!0,s=\"\",a=null,o=0;o<this.EditComponents.length;o++){if(a=this.EditComponents[o],s=a.GetValue(),!1===a.Validate(s,e)){i=!1;break}n.IsNullOrEmpty(s)?this.IsUpdate&&!a.IsPassword&&(e[a.Property.Name]=null):e[a.Property.Name]=s}return!!i&&(this.Entity.ExpandSetEditData&&(e=this.Entity.ExpandSetEditData.call(this,e,this.IsUpdate,t)),!1!==e&&((!this.IsUpdate||!this.CompareValueEquals(e))&&e))}},{key:\"CompareValueEquals\",value:function(t){if(!this.EntityData)return!1;var e=!0;for(var i in t)if(i!=this.Entity.PrimaryKey&&\"RowVersion\"!=i&&!n.IsEquals(this.EntityData[i],t[i])){e=!1;break}return e&&n.Alert(\"对不起，您未对信息进行编辑！\"),e}},{key:\"ClearControlValue\",value:function(){this.EditComponents.forEach(function(t){return t.SetValue(\"\")})}}]),i}(e)}($ns);"}]}}
                  EntityName:DataAccess
                  MethodName:Update
                   IPAddress:::1
               OperationUser:
                   StartTime:2017-08-03 16:29:28.062
                     EndTime:2017-08-03 16:29:28.127
         ElapsedMilliseconds:65



Response:
{"Ack":{"IsSuccess":true,"StatusCode":0,"StatusMessage":""},"Data":{"RequestType":"Update","Ids":"d76334de-553c-4cb4-8f71-913691994629"}}
