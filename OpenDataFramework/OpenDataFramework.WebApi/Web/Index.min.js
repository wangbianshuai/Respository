"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),$ns={utils:{},actions:{},api:{},data:{},layouts:{},controls:{},components:{},pages:{}};window.OpenDataFramework=$ns,function(t){t.utils.Common=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"CreateGuid",value:function(){for(var t="",e=1;e<=32;e++){t+=Math.floor(16*Math.random()).toString(16),8!==e&&12!==e&&16!==e&&20!==e||(t+="-")}return t}},{key:"IsNullOrEmpty",value:function(t){return null===t||void 0===t||""===e.Trim(t.toString())}},{key:"Trim",value:function(t){return void 0===t||null===t?"":t.toString().replace(/(^\s*)|(\s*$)/g,"").replace(new RegExp("(^　*)|(　*$)","g"),"")}},{key:"AddUrlRandom",value:function(t){if(e.IsNullOrEmpty(t))return"";var i=e.GetRandomChars(),n=Math.random();return t+=t.indexOf("?")>0?"&":"?",t+="_r"+i+"="+n}},{key:"GetRandomChars",value:function(t){t=t||10;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz",i=[],n=0;n<t;n++)i.push(e.charAt(Math.floor(Math.random()*e.length)));return i.join("")}},{key:"InitValue",value:function(t,e,i){e.forEach(function(e){t[e]=void 0===t[e]?i:t[e]})}},{key:"Alert",value:function(e){return new t.components.AlertConfirm({Message:e}).Show()}},{key:"Confirm",value:function(e){return new t.components.AlertConfirm({Message:e,IsConfirm:!0}).Show()}},{key:"ArrayFirst",value:function(t){return t&&t.length>0?t[0]:null}},{key:"IsArray",value:function(t){return null!==t&&void 0!==t&&("object"===(void 0===t?"undefined":_typeof(t))&&t.length>=0)}},{key:"IsObject",value:function(t){return null!==t&&void 0!==t&&("object"==(void 0===t?"undefined":_typeof(t))&&"[object object]"==Object.prototype.toString.call(t).toLowerCase()&&!t.length)}},{key:"IsEquals",value:function(t,i,n){if(void 0===t&&void 0===i)return!0;if(null===t&&null===i)return!0;if(t===i)return!0;var a=e.IsArray(t),s=e.IsArray(i),o=e.IsObject(t),r=e.IsObject(i);if(a&&!s||!a&&s)return!1;if(o&&!r||!o&&r)return!1;if(a&&s)return e.IsArrayEquals(t,i);if(o&&r)return e.IsObjectEquals(t,i);var u=e.IsNullOrEmpty(t)?"":t.toString(),l=e.IsNullOrEmpty(i)?"":i.toString();return n?u.toLowerCase()===l.toLowerCase():u===l}},{key:"IsArrayEquals",value:function(t,i){if(t===i)return!0;if(t.length!=i.length)return!1;for(var n=!0,a=0;a<t.length&&(n=e.IsObjectEquals(t[a],i[a]));a++);return n}},{key:"IsObjectEquals",value:function(t,i){if(t===i)return!0;var n=!0;for(var a in t)if(!(n=e.IsEquals(t[a],i[a])))break;if(n)for(var s in i)if(void 0===t[s]){n=!1;break}return n}},{key:"GetQueryString",value:function(t){var e={};t=t||location.search.substring(1);for(var i=t.split("&"),n=0;n<i.length;n++){var a=i[n].indexOf("=");if(-1!==a){var s=i[n].substring(0,a),o=i[n].substring(a+1);e[s]=unescape(o)}}return e}},{key:"SetStorage",value:function(t,e,i){try{if(i=i||0,localStorage.setItem(t,e),i>0){t+="_Time";var n=((new Date).getTime()+60*i*1e3).toString()+"_"+i.toString();localStorage.setItem(t,n)}}catch(t){}}},{key:"GetStorage",value:function(t){var i="";try{i=localStorage.getItem(t);var n=t+"_Time",a=localStorage.getItem(n);if(!e.IsNullOrEmpty(a)){var s=a.split("_"),o=parseFloat(s[0]),r=parseFloat(s[1]);if(o>0){(new Date).getTime()>o?(i="",localStorage.removeItem(t),localStorage.removeItem(n)):(o=((new Date).getTime()+60*r*1e3).toString()+"_"+r.toString(),localStorage.setItem(n,o))}}}catch(t){}return e.IsNullOrEmpty(i)?"":i}},{key:"ClearStorage",value:function(){localStorage.clear()}},{key:"Split",value:function(t,i){if(e.IsNullOrEmpty(t))return[];t=e.RemoveWhiteEnter(t);var n=[],a=[t];return i.forEach(function(t){n=a,a=[],n.forEach(function(e){a=a.concat(e.split(t))})}),a}},{key:"GetZIndex",value:function(){return e.ZIndex=e.ZIndex||1e3,e.ZIndex+=1,e.ZIndex}},{key:"ComputeStringWidth",value:function(t){if(e.IsNullOrEmpty(t))return 0;for(var i=0,n=-1,a=0;a<t.length;a++)n=t.charCodeAt(a),i+=n>=0&&n<=128?1:2;return 6*i}},{key:"GetNumberValue",value:function(t){if(e.IsNullOrEmpty(t))return 0;t=t.toString().replace(/,/g,""),t=t.replace(/M/g,"");var i=parseFloat(t);return isNaN(i)?0:i}},{key:"GetBoolValue",value:function(t){if(e.IsNullOrEmpty(t))return!1;var i=t.toString().toLowerCase();return"true"===i||"1"===i}},{key:"GetObjectValue",value:function(t,i,n){var a={};i&&i.length>0&&i.forEach(function(i){e.IsNullOrEmpty(t[i])||(a[i]=e.GetNumberValue(t[i]))}),n&&n.length>0&&n.forEach(function(i){return a[i]=e.GetBoolValue(t[i])});for(var s in t)void 0===a[s]&&(a[s]=t[s]);return a}},{key:"RemoveWhiteEnter",value:function(t){for(t=t.replace(/\n/g,"");t.indexOf("  ")>=0;)t=t.replace(/  /g," ");return e.Trim(t)}},{key:"IsFirefox",value:function(){return new RegExp("firefox").test(navigator.userAgent.toLowerCase())}},{key:"GetCurrentDate",value:function(t){var i=new Date;return t?e.GetDateStringByMilliSeconds(i):e.GetDateString(i)}},{key:"GetCurrentDateNumber",value:function(){var t=new Date,e=t.getFullYear().toString(),i=t.getMonth()+1;i=i<10?"0"+i.toString():i.toString();var n=t.getDate();n=n<10?"0"+n.toString():n.toString();var a=t.getHours();a=a<10?"0"+a.toString():a.toString();var s=t.getMinutes();s=s<10?"0"+s.toString():s.toString();var o=t.getSeconds();o=o<10?"0"+o.toString():o.toString();var r=t.getMilliseconds();return r=r<10?"00"+r.toString():r<100?"0"+r.toString():r.toString(),e+i+n+a+s+o+r}},{key:"ConvertToDate",value:function(t,i){var n,a,s,o,r,u,l,h,c;return void 0!==i&&("yyyy-MM-dd"!==i.substring(0,10)&&"yyyy/MM/dd"!==i.substring(0,10)||(n=t.substring(0,4),a=t.substring(5,7),s=t.substring(8,10),c=a+"-"+s+"-"+n,i.length>10&&(l=e.Trim(i.substring(10,i.length))),i.length>10&&(h=e.Trim(t.substring(10,t.length)))),"MM-dd-yyyy"!==i.substring(0,10)&&"MM/dd/yyyy"!==i.substring(0,10)||(n=t.substring(6,10),a=t.substring(0,2),s=t.substring(3,5),c=a+"-"+s+"-"+n,i.length>10&&(l=e.Trim(i.substring(10,i.length))),i.length>10&&(h=e.Trim(t.substring(10,t.length)))),"yyyyMMdd"===i.substring(0,8)&&(n=t.substring(0,4),a=t.substring(4,6),s=t.substring(6,8),c=a+"-"+s+"-"+n,i.length>8&&(l=e.Trim(i.substring(8,i.length))),i.length>8&&(h=e.Trim(t.substring(8,t.length)))),"MMddyyyy"===i.substring(0,8)&&(n=t.substring(4,8),a=t.substring(0,2),s=t.substring(2,4),c=a+"-"+s+"-"+n,i.length>8&&(l=e.Trim(i.substring(8,i.length))),i.length>8&&(h=e.Trim(t.substring(8,t.length)))),e.IsNullOrEmpty(h)||e.IsNullOrEmpty(l)||(e.IsNullOrEmpty(l)||"HH:mm:ss"!==l?e.IsNullOrEmpty(l)||"HHmmss"!=l||(o=h.substring(0,2),r=h.substring(2,4),u=h.substring(4,6),c+=" "+o+":"+r+":"+u):(o=h.substring(0,2),r=h.substring(3,5),u=h.substring(6,8),c+=" "+o+":"+r+":"+u)),e.IsNullOrEmpty(c)||(t=c)),e.IsFirefox()?e.IsNullOrEmpty(c)?new Date(t):e.IsNullOrEmpty(h)||e.IsNullOrEmpty(l)?new Date(n,a,s):new Date(n,a,s,o,r,u):new Date(t)}},{key:"GetDateString",value:function(t,e){var i=t.getFullYear().toString(),n=t.getMonth()+1;n=n<10?"0"+n.toString():n.toString();var a=t.getDate();if(a=a<10?"0"+a.toString():a.toString(),e)return i+"-"+n+"-"+a;var s=t.getHours();s=s<10?"0"+s.toString():s.toString();var o=t.getMinutes();o=o<10?"0"+o.toString():o.toString();var r=t.getSeconds();return r=r<10?"0"+r.toString():r.toString(),i+"-"+n+"-"+a+" "+s+":"+o+":"+r}},{key:"GetDateStringByMilliSeconds",value:function(t,e){var i=t.getFullYear().toString(),n=t.getMonth()+1;n=n<10?"0"+n.toString():n.toString();var a=t.getDate();if(a=a<10?"0"+a.toString():a.toString(),e)return i+"-"+n+"-"+a;var s=t.getHours();s=s<10?"0"+s.toString():s.toString();var o=t.getMinutes();o=o<10?"0"+o.toString():o.toString();var r=t.getSeconds();r=r<10?"0"+r.toString():r.toString();var u=t.getMilliseconds();return u=u<10?"00"+u.toString():u<100?"0"+u.toString():u.toString(),i+"-"+n+"-"+a+" "+s+":"+o+":"+r+"."+u}},{key:"GetYestoday",value:function(t){var e=t.getTime()-864e5,i=new Date;i.setTime(e);var n=i.getFullYear(),a=i.getDate(),s=i.getMonth()+1;return s<10&&(s="0"+s),a<10&&(a="0"+a),n+"-"+s+"-"+a}},{key:"GetLastMonthYestoday",value:function(t){var e=[31,28,31,30,31,30,31,31,30,31,30,31],i=t.getFullYear(),n=t.getDate(),a=t.getMonth()+1;return i%4==0&&i%100!=0&&(e[1]=29),a-1==0?(i-=1,a=12):a-=1,n=e[a-1]>=n?n:e[a-1],a<10&&(a="0"+a),n<10&&(n="0"+n),i+"-"+a+"-"+n}},{key:"ToLogin",value:function(){window.location.href="Index.aspx"}},{key:"AddURLParameter",value:function(t,e,i){return t.indexOf("?")>0?t+="&"+e+"="+escape(i):t+="?"+e+"="+escape(i)}},{key:"IsDecimal",value:function(t){return new RegExp("^-?\\d+$|^(-?\\d+)(\\.\\d+)?$").test(t)}},{key:"IsDecimal1",value:function(t){return new RegExp("^-?\\d+$|^(-?\\d+)(\\.\\d{1})?$").test(t)}},{key:"IsDecimal2",value:function(t){return new RegExp("^-?\\d+$|^(-?\\d+)(\\.\\d{1})?$|^(-?\\d+)(\\.\\d{2})?$").test(t)}},{key:"IsDecimal3",value:function(t){return new RegExp("^-?\\d+$|^(-?\\d+)(\\.\\d{1})?$|^(-?\\d+)(\\.\\d{2})?$|^(-?\\d+)(\\.\\d{3})?$").test(t)}},{key:"IsDecimal4",value:function(t){return new RegExp("^-?\\d+$|^(-?\\d+)(\\.\\d{1})?$|^(-?\\d+)(\\.\\d{2})?$|^(-?\\d+)(\\.\\d{3})?$|^(-?\\d+)(\\.\\d{4})?$").test(t)}},{key:"IsDecimalCharCode",value:function(t){var e=window.event?t.keyCode:t.which,i=String.fromCharCode(e);return new RegExp("\\d|\\.|\\-").test(i)}},{key:"IsNumberCharCode",value:function(t){var e=window.event?t.keyCode:t.which,i=String.fromCharCode(e);return new RegExp("\\d|\\-").test(i)}},{key:"IsNaturalNumberCharCode",value:function(t){var e=window.event?t.keyCode:t.which,i=String.fromCharCode(e);return new RegExp("\\d").test(i)}},{key:"IsNumber",value:function(t){return new RegExp("^-?\\d+$").test(t)}},{key:"ToCurrency",value:function(t,e){e=void 0===e||e;var i=isNaN(t)?parseFloat(t):t;if(isNaN(i))return t;for(var n=e?i.toFixed(2):i.toString(),a=/(\d+)(\d{3})/;a.test(n);)n=n.replace(a,"$1,$2");return n}},{key:"ReplaceHtmlTag",value:function(t){return t?"string"!=typeof t?t:(t=t.replace(/</g,"&lt;"),t.replace(/>/g,"&gt;")):""}},{key:"Assign",value:function(t,i,n){if(!e.IsObject(t))return t;var a=[];if(e.IsObject(i))for(var s in i)t[s]=e.Clone(i[s],a);if(e.IsObject(n))for(var o in n)t[o]=e.Clone(n[o],a);return t}},{key:"ArrayClone",value:function(t,i){if(!e.IsArray(t))return t;for(var n=[],a=0;a<t.length;a++)n.push(e.Clone(t[a],i));return n}},{key:"Clone",value:function(t,i){if(e.IsArray(t))return e.ArrayClone(t,i);if(!e.IsObject(t))return t;for(var n=!1,a=0;a<i.length;a++)if(i[a]===t){n=!0;break}if(n)return t;i.push(t);var s={};for(var o in t)e.IsArray(t[o])?s[o]=e.ArrayClone(t[o],i):e.IsObject(t[o])?s[o]=e.Clone(t[o],i):s[o]=t[o];return s}}]),e}(),Object.assign=Object.assign||Common.Assign}($ns),function(t){var e=t.utils.Common;t.utils.HtmlTag=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"GetById",value:function(t){return document.getElementById(t)}},{key:"SetHtml",value:function(t,e){t&&void 0!==e&&(t.innerHTML=e)}},{key:"BindEvent",value:function(e,i,n,a){if(e){var s=i.split("."),o="";2===s.length?(i=s[0],o=s[1]):o=i,void 0===e["Event_"+i]&&(e["Event_"+i]={EventAction:function(t){var e=!0,i=null;r.EventList.forEach(function(n){!1===(i=n.Action(t))&&(e=i)}),!1===e&&(t.preventDefault(),t.returnValue=e,t.cancel=!e)},EventList:[]});var r=e["Event_"+i];if(a)if(1===r.EventList.length)t.RemoveEvent(e,i,r.EventAction),r.EventList=[];else{for(var u=-1,l=0;l<r.EventList.length;l++)if(r.EventList[l].Name===o){u=l;break}u>=0&&r.EventList.splice(u,1)}else{0===r.EventList.filter(function(t){return t.Name===o}).length&&r.EventList.push({Name:o,Action:n}),1===r.EventList.length&&t.AddEvent(e,i,r.EventAction)}}}},{key:"OffBindEvent",value:function(e,i){t.BindEvent(e,i,null,!0)}},{key:"AddEvent",value:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}},{key:"RemoveEvent",value:function(t,e,i){t.detachEvent?t.detachEvent("on"+e,i):t.removeEventListener?t.removeEventListener(e,i,!1):t["on"+e]=null}},{key:"SetAttribute",value:function(t,e,i){t&&t.setAttribute&&t.setAttribute(e,i)}},{key:"GetAttribute",value:function(t,e){return t&&t.getAttribute?t.getAttribute(e):null}},{key:"GetElement",value:function(e){return"string"==typeof e?t.GetById(e):e}},{key:"GetValue",value:function(i){return i=t.GetElement(i),i&&i.value?e.Trim(i.value):""}},{key:"SetValue",value:function(e,i){(e=t.GetElement(e))&&(e.value=i)}},{key:"SetDisabled",value:function(e,i){(e=t.GetElement(e))&&(e.disabled=i)}},{key:"GetDisabled",value:function(e){return!!(e=t.GetElement(e))&&e.disabled}},{key:"Find",value:function(e,i){if(!e||!i||!e.hasChildNodes())return null;var n=i.split(">"),a=n[0];n.splice(0,1);for(var s=[],o=null,r=0;r<e.childNodes.length;r++)o=e.childNodes[r],o.nodeName.toLowerCase()===a.toLowerCase()&&s.push(o);if(n.length>0){i=n.join(">");var u=[],l=null;return s.forEach(function(e){null!=(l=t.Find(e,i))&&(u=u.concat(l))}),u}return s}},{key:"AppendHtml",value:function(e,i){var n=document.createElement("div");for(t.SetHtml(n,i);n.childNodes.length>0;)e.appendChild(n.childNodes[0])}},{key:"GetElementsByTagName",value:function(t,e){return t&&t.getElementsByTagName(e)}},{key:"SetHide",value:function(t){t&&t.style&&(t.style.display="none")}},{key:"SetShow",value:function(t){t&&t.style&&(t.style.display="")}},{key:"GetBodyWidth",value:function(){return document.body.offsetWidth}},{key:"GetWindowWidth",value:function(){return window.screen.availWidth}},{key:"GetBodyHeight",value:function(){return document.body.offsetHeight}},{key:"GetWindowHeight",value:function(){return window.screen.availHeight}},{key:"GetWindowWidth",value:function(){return window.innerWidth}},{key:"GetWindowHeight",value:function(){return window.innerHeight}},{key:"GetWidth",value:function(e){return e&&e.style?""===e.style.width?null!==e.parentNode?t.GetWidth(e.parentNode):t.GetBodyWidth():e.style.width.indexOf("%")>0?t.GetWidth(e.parentNode)*parseFloat(e.style.width)/100:parseFloat(e.style.width):e.body?t.GetBodyWidth():0}},{key:"SetWidth",value:function(t,e){if(t&&t.style){var i=parseFloat(e);isNaN(i)||(t.style.width=i.toString()+"px")}}},{key:"GetHeight",value:function(e){return e&&e.style?""===e.style.height?null!==e.parentNode?t.GetHeight(e.parentNode):t.GetBodyHeight():e.style.height.indexOf("%")>0?t.GetHeight(e.parentNode)*parseFloat(e.style.height)/100:parseFloat(e.style.height):e.body?t.GetBodyHeight():0}},{key:"SetHeight",value:function(t,e){if(t&&t.style){var i=parseFloat(e);isNaN(i)||(t.style.height=i.toString()+"px")}}},{key:"SetStyle",value:function(t,e){if(t&&t.style&&e)for(var i in e)t.style[i]=e[i]}},{key:"SetStyleValue",value:function(t,e,i){t&&t.style&&(t.style[e]=i)}},{key:"RemoveClass",value:function(t,i){t&&void 0!==t.className&&(t.className=e.Trim(t.className.replace(new RegExp(i,"g"),"").replace(new RegExp("  ","g"),"")))}},{key:"AddClass",value:function(t,i){if(t&&void 0!==t.className){var n=e.Trim(t.className).replace(new RegExp(i,"g"),"").replace(new RegExp("  ","g"),"");n=n+" "+i,t.className=e.Trim(n)}}},{key:"RemoveElement",value:function(t,e){if(t&&e&&t.removeChild&&t.hasChildNodes)if(t.contains)t.contains(e)&&t.removeChild(e);else{for(var i=!1,n=0;n<t.childNodes.length;n++)if(t.childNodes[n]===e){i=!0;break}i&&t.removeChild(e)}}},{key:"GetOffSet",value:function(e){if(e){var i=t.GetTopLeft(e.parentNode);return{top:e.offsetTop+i.top,left:e.offsetLeft+i.left,width:e.offsetWidth,height:e.offsetHeight}}return null}},{key:"GetTopLeft",value:function(e,i){return i=i||{top:0,left:0},e&&"absolute"===t.GetStyleValue(e,"position")?i={top:i.top+parseFloat(e.style.top),left:i.left+parseFloat(e.style.left)}:e&&e!==document.body?t.GetTopLeft(e.parentNode,i):i}},{key:"GetStyleValue",value:function(e,i){if(!e)return"";if(e.style&&e.style[i])return e.style[i];var n=t.GetStyles(e);return n&&n[i]?n[i]:""}},{key:"ComputeStringWidth",value:function(i){if(e.IsNullOrEmpty(i))return 0;t.SpanId=t.SpanId||e.CreateGuid();var n=t.GetById(t.SpanId);null===n&&(n=document.createElement("span"),n.id=t.SpanId,n.style.visibility="hidden",document.body.appendChild(n)),n.innerHTML="";var a=n.offsetWidth;return n.innerHTML=i,a=n.offsetWidth-a,n.innerHTML="",a}},{key:"GetStyles",value:function(t){return t?t.ownerDocument?t.ownerDocument.defaultView.getComputedStyle(t):t.currentStyle?t.currentStyle:null:null}}]),t}()}($ns),function(t){function e(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function i(t,e){return t<<e|t>>>32-e}function n(t,n,a,s,o,r){return e(i(e(e(n,t),e(s,r)),o),a)}function a(t,e,i,a,s,o,r){return n(e&i|~e&a,t,e,s,o,r)}function s(t,e,i,a,s,o,r){return n(e&a|i&~a,t,e,s,o,r)}function o(t,e,i,a,s,o,r){return n(e^i^a,t,e,s,o,r)}function r(t,e,i,a,s,o,r){return n(i^(e|~a),t,e,s,o,r)}function u(t,i){t[i>>5]|=128<<i%32,t[14+(i+64>>>9<<4)]=i;var n,u,l,h,c,d=1732584193,f=-271733879,p=-1732584194,v=271733878;for(n=0;n<t.length;n+=16)u=d,l=f,h=p,c=v,d=a(d,f,p,v,t[n],7,-680876936),v=a(v,d,f,p,t[n+1],12,-389564586),p=a(p,v,d,f,t[n+2],17,606105819),f=a(f,p,v,d,t[n+3],22,-1044525330),d=a(d,f,p,v,t[n+4],7,-176418897),v=a(v,d,f,p,t[n+5],12,1200080426),p=a(p,v,d,f,t[n+6],17,-1473231341),f=a(f,p,v,d,t[n+7],22,-45705983),d=a(d,f,p,v,t[n+8],7,1770035416),v=a(v,d,f,p,t[n+9],12,-1958414417),p=a(p,v,d,f,t[n+10],17,-42063),f=a(f,p,v,d,t[n+11],22,-1990404162),d=a(d,f,p,v,t[n+12],7,1804603682),v=a(v,d,f,p,t[n+13],12,-40341101),p=a(p,v,d,f,t[n+14],17,-1502002290),f=a(f,p,v,d,t[n+15],22,1236535329),d=s(d,f,p,v,t[n+1],5,-165796510),v=s(v,d,f,p,t[n+6],9,-1069501632),p=s(p,v,d,f,t[n+11],14,643717713),f=s(f,p,v,d,t[n],20,-373897302),d=s(d,f,p,v,t[n+5],5,-701558691),v=s(v,d,f,p,t[n+10],9,38016083),p=s(p,v,d,f,t[n+15],14,-660478335),f=s(f,p,v,d,t[n+4],20,-405537848),d=s(d,f,p,v,t[n+9],5,568446438),v=s(v,d,f,p,t[n+14],9,-1019803690),p=s(p,v,d,f,t[n+3],14,-187363961),f=s(f,p,v,d,t[n+8],20,1163531501),d=s(d,f,p,v,t[n+13],5,-1444681467),v=s(v,d,f,p,t[n+2],9,-51403784),p=s(p,v,d,f,t[n+7],14,1735328473),f=s(f,p,v,d,t[n+12],20,-1926607734),d=o(d,f,p,v,t[n+5],4,-378558),v=o(v,d,f,p,t[n+8],11,-2022574463),p=o(p,v,d,f,t[n+11],16,1839030562),f=o(f,p,v,d,t[n+14],23,-35309556),d=o(d,f,p,v,t[n+1],4,-1530992060),v=o(v,d,f,p,t[n+4],11,1272893353),p=o(p,v,d,f,t[n+7],16,-155497632),f=o(f,p,v,d,t[n+10],23,-1094730640),d=o(d,f,p,v,t[n+13],4,681279174),v=o(v,d,f,p,t[n],11,-358537222),p=o(p,v,d,f,t[n+3],16,-722521979),f=o(f,p,v,d,t[n+6],23,76029189),d=o(d,f,p,v,t[n+9],4,-640364487),v=o(v,d,f,p,t[n+12],11,-421815835),p=o(p,v,d,f,t[n+15],16,530742520),f=o(f,p,v,d,t[n+2],23,-995338651),d=r(d,f,p,v,t[n],6,-198630844),v=r(v,d,f,p,t[n+7],10,1126891415),p=r(p,v,d,f,t[n+14],15,-1416354905),f=r(f,p,v,d,t[n+5],21,-57434055),d=r(d,f,p,v,t[n+12],6,1700485571),v=r(v,d,f,p,t[n+3],10,-1894986606),p=r(p,v,d,f,t[n+10],15,-1051523),f=r(f,p,v,d,t[n+1],21,-2054922799),d=r(d,f,p,v,t[n+8],6,1873313359),v=r(v,d,f,p,t[n+15],10,-30611744),p=r(p,v,d,f,t[n+6],15,-1560198380),f=r(f,p,v,d,t[n+13],21,1309151649),d=r(d,f,p,v,t[n+4],6,-145523070),v=r(v,d,f,p,t[n+11],10,-1120210379),p=r(p,v,d,f,t[n+2],15,718787259),f=r(f,p,v,d,t[n+9],21,-343485551),d=e(d,u),f=e(f,l),p=e(p,h),v=e(v,c);return[d,f,p,v]}function l(t){var e,i="",n=32*t.length;for(e=0;e<n;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function h(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var n=8*t.length;for(e=0;e<n;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function c(t){return l(u(h(t),8*t.length))}function d(t,e){var i,n,a=h(t),s=[],o=[];for(s[15]=o[15]=void 0,a.length>16&&(a=u(a,8*t.length)),i=0;i<16;i+=1)s[i]=909522486^a[i],o[i]=1549556828^a[i];return n=u(s.concat(h(e)),512+8*e.length),l(u(o.concat(n),640))}function f(t){var e,i,n="0123456789abcdef",a="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),a+=n.charAt(e>>>4&15)+n.charAt(15&e);return a}function p(t){return unescape(encodeURIComponent(t))}function v(t){return c(p(t))}function g(t){return f(v(t))}function y(t,e){return d(p(t),p(e))}function m(t,e){return f(y(t,e))}function C(t,e,i){return e?i?y(e,t):m(e,t):i?v(t):g(t)}t.utils.Common.ComputeMd5=function(t,e,i){return C(t,e,i).toUpperCase()}}($ns),function(t){var e=t.utils.Common;t.api.Index=function(){function t(i){_classCallCheck(this,t),this.Id=e.CreateGuid(),i&&Object.assign(this,i)}return _createClass(t,[{key:"PostFetch",value:function(t,e){var i=this;return fetch(this.GetFullUrl(t,e),{method:"POST",body:JSON.stringify(e)}).then(function(t){return i.SetResult(t).then(function(t){return i.GetResponse(t)})})}},{key:"PostStreamFetch",value:function(t,i){var n=this;return fetch(e.AddUrlRandom(t),{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:i}).then(function(t){return n.SetResult(t).then(function(t){return n.GetResponse(t)})})}},{key:"GetResponse",value:function(t){if(t&&t.Ack){if(t.Ack.IsSuccess)return Promise.resolve(t.Data);if(t.Ack.StatusMessage)return Promise.reject(t.Ack.StatusMessage)}return Promise.reject("请求异常！")}},{key:"SetResult",value:function(t){return t.ok?t.json():Promise.reject(t.status+":"+(t.statusText?t.statusText:"请求错误！"))}},{key:"GetFullUrl",value:function(t,i){if(t=this.GetRootPath()+t,"UserLogin"===i.EntityName)i.EntityName="User",t=e.AddURLParameter(t,"IsLogin","true");else{var n=e.GetStorage("LoginUserId");n||e.ToLogin(),t=e.AddURLParameter(t,"LoginUserId",n)}return e.AddUrlRandom(t)}},{key:"GetRootPath",value:function(){return"api/"}}]),t}()}($ns),function(t){var e=t.api.Index;t.api.DataAccess=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"Request",value:function(t,e,i){var n={EntityName:e,Request:i};return this.PostFetch("DataAccess/"+t,n)}},{key:"Query",value:function(t,e){return this.Request("Query",t,e)}},{key:"Create",value:function(t,e){return this.Request("Create",t,e)}},{key:"Update",value:function(t,e){return this.Request("Update",t,e)}},{key:"Delete",value:function(t,e){return this.Request("Delete",t,e)}}]),e}(e)}($ns),function(t){var e=[],i=[],n={};t.data.Index=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"AddStatePool",value:function(i){t.SetState(i),e.push(i)}},{key:"SetState",value:function(t,e){for(var i in t)n[i]=t[i](n[i],e)}},{key:"GetState",value:function(){return n}},{key:"Dispatch",value:function(a){e.forEach(function(e){return t.SetState(e,a)}),i.forEach(function(t){return t(n)})}},{key:"Connect",value:function(t){t(n),i.push(t)}},{key:"GetStateValue",value:function(t,e,i,n){if(t[e]){var a=t[e][i];if(n!==a)return Promise.resolve(a)}return Promise.resolve(null)}}]),t}()}($ns),function(t){t.data.Index.InitListPageEntityState=function(e){var i={},n={QueryResponse:null,DeleteResponse:null,ListEditResponse:null};i[e]=function(t,i){if(!i)return n;switch(i.type){case e+"_Search_Data":return t.QueryResponse=i.data,t;case e+"_Delete":return t.DeleteResponse=i.data,t;case e+"_Update":return t.ListEditResponse=i.data,t;default:return t}},t.data.Index.AddStatePool(i)}}($ns),function(t){t.data.Index.InitEditPageEntityState=function(e){var i={},n={EditResponse:null};i[e]=function(t,i){if(!i)return n;switch(i.type){case e+"_Create":case e+"_Update":return t.EditResponse=i.data,t;default:return t}},t.data.Index.AddStatePool(i)}}($ns),function(t){var e=t.utils.Common;t.data.Cache=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"GetDataList",value:function(e,n,a,s){var o=i.GetCache(e);return o?Promise.resolve(o):new t.actions.Index(i).GetDataList(n,a,s).then(function(t){return t.IsSuccess?(i.SetCache(e,n,a,s,t.Data.DataList),Promise.resolve(t.Data.DataList)):Promise.resolve(null)})}},{key:"GetCache",value:function(t){var i=e.GetStorage(t);return e.IsNullOrEmpty(i)?null:JSON.parse(i)}},{key:"SetCache",value:function(t,n,a,s,o){i.CacheList=i.CacheList||i.GetCacheList(),0===i.CacheList.filter(function(e){return e.CacheName===t}).length&&i.CacheList.push({CacheName:t,EntityName:n,SelectNames:a,Conditions:s}),e.SetStorage("$CacheConfigList",JSON.stringify(i.CacheList)),e.SetStorage(t,JSON.stringify(o))}},{key:"GetCacheList",value:function(){return i.GetCache("$CacheConfigList")||[]}},{key:"UpdateEntityCacheList",value:function(t){i.CacheList=i.CacheList||i.GetCacheList(),i.CacheList.filter(function(e){return e.EntityName===t}).forEach(function(t){e.SetStorage(t.CacheName,""),i.GetDataList(t.CacheName,t.EntityName,t.SelectNames,t.Conditions)})}},{key:"GetPropertyDataList",value:function(n){if(n.DataSource){var a=n.DataSource,s=a.CacheName,o=a.EntityName,r=a.SelectNames,u=a.Conditions,l=a.TextName,h=a.ValueName;n.ValueName=h,n.TextName=l;var c=s||o,d=u||[];return i.GetDataList(c,o,r,d).then(function(i){n.DataList=i||[];var a=e.Split(n.TextName,[",",";","，","；"]);if(a.length>1){var s=[];n.DataList.forEach(function(t){s=[],a.forEach(function(i){return s.push(e.IsNullOrEmpty(t[i])?"":t[i])}),t[n.TextName]=s.join("/")})}return n.ExpandSetDataList&&(n.DataList=n.ExpandSetDataList(n.DataList,t)),Promise.resolve()})}}}]),i}()}($ns),function(t){var e=t.utils.Common,i=t.api.DataAccess,n=t.data.Index,a=n.Dispatch,s=n.GetStateValue;t.actions.Index=function(){function n(t){_classCallCheck(this,n),this.Id=e.CreateGuid(),this.EventNames=["click"],this.Target=t,this.Api=new i}return _createClass(n,[{key:"Invoke",value:function(t,e){}},{key:"DispatchAction",value:function(t){return function(e,i,n){return t().then(function(t){return n&&n(t),e&&e({type:i,data:t}),Promise.resolve({IsSuccess:!0,Data:t})},function(t){var n=t&&t.message?t.message:t;return e&&e({type:i,data:{ActionFailedMessage:n}}),Promise.resolve({IsSuccess:!1,Message:n})})}}},{key:"Edit",value:function(t,i){var n=this.Target,a=(n.Entity,n.EditDialog),s=this.Target.GetEditData();if(!1!==s){if(2===t.Type&&(s.DataStatus=1),this.Target.IsLocalData)return i||(s[this.Target.Entity.PrimaryKey]=e.CreateGuid()),this.Target.SaveData(s),this.Target.ClearControlValue(),void a.Close();this.EditEntityData(t,[s],i,this.Target)}}},{key:"EditEntityData",value:function(i,n,s,o){var r=this;i.SetDisabled(!0);var u=o.Entity,l=o.KeyName,h=o.EditDialog,c={Data:n},d=s?"Update":"Create";this.DispatchAction(function(){return r.Api[d](u.Name,c)})(a,l+"_"+d).then(function(n){n.IsSuccess?(e.Alert("操作成功！").then(function(){o.ClearControlValue(),h.Close()}),t.data.Cache.UpdateEntityCacheList(u.Name)):e.Alert(n.Message).then(function(){return i.SetDisabled(!1)})})}},{key:"EditData",value:function(t,e,i){var n=this,a=i?"Update":"Create",s={Data:e};return this.DispatchAction(function(){return n.Api[a](t,s)})()}},{key:"GetDataValue",value:function(t,e,i){var n=this;return s(t,e,i,this[i]).then(function(t){return null!=t&&(n[i]=t),Promise.resolve(null!=t)})}},{key:"GetDataList",value:function(t,e,i){var n=this,a={SelectNames:e,Conditions:i};return this.DispatchAction(function(){return n.Api.Query(t,a)})()}},{key:"GetEntityData",value:function(t,e,i){var n=this,a={IsRowVersion:!0,SelectNames:e,Conditions:[{Name:t.PrimaryKey,Logic:"=",Value:i}]};return t.ComplexQueryList&&t.ComplexQueryList.length>0&&(a.ComplexQueryList=[],t.ComplexQueryList.forEach(function(e){a.ComplexQueryList.push(Object.assign({Conditions:[{Name:t.PrimaryKey,Logic:"=",Value:i}]},e))})),this.DispatchAction(function(){return n.Api.Query(t.Name,a)})()}},{key:"GetEditText",value:function(t){var e=this.DataGrid,i=e.IsDataRight,n=e.LoginUser;return i?n&&t.CreateUser===n.UserId?this.Label:"":this.Label}}]),n}()}($ns),function(t){var e=t.actions.Index,i=t.utils,n=i.Common,a=(i.HtmlTag,t.data.Index),s=a.Dispatch,o=a.Connect;t.actions.SearchAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Page=t,e.Label=e.Label||"查询",e.PageIndex=e.PageIndex||1,e.ConditionList=e.ConditionList||[],e.InitConditionList=e.InitConditionList||[],e.Init(),e}return _inherits(i,e),_createClass(i,[{key:"GetConditionList",value:function(){return this.ConditionList=this.Page.GetSearchCondition(),this.ConditionList}},{key:"Invoke",value:function(t,e){this.PageIndex=1,this.Search(t,e,!1)}},{key:"Search",value:function(e,i,n,a){var o=this,r=this.Page,u=r.Entity,l=r.SelectNames,h=r.IsPage,c=r.PageSize,d=r.KeyName,f=r.IsDataRight,p=r.IsDataStatus;if(n||this.GetConditionList(),!1!==this.ConditionList){u.IsSelectKey&&l.splice(0,0,u.PrimaryKey);var v={IsPage:h,IsRowVersion:void 0===u.IsRowVersion||u.IsRowVersion,IsDataRight:f,IsDataStatus:p,PageIndex:this.PageIndex,PageSize:c,SelectNames:l,Conditions:this.ConditionList,OrderBys:this.Page.GetOrderByList()};if(u.ExpandQueryRequest&&(v=u.ExpandQueryRequest.call(this,v,t)),!1!==v){var g=new t.components.Loading;g.Show(),this.DispatchAction(function(){return o.Api.Query(u.Name,v)})(s,d+"_Search_Data",function(t){a&&(t.Ids=a)}).then(function(t){t.IsSuccess&&t.Data.PageRecord>=0&&(o.PageRecord=t.Data.PageRecord),g.Close()})}}}},{key:"Init",value:function(){var t=this,e=this.Page.Entity;o(function(i){var n="EditPage_"+e.Id;t.GetDataValue(i,n,"EditResponse").then(function(e){e&&t.SetEditResponse(t.EditResponse)}),n="ListPage_"+e.Id,t.GetDataValue(i,n,"ListEditResponse").then(function(e){e&&t.SetEditResponse(t.ListEditResponse)}),t.GetDataValue(i,t.Page.KeyName,"DeleteResponse").then(function(e){e&&t.SetDeleteResponse()})})}},{key:"SetEditResponse",value:function(t){null!=t&&t.Ids&&("Create"===t.RequestType&&this.InsertRefresh(),this.Search(null,null,!0,t.Ids))}},{key:"InsertRefresh",value:function(){this.Page.SetInitConditionList(this.InitConditionList),this.ConditionList=this.InitConditionList.map(function(t){return t})}},{key:"ExcelRefresh",value:function(){this.InsertRefresh(),this.Search(null,null,!0)}},{key:"SetDeleteResponse",value:function(){var t=this.DeleteResponse;if(null!=t){var e=this.Page.DataGridComponent.RowCount;t.IsDelete&&(t.RowCount===e&&this.PageIndex>1&&(this.PageIndex-=1),this.Search(null,null,!0))}}}]),i}(e),t.actions.NewAddAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Page=t,e.Label="新增",e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(e,i){new t.pages.EditPage({Entity:this.Page.Entity,IsDataStatus:this.Page.IsDataStatus}).Load()}}]),i}(e),t.actions.EditAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.DataGrid=t,e.Label="修改",e}return _inherits(i,e),_createClass(i,[{key:"GetText",value:function(t){return this.DataGrid.IsDataStatus&&1===t.DataStatus?"查看":this.GetEditText(t)}},{key:"IsLook",value:function(t){return!(!this.DataGrid.IsDataStatus||1!==t.DataStatus)}},{key:"Invoke",value:function(e,i){var n=this;new t.pages.EditPage({Entity:this.DataGrid.Entity,IsLocalData:this.DataGrid.IsLocalData,SaveData:function(t){return n.DataGrid.SaveData(t)},RowData:i.RowData,IsDataStatus:this.DataGrid.IsDataStatus,IsLook:this.IsLook(i.RowData),IsUpdate:!0}).Load()}}]),i}(e),t.actions.UpdateStatusAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.DataGrid=t,
    e.Label="",e}return _inherits(i,e),_createClass(i,[{key:"GetText",value:function(t){var e=t.DataStatus,i=this.DataGrid,n=i.IsDataRight,a=i.LoginUser;if(n){if(!a)return"";var s=a.DataRight||1;if(t.CreateUser===a.UserId&&(0===e||2===e))return"提交";if(3===s&&1===e)return"驳回"}return""}},{key:"Invoke",value:function(t,e){var i=this,a=e.RowData.DataStatus;if(1===a)return this.Reject(t,e);(0===a||2===a)&&n.Confirm("确认提交吗？").then(function(){var t=i.DataGrid,a=t.Entity,o=(t.RowCount,t.KeyName),r={};r[a.PrimaryKey]=e.RowData[a.PrimaryKey],r.DataStatus=1,r.RowVersion=e.RowData.RowVersion;var u={Data:[r]};i.DispatchAction(function(){return i.Api.Update(a.Name,u)})(s,o+"_Update").then(function(t){t.IsSuccess||n.Alert(t.Message)})})}},{key:"Reject",value:function(e,i){var n=this;new t.pages.EditPage({Entity:this.GetRejectEntity(),SaveData:function(t){return n.DataGrid.SaveData(t)},RowData:i.RowData,IsUpdate:!0,Title:"驳回"+this.DataGrid.Entity.Label}).Load()}},{key:"GetRejectEntity",value:function(){var t=this,e=this.DataGrid,i=e.Entity;e.RowCount,e.KeyName;return{Id:i.Id,Name:i.Name,Label:i.Label,PrimaryKey:i.PrimaryKey,IsSelectKey:!0,Properties:[{Name:"RejectReason",Label:"驳回原因",ControlType:"TextArea",MaxLength:500,IsNullable:!1,EditOptions:{X:1,Y:1,ControlWidth:450,Height:80}},{Name:"DataStatus",EditOptions:{IsVisible:!1}}],ExpandSetEditData:function(e,n,a){return e.DataStatus=2,t.CreateRejectReason(e.RejectReason,e[i.PrimaryKey]),e}}}},{key:"CreateRejectReason",value:function(t,e){var i=this,a={};a.DataId=n.CreateGuid(),a.RejectDataId=e,this.DataGrid.LoginUser&&(a.UserName=this.DataGrid.LoginUser.UserName+"("+this.DataGrid.LoginUser.LoginName+")"),a.RejectReason=t;var s={Data:[a]};this.DispatchAction(function(){return i.Api.Create("RejectRecord",s)})()}}]),i}(e),t.actions.BatchSubmitAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Page=t,i.Label="批量提交",i.Width=80,i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){var i=this,a=this.Page.GetDataGridCheckedValue();if(0===a.length)return void n.Alert("请选择数据行！");var o=[],r=[],u=this.Page,l=u.IsDataRight,h=u.LoginUser;if(l?a.forEach(function(t){h&&t.CreateUser===h.UserId&&o.push(t)}):o=a,this.Page.IsDataStatus?o.forEach(function(t){1!==t.DataStatus&&r.push(t)}):r=o,0===r.length)return void n.Alert("对不起，选择的数据行未有符合可提交的数据！");n.Confirm("确认提交吗？").then(function(){var t=i.Page,e=t.Entity,a=t.KeyName,o={},u=[];r.forEach(function(t){o={},o[e.PrimaryKey]=t[e.PrimaryKey],o.DataStatus=1,o.RowVersion=t.RowVersion,u.push(o)});var l={Data:u};i.DispatchAction(function(){return i.Api.Update(e.Name,l)})(s,a+"_Update").then(function(t){t.IsSuccess||n.Alert(t.Message)})})}}]),e}(e),t.actions.BatchRejectAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Page=t,e.Label="批量驳回",e.Width=80,e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(t,e){var i=this.Page.GetDataGridCheckedValue();if(0===i.length)return void n.Alert("请选择数据行！");var a=[],s=this.Page.LoginUser;if(i.forEach(function(t){3===(s?s.DataRight||1:1)&&1===t.DataStatus&&a.push(t)}),0===a.length)return void n.Alert("对不起，选择的数据行未有符合可驳回的数据！");e.DataList=a,this.Reject(t,e)}},{key:"Reject",value:function(e,i){var n=this,a=new t.pages.EditPage({Entity:this.GetRejectEntity(),Title:"驳回"+this.Page.Entity.Label,OkAction:{Invoke:function(t,e){e.DataList=i.DataList,n.OkAction(t,e,a)}}});a.Load()}},{key:"OkAction",value:function(t,e,i){var n=i.Entity,a=(i.KeyName,i.EditDialog,i.GetEditData());if(!1!==a){var s=[],o=[],r=null;e.DataList.forEach(function(t){r={DataStatus:2,RowVersion:t.RowVersion},r[n.PrimaryKey]=t[n.PrimaryKey],s.push(r),o.push(t[n.PrimaryKey])}),this.CreateRejectReason(a.RejectReason,o),this.EditEntityData(e,s,!0,i)}}},{key:"GetRejectEntity",value:function(){var t=this.Page,e=t.Entity;t.KeyName;return{Id:e.Id,Name:e.Name,Label:e.Label,PrimaryKey:e.PrimaryKey,IsSelectKey:!0,Properties:[{Name:"RejectReason",Label:"驳回原因",ControlType:"TextArea",MaxLength:500,IsNullable:!1,EditOptions:{X:1,Y:1,ControlWidth:450,Height:80}},{Name:"DataStatus",EditOptions:{IsVisible:!1}}]}}},{key:"CreateRejectReason",value:function(t,e){var i=this,a={},s=[];e.forEach(function(e){a={},a.DataId=n.CreateGuid(),a.RejectDataId=e,i.Page.LoginUser&&(a.UserName=i.Page.LoginUser.UserName+"("+i.Page.LoginUser.LoginName+")"),a.RejectReason=t,s.push(a)});var o={Data:s};this.DispatchAction(function(){return i.Api.Create("RejectRecord",o)})()}}]),i}(e),t.actions.BatchDeleteAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Page=t,e.Label="批量删除",e.Width=80,e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(e,i){var a=this,o=this.Page.GetDataGridCheckedValue();if(0===o.length)return void n.Alert("请选择数据行！");var r=[],u=[],l=this.Page,h=l.IsDataRight,c=l.LoginUser;if(h?o.forEach(function(t){c&&t.CreateUser===c.UserId&&r.push(t)}):r=o,this.Page.IsDataStatus?r.forEach(function(t){1!==t.DataStatus&&u.push(t)}):u=r,0===u.length)return void n.Alert("对不起，选择的数据行未有符合可删除的数据！");n.Confirm("确认删除吗？").then(function(){var e=a.Page,i=e.Entity,o=e.KeyName,r=[],l={};u.forEach(function(t){l={},l[i.PrimaryKey]=t[i.PrimaryKey],l.RowVersion=t.RowVersion,r.push(l)});var h={Data:r};a.DispatchAction(function(){return a.Api.Delete(i.Name,h)})(s,o+"_Delete",function(t){return t.RowCount=r.length}).then(function(e){e.IsSuccess?t.data.Cache.UpdateEntityCacheList(i.Name):n.Alert(e.Message)})})}}]),i}(e),t.actions.DeleteAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.DataGrid=t,e.Label="删除",e}return _inherits(i,e),_createClass(i,[{key:"GetText",value:function(t){return this.DataGrid.IsDataStatus&&1===t.DataStatus?"":this.GetEditText(t)}},{key:"Invoke",value:function(e,i){var a=this;if(this.DataGrid.IsLocalData)return void this.DataGrid.DeleteData(i.RowData[this.DataGrid.Entity.PrimaryKey]);n.Confirm("确认删除吗？").then(function(){var e=a.DataGrid,o=e.Entity,r=e.RowCount,u=e.KeyName,l={};l[o.PrimaryKey]=i.RowData[o.PrimaryKey],l.RowVersion=i.RowData.RowVersion;var h={Data:[l]};a.DispatchAction(function(){return a.Api.Delete(o.Name,h)})(s,u+"_Delete",function(t){return t.RowCount=r}).then(function(e){e.IsSuccess?t.data.Cache.UpdateEntityCacheList(o.Name):n.Alert(e.Message)})})}}]),i}(e),t.actions.PagingAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.DataPaging=t,i.SearchAction=i.DataPaging.SearchAction,i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){this.SearchAction.PageIndex=this.GetPageIndex(),this.SearchAction.Search(t,e,!0)}},{key:"GetPageIndex",value:function(){var t=this.SearchAction.PageIndex;switch(this.Type){case"First":return 1;case"Pre":return t-1;case"Next":return t+1;case"Last":return this.DataPaging.PageCount;default:this.pageIndex}}}]),e}(e),t.actions.PagingFirstAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Label="<<",i.Title="首页",i.Type="First",i}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingPreAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Label="<",i.Title="上页",i.Type="Pre",i}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingNextAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Label=">",i.Title="下页",i.Type="Next",i}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingLastAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Label=">>",i.Title="尾页",i.Type="Last",i}return _inherits(e,t),e}(t.actions.PagingAction),t.actions.PagingIndexQueryAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Label="确定",i.DataPaging=t,i.SearchAction=i.DataPaging.SearchAction,i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){var i=this.DataPaging.GetInputPageIndex();!1!==i&&(this.SearchAction.PageIndex=i,this.SearchAction.Search(t,e,!0))}}]),e}(e),t.actions.ExcelExportAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Label="Excel导出",i.Width=80,i.Page=t,i.SearchAction=t.SearchActions[0],i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){var i=this;if(this.SearchAction.PageRecord>5e4)return void n.Alert("对不起，您要导出的数据量超过5万条，请先进行相应的数据筛选！");n.Confirm("确定将数据Excel导出吗？").then(function(){return i.ExcelExport(e)})}},{key:"ExcelExport",value:function(t){var e=this;t.SetDisabled(!0);var i=this.Page,a=i.Entity,s=i.SelectNames,o={IsExcel:!0,Title:a.Label,SelectNames:s,Conditions:this.SearchAction.ConditionList,OrderBys:this.Page.GetOrderByList(),HeaderInfos:this.Page.GetHeaderInfoList()};this.DispatchAction(function(){return e.Api.Query(a.Name,o)})().then(function(i){t.SetDisabled(!1),i.IsSuccess&&i.Data.FileName?e.DownLoad(i.Data.FileName):i.Message&&n.Alert(i.Message)})}},{key:"DownLoad",value:function(t){var e="download.aspx?fn="+t;window.open(e,"_self")}}]),e}(e),t.actions.ExcelImportAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Label="Excel导入",e.Width=80,e.Page=t,e.SearchAction=t.SearchActions[0],e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(e,i){new t.components.ExcelImport({Entity:this.Page.Entity,SearchAction:this.SearchAction,Api:this.Api}).Import()}}]),i}(e),t.actions.ChangePasswordAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Label="修改密码",e.Page=t,e.Entity=e.GetUserEntity(),e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(e,i){var a=this;this.UserId=n.GetStorage("LoginUserId"),this.UserId||n.ToLogin(),this.EditPage=new t.pages.EditPage({Entity:this.Entity,Title:"修改登录密码"}),this.EditPage.Load(),this.EditPage.EditDialog.OkAction={Invoke:function(t,e){var i=a.EditPage.GetEditData();!1!==i&&(e.SetDisabled(!0),a.GetUserInfo(i,e))}}}},{key:"GetUserInfo",value:function(t,e){var i=this;t.OldLoginPassword=n.ComputeMd5(t.OldLoginPassword);var a=[{Name:"UserId",Logic:"=",Value:this.UserId},{Name:"LoginPassword",Logic:"=",Value:t.OldLoginPassword}];this.GetDataList("User",["UserId"],a).then(function(a){a.IsSuccess?1===a.Data.DataList.length?i.UpdateUserPassword(t,e):n.Alert("原密码不正确").then(function(){return e.SetDisabled(!1)}):n.Alert(a.Message).then(function(){return e.SetDisabled(!1)})})}},{key:"UpdateUserPassword",value:function(t,e){var i=this;delete t.OldLoginPassword,delete t.AgainLoginPassword,t.LoginPassword=n.ComputeMd5(t.LoginPassword);var a={Data:[t]};this.DispatchAction(function(){return i.Api.Update("User",a)})().then(function(t){t.IsSuccess?n.Alert("修改成功！").then(function(){i.EditPage.ClearControlValue(),i.EditPage.EditDialog.Close()}):n.Alert(t.Message).then(function(){return e.SetDisabled(!1)})})}},{key:"GetUserEntity",value:function(){return{Id:"A2FACD99-F429-4833-9173-B5E0CB2BF3F6",Name:"User",Label:"用户",PrimaryKey:"UserId",Properties:[{Name:"OldLoginPassword",Label:"原密码",IsNullable:!1,ControlType:"Password",MaxLength:50,EditOptions:{X:1,Y:1}},{Name:"LoginPassword",Label:"新密码",IsNullable:!1,ControlType:"Password",MaxLength:50,EditOptions:{X:2,Y:1}},{Name:"AgainLoginPassword",Label:"确认新密码",ControlType:"Password",MaxLength:50,EditOptions:{X:3,Y:1}}],ExpandSetEditData:function(t,e,i){var n=i.utils.Common,a="",s=!0;return s&&!n.IsNullOrEmpty(t.LoginPassword)&&t.LoginPassword!==t.AgainLoginPassword&&(a="新密码与确认新密码不一致！",s=!1),s?t:(n.Alert(a),!1)}}}}]),i}(e),t.actions.LookRejectRecordAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.DataGrid=t,e.Label="驳回记录",e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(e,i){new t.pages.DialogListPage({Width:880,Height:420,GridWidth:880,GridHeight:380,IsPage:!1,Entity:this.GetRejectRecordEntity(i.RowData)}).Load()}},{key:"GetRejectRecordEntity",value:function(t){return{Name:"RejectRecord",Label:"驳回记录",PrimaryKey:"DataId",Properties:[{Name:"RejectDataId",DefaultValue:t[this.DataGrid.Entity.PrimaryKey],SearchOptions:{IsVisible:!1}},{Name:"RejectReason",Label:"驳回原因",DataOptions:{X:1,ColumnWidth:620}},{Name:"UserName",Label:"操作人",DataOptions:{X:2,ColumnWidth:120}},{Name:"CreateDate",Label:"操作时间",DataOptions:{X:3,ColumnWidth:130}}]}}}]),i}(e),t.actions.LookOperationLogAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.DataGrid=t,e.Label="查看日志",e}return _inherits(i,e),_createClass(i,[{key:"GetText",value:function(t){var e=this.DataGrid,i=e.IsDataRight,n=e.LoginUser;if(i){if(!n)return"";return 3===(n.DataRight||1)?"查看日志":""}return"查看日志"}},{key:"Invoke",value:function(e,i){new t.pages.DialogListPage({Width:880,Height:420,GridWidth:880,GridHeight:380,Entity:this.GetOperationLogEntity(i.RowData)}).Load()}},{key:"GetOperationLogEntity",value:function(t,e){var i=this;return{Name:"ViewDataOperationLog",Label:"操作日志",PrimaryKey:"LogId",Properties:[{Name:"PrimaryKey",DefaultValue:t?t[this.DataGrid.Entity.PrimaryKey]:"",SearchOptions:{IsVisible:!1}},{Name:"EntityName",DefaultValue:e||"",SearchOptions:{IsVisible:!1}},{Name:"TableLogId",IsVisible:!1,IsData:!0},{Name:"OperationName",Label:"操作名称",DataOptions:{X:1,ColumnWidth:130}},{Name:"UserName",Label:"操作人",DataOptions:{X:2,ColumnWidth:130}},{Name:"CreateDate",Label:"操作时间",DataOptions:{X:3,ColumnWidth:130}},{Name:"LookDetail",Label:"详细",DataOptions:{X:4,ColumnWidth:130,ActionInvoke:function(t,e){i.LookDetailLog(e.RowData)},ControlType:"LinkButton",TextAlign:"center"}}]}}},{key:"LookDetailLog",value:function(e){new t.pages.DialogListPage({Width:880,Height:420,GridWidth:880,GridHeight:380,IsPage:!1,Title:"属性变更明细",Entity:this.GetOperationFieldLogEntity(e)}).Load()}},{key:"GetOperationFieldLogEntity",value:function(t){return{Name:"DataOperationFieldLog",Label:"操作日志",PrimaryKey:"FieldLogId",OrderByList:[],Properties:[{Name:"TableLogId",DefaultValue:t.TableLogId,SearchOptions:{IsVisible:!1}},{Name:"FieldName",Label:"属性名",DataOptions:{X:1,ColumnWidth:150}},{Name:"OldValue",Label:"旧值",DataOptions:{X:2,ColumnWidth:350}},{Name:"NewValue",Label:"新值",DataOptions:{X:3,ColumnWidth:350}}]}}}]),i}(e),t.actions.LookOperationLogAction2=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Page=t,e.Label="操作日志",e.Width=80,e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(e,i){new t.pages.DialogListPage({Width:880,Height:420,GridWidth:880,GridHeight:380,Entity:this.GetOperationLogEntity(null,this.Page.Entity.Name)}).Load()}}]),i}(t.actions.LookOperationLogAction)}($ns),function(t){var e=t.actions.Index;t.actions.DialogOkAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Dialog=t,i.Label=i.Label||"确定",i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){this.Dialog.OkAction&&this.Dialog.OkAction.Invoke(t,e)}}]),e}(e),t.actions.DialogSaveAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Dialog=t,i.Label=i.Label||"保存",i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){e.Type=1,this.Dialog.OkAction&&this.Dialog.OkAction.Invoke(t,e)}}]),e}(e),t.actions.DialogSubmitAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Dialog=t,i.Label=i.Label||"保存并提交",i.Width=100,i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){e.Type=2,this.Dialog.OkAction&&this.Dialog.OkAction.Invoke(t,e)}}]),e}(e),t.actions.DialogCancelAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Dialog=t,i.Label=i.Label||"取消",i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){this.Dialog.Close()}}]),e}(e)}($ns),function(t){var e=t.actions.Index;t.utils.Common;t.actions.CreateAction=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Page=t,i}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){this.Edit(e)}}]),e}(e),t.actions.UpdateAction=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"Invoke",value:function(t,e){this.Edit(e,!0)}}]),e}(e),t.actions.GridViewAddAction=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Label="添加",e.GridView=t,e}return _inherits(i,e),_createClass(i,[{key:"Invoke",value:function(e,i){var n=this;new t.pages.EditPage({Entity:this.GridView.Entity,IsLocalData:!0,SaveData:function(t){return n.GridView.SaveData(t)}}).Load()}}]),i}(e)}($ns),function(t){var e=t.utils,i=e.Common,n=e.HtmlTag;t.controls.Index=function(){function e(t){_classCallCheck(this,e),this.Id=i.CreateGuid(),this.Attributes=[],t&&Object.assign(this,t),this.Height=this.Height||30}return _createClass(e,[{key:"GetHtml",value:function(){return""}},{key:"EventLoad2",value:function(){}},{key:"DataLoad2",value:function(){}},{key:"EventLoad",value:function(){this.Element=n.GetById(this.Id),this.EventLoad2()}},{key:"GetRowClassName",value:function(){return""}},{key:"DataLoad",value:function(){this.DataLoad2()}},{key:"GetAttributeHtml",value:function(){var t=this;return this.Attributes.map(function(e){return t.GetAttributeItem(e)}).join("")}},{key:"GetAttributeItem",value:function(t){return" "+t.Name+'="'+t.Value+'"'}},{key:"SetAttribute",value:function(t,e){this.Attributes.push({Name:t,Value:e})}},{key:"GetInputHtml",value:function(t){var e=[];return e.push('<input id="'+this.Id+'" type="'+t+'"'),e.push(this.GetAttributeHtml()),e.push("/>"),e.join("")}},{key:"GetValue",value:function(){if("CheckBox"===this.ControlType)return this.GetCheckBoxValue();var t=n.GetValue(this.Element);return this.Value=i.IsNullOrEmpty(t)?"":i.Trim(t),this.Value}},{key:"SetValue",value:function(t){if("CheckBox"===this.ControlType)return void this.SetCheckBoxValue(t);t=void 0===t?"":t,this.Value=t,n.SetValue(this.Element,t)}},{key:"SetDisabled",value:function(t){n.SetDisabled(this.Element,t)}},{key:"GetDisabled",value:function(){return n.GetDisabled(this.Element)}},{key:"GetStyle",value:function(t){return 0===t.length?"":' style="'+t.join("")+'"'}},{key:"GetClass",value:function(){return this.ClassName?" class="+this.ClassName:""}},{key:"GetDataList",value:function(){return t.data.Cache.GetPropertyDataList(this)}},{key:"GetMaxLength",value:function(){switch(this.DataType){case"int":return 10;case"float":case"money":case"long":return 20;default:return 0}}},{key:"GetScale",value:function(){switch(this.DataType){case"int":case"long":case"float":case"money":return 2;default:return 0}}}]),e}()}($ns),function(t){var e=t.controls.Index,i=t.utils,n=i.Common,a=i.HtmlTag;t.controls.SpanLabel=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.LabelWidth&&(i.Width=i.LabelWidth),i.Width=i.Width||100,n.InitValue(i,["IsColon","IsWidth"],!0),i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){if(!this.Label||"CheckBox"===this.ControlType||"GridView"===this.ControlType||"Button"===this.ControlType)return this.Width=0,"";var t=this.IsColon?"：":"",e=[];this.IsWidth&&e.push("width:"+this.Width+"px;");var i=this.GetStyle(e),a=this.GetClass(),s=n.ReplaceHtmlTag(this.Label);return'<span id="'+this.Id+'"'+i+a+">"+s+t+"</span>"}},{key:"SetValue",value:function(t){a.SetHtml(this.Element,t)}}]),e}(e),t.controls.SpanText=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=[];this.IsWidth&&t.push("width:"+this.Width+"px;");var e=this.GetStyle(t),i=this.GetClass(),a=this.Value||this.DefaultValue;return a=n.ReplaceHtmlTag(a),'<span id="'+this.Id+'"'+e+i+">"+a+"</span>"}},{key:"SetValue",value:function(t){a.SetHtml(this.Element,t)}}]),e}(e),t.controls.DataSpan=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){this.Value=n.IsNullOrEmpty(this.Value)?"":this.Value;var t=this.DataType;this.IsNumberType="int"===t||"long"===t||"float"===t||"money"===t,this.SetFormatStyle(),this.IsLabel||this.SetValue();var e=this.GetColorStyle();this.SetCurrencyValue();var i=n.ReplaceHtmlTag(this.Value);return'<span id="'+this.Id+'" style="padding:1px 2px 1px 2px;'+e+'">'+i+"</span>"}},{key:"SetFormatStyle",value:function(){switch(this.DataFormat){case"日期":this.Value&&(this.Value=this.Value.substring(0,10));break;case"货币":this.IsCurrency=!0}this.TextAlign||(this.IsNumberType||"date"===this.DataType)&&(this.TextAlign="right")}},{key:"SetCurrencyValue",value:function(){this.IsCurrency||"money"!==this.DataType||(this.IsCurrency=!0),this.IsCurrency?this.Value=n.ToCurrency(this.Value):this.IsNumberType&&this.Scale>0&&(this.Value=n.GetNumberValue(this.Value).toFixed(this.Scale))}},{key:"GetColorStyle",value:function(){if(this.Value&&this.IsNumberType){if(n.GetNumberValue(this.Value)<0)return" color:red;"}return""}},{key:"SetValue",value:function(){if(this.Options&&this.Options.length>0?this.SetValueText(this.Options,"Value","Text"):this.DataList&&this.DataList.length>0&&this.SetValueText(this.DataList,this.ValueName,this.TextName),"CheckBox"===this.ControlType){this.CheckedText=void 0===this.CheckedText?"是":this.CheckedText,this.UnCheckedText=void 0===this.UnCheckedText?"否":this.UnCheckedText;var t=void 0===this.CheckedValue?"true":this.CheckedValue;this.Value=n.IsEquals(this.Value,t,!0)?this.CheckedText:this.UnCheckedText}}},{key:"SetValueText",value:function(t,e,i,s){var o=this,r=t.filter(function(t){return void 0!==t[e]&&n.IsEquals(t[e],o.Value)});r.length>0&&(this.Value=r[0][i],s&&a.SetHtml(this.Element,n.ReplaceHtmlTag(this.Value)))}},{key:"DataLoad2",value:function(){var t=this;!this.DataList&&this.DataSource&&this.GetDataList().then(function(){return t.SetValueText(t.DataList,t.ValueName,t.TextName,!0)})}}]),e}(e),t.controls.DataCheckBox=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.ColumnWidth=20,i.TextAlign="center",i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){return this.GetInputHtml("checkbox")}},{key:"GetChecked",value:function(){return this.Element.checked}},{key:"SetChecked",value:function(t){var e=this;void 0===t?window.setTimeout(function(){e.IsChangeEvent?e.IsChangeEvent=!1:(e.Element.checked?e.Element.checked=!1:e.Element.checked=!0,e.CheckChanged&&e.CheckChanged(e.Element.checked))},50):this.Element.checked=t}},{key:"EventLoad2",value:function(){var t=this;a.BindEvent(this.Element,"change",function(e){return t.Changed(e)})}},{key:"Changed",value:function(t){this.IsChangeEvent=!0,this.CheckChanged&&this.CheckChanged(this.Element.checked)}}]),e}(e)}($ns),function(t){var e=t.controls.Index,i=t.utils,n=i.Common,a=i.HtmlTag;t.controls.TextBox=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.ControlWidth&&(i.Width=i.ControlWidth),i.Width=i.Width||200,i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){this.SetDataType(),this.SetAttribute("name",this.Name),this.MaxLength>0&&this.SetAttribute("maxlength",this.MaxLength),this.IsInput()&&this.SetAttribute("autocomplete","off"),this.ClassName&&this.SetAttribute("class",this.ClassName),this.PlaceHolder&&this.SetAttribute("placeholder",this.PlaceHolder),this.Checked&&this.SetAttribute("checked","checked"),this.DefaultValue&&this.SetAttribute("value",this.DefaultValue);var t=[];switch(this.IsInput()&&t.push("width:"+this.Width+"px;"),t.length>0&&this.SetAttribute("style",t.join("")),this.ControlType){case"Password":return this.GetInputHtml("password");case"CheckBox":return this.GetCheckBoxHtml(this.GetInputHtml("checkbox"));case"TextDate":return this.GetInputHtml("date");default:return this.GetInputHtml("text")}}},{key:"GetCheckBoxHtml",value:function(t){var e=this.Label.replace("是否","");return'<div class="DivCheckBox" style="margin-left:'+(this.LabelWidth+5)+'px;"><label>'+t+"<span>"+e+"</span></label></div>"}},{key:"GetCheckBoxValue",value:function(){var t=void 0!==this.CheckedValue?this.CheckedValue:"true",e=void 0!==this.UnCheckedValue?this.UnCheckedValue:"false";return this.Element.checked?t:e}},{key:"SetCheckBoxValue",value:function(t){var e=n.IsNullOrEmpty(t)?"":t.toString().toLowerCase(),i=void 0!==this.CheckedValue?this.CheckedValue:"true";this.Element.checked=e===i.toString().toLowerCase()}},{key:"IsInput",value:function(){return"CheckBox"!==this.ControlType&&"Radio"!==this.ControlType}},{key:"EventLoad3",value:function(){}},{key:"DataLoad3",value:function(){}},{key:"EventLoad2",value:function(){var t=this;this.IsKeyPress=!1,this.IsBlur=!1,this.EnterControl?this.IsKeyPress=!0:"TextBox"===this.ControlType&&this.IsNumberType&&(this.IsBlur=!0,this.IsKeyPress=!0),this.IsKeyPress&&a.BindEvent(this.Element,"keypress",function(e){return t.KeypressEvent(e)}),this.IsBlur&&a.BindEvent(this.Element,"blur",function(e){return t.BlurEvent(e)}),this.EventLoad3()}},{key:"SetDataType",value:function(){var t=this.DataType;if(this.IsNumberType="int"===t||"long"===t||"float"===t||"money"===t,!this.MaxLength){var e=this.GetMaxLength();e>0&&(this.MaxLength=e)}this.Scale||(this.Scale=this.GetScale())}},{key:"DataLoad2",value:function(){this.DataLoad3()}},{key:"KeypressEvent",value:function(t){var e=window.event?t.keyCode:t.which,i="int"===this.DataType||"long"===this.DataType?"int":"decimal",a=!0;return 13!=e&&8!=e&&e>0&&("int"==i?a=n.IsNumberCharCode(t):"decimal"==i&&(a=n.IsDecimalCharCode(t))),a&&13==e&&this.EnterControl&&this.KeypressEnter(t),a}},{key:"BlurEvent",value:function(t){var e=a.GetValue(this.Element),i="";return"date"===this.DataType?i=ValidateDate(e):this.IsNumberType&&(i=this.ValidateNumber(e)),i&&(n.Alert(i),this.Element.focus(),a.SetValue(this.Element,"")),!i}},{key:"ValidateDate",value:function(t){if(n.IsNullOrEmpty(t))return"";var e="",i=!0;if(t.length>10&&(i=!1),i){var a=n.ConvertToDate(t,"yyyy-MM-dd");isNaN(a)&&(a=n.ConvertToDate(t,"yyyy/MM/dd")),isNaN(a)&&(i=!1)}return i||(e="对不起，您输入的日期格式不正确！\n支持日期格式如下：2012-12-12"),e}},{key:"ValidateNumber",value:function(t){var e="",i="int"===this.DataType||"long"===this.DataType?"int":"decimal",a=void 0===this.Scale?0:parseInt(this.Scale);return n.IsNullOrEmpty(t)||("int"==i?e=this.JudgeNumber(t):"decimal"==i&&(e=0==a?this.JudgeNumber(t):1==a?this.JudgeDecimal1(t):2==a?this.JudgeDecimal2(t):3==a?this.JudgeDecimal3(t):4==a?this.JudgeDecimal4(t):this.JudgeDecimal(t))),e}},{key:"KeypressEnter",value:function(t){this.EnterControl.Element&&(this.EnterControl.Element.focus(),this.EnterControl.Element.click())}},{key:"JudgeDecimal",value:function(t){return n.IsDecimal(t)?"":"请输入一个数值！"}},{key:"JudgeDecimal1",value:function(t){return n.IsDecimal1(t)?"":"请输入一个数值，最多只能有一位小数！"}},{key:"JudgeDecimal2",value:function(t){return n.IsDecimal2(t)?"":"请输入一个数值，最多只能有两位小数！"}},{key:"JudgeDecimal3",value:function(t){return n.IsDecimal3(t)?"":"请输入一个数值，最多只能有三位小数！"}},{key:"JudgeDecimal4",value:function(t){return n.IsDecimal4(t)?"":"请输入一个数值，最多只能有四位小数！"}},{key:"JudgeNumber",value:function(t){return n.IsNumber(t)?"":"请输入一个整数！"}}]),e}(e)}($ns),function(t){var e=t.controls.Index,i=t.utils,n=i.Common,a=i.HtmlTag;t.controls.Button=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Width=i.Width||60,i.Label=i.Label||i.Name,i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){this.SetAttribute("value",this.Action.Label||this.Label),this.Action.Title&&this.SetAttribute("title",this.Action.Title),this.ClassName&&this.SetAttribute("class",this.ClassName);var t=[];return t.push("width:"+this.Width+"px;"),this.SetAttribute("style",t.join("")),this.GetInputHtml("button")}},{key:"EventLoad2",value:function(){var t=this;this.Action.EventNames.forEach(function(e){a.BindEvent(t.Element,e,function(e){return t.Action.Invoke(e,t)})}),this.Action.IsOkFocus&&this.Element.focus()}},{key:"SetValue",value:function(){}},{key:"GetValue",value:function(){}}]),e}(e),t.controls.LinkButton=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Label=i.Label||i.Action.Label,i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=this.Label;return this.Action.GetText&&(t=this.Action.GetText(this.RowData)),n.IsNullOrEmpty(t)?"":'<a href="javascript:void(0);" id='+this.Id+">"+t+"</a>"}},{key:"EventLoad2",value:function(){var t=this;this.Action.EventNames.forEach(function(e){a.BindEvent(t.Element,e,function(e){return t.Action.Invoke(e,t)})})}}]),e}(e),t.controls.LinkButtonList=function(e){function i(t){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return _inherits(i,e),_createClass(i,[{key:"GetHtml",value:function(){var e=this;this.LinkButtons=this.Actions.map(function(i){return new t.controls.LinkButton({RowData:e.RowData,Action:i})});var i=['<div class="ASpanList">'];return i=i.concat(this.LinkButtons.map(function(t){return"<span>"+t.GetHtml()+"</span>"})),i.push("</div>"),i.join("")}},{key:"EventLoad2",value:function(){this.LinkButtons.forEach(function(t){return t.EventLoad()})}},{key:"DataLoad2",value:function(){this.LinkButtons.forEach(function(t){return t.DataLoad()})}}]),i}(e)}($ns),function(t){var e=t.controls,i=e.Index,n=e.Button,a=t.utils,s=a.Common,o=a.HtmlTag;t.controls.GridView=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Styles=e.Styles||{DivGridAdd:"DivGridAdd"},e.Entity.Label=e.Entity.Label||e.Entity.Name,e.ControlWidth&&(e.Width=e.ControlWidth),e.Init(),e}return _inherits(i,e),_createClass(i,[{key:"Init",value:function(){var e=this;this.Entity.ExpandPageInit&&this.Entity.ExpandPageInit.call(this,t),this.Entity.Properties.forEach(function(t){return e.InitProperty(t)}),this.DataProperties=this.Entity.Properties.filter(function(t){return t.IsData}).map(function(t){return Object.assign({},t,t.DataOptions)}),
    this.GridViewLayout=new t.layouts.GridView(this.GetGridViewComponents()),this.AddButton=new n({Action:new t.actions.GridViewAddAction(this)}),this.Height+=30}},{key:"GetRowClassName",value:function(){return"DivRowGridView"}},{key:"InitProperty",value:function(t){s.InitValue(t,["IsData"],void 0!==t.DataOptions),s.InitValue(t,["IsEdit"],void 0!==t.EditOptions)}},{key:"GetHtml",value:function(){var t=[],e="record_"+this.Id,i='<span id="'+e+'">共 0 条记录</span>',n=this.AddButton.GetHtml();return t.push('<div class="'+this.Styles.DivGridAdd+'">'),t.push('<div class="DivAddLeft">'+i+"</div>"),t.push('<div class="DivAddRight">'+n+"</div>"),t.push("</div>"),t.push(this.GridViewLayout.GetHtml()),t.join("")}},{key:"SaveData",value:function(t){this.DataGridComponent.SaveData(t)}},{key:"GetGridViewComponents",value:function(){return this.DataGridComponent=new t.components.DataGrid({Entity:this.Entity,IsLocalData:!0,IsDelete:!0,IsEdit:!0,Width:this.Width||0,Height:this.Height,Properties:this.DataProperties,IsFixedWidth:!0}),{DataGridComponent:this.DataGridComponent}}},{key:"GetValue",value:function(){return this.DataGridComponent.GetValue()}},{key:"SetValue",value:function(t){this.DataGridComponent.SetValue(t)}},{key:"EventLoad2",value:function(){this.DataGridComponent.SpanRecord=o.GetById("record_"+this.Id),this.DataGridComponent.EventLoad(),this.AddButton.EventLoad()}},{key:"DataLoad2",value:function(){this.DataGridComponent.DataLoad(),this.AddButton.DataLoad()}}]),i}(i)}($ns),function(t){var e=t.controls.Index,i=t.utils,n=i.Common,a=i.HtmlTag;t.controls.DownList=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.ControlWidth&&(i.Width=i.ControlWidth),i.Width=i.Width||200,n.InitValue(i,["IsEmpty"],!0),i.ClassName=i.ClassName||"DownList",i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){this.SetAttribute("name",this.Name),this.ClassName&&this.SetAttribute("class",this.ClassName);var t=[];t.push("width:"+(this.Width+3)+"px;"),t.length>0&&this.SetAttribute("style",t.join(""));var e=[];return e.push('<select id="'+this.Id+'"'),e.push(this.GetAttributeHtml()),e.push(">"),e.push(this.GetOptionsHtml()),e.push("<select>"),e.join("")}},{key:"GetOptionsHtml",value:function(){var t=[];if(this.IsEmpty&&t.push('<option value=""></option>'),this.Options&&this.Options.length>0){var e=void 0,i=void 0;this.Options.forEach(function(n){void 0!=n.Value&&void 0!=n.Text?(e=n.Value,i=n.Text):(e=n,i=n),t.push('<option value="'+e+'">'+i+"</option>")})}else!this.IsEmpty&&t.push('<option value=""></option>');return t.join("")}},{key:"LoadOptionHtml",value:function(){var t=this,e=[],i=this.DataSource,s=i.TextName,o=i.ValueName;if(this.IsEmpty&&e.push('<option value=""></option>'),this.DataList&&this.DataList.length>0){var r=void 0,u=void 0,l=void 0;this.DataList.forEach(function(i){r=i[o],u=i[s],l=n.IsEquals(r,t.Value)?' selected="selected"':"",e.push('<option value="'+r+'"'+l+">"+u+"</option>")})}else!this.IsEmpty&&e.push("<option></option>");a.SetHtml(this.Element,e.join(""))}},{key:"DataLoad2",value:function(){var t=this;this.DataSource&&this.GetDataList(),this.DataSource&&(a.SetHtml(this.Element,'<option value="">数据源加载中……</option>'),this.GetDataList().then(function(){return t.LoadOptionHtml()}))}}]),e}(e)}($ns),function(t){var e=t.controls.Index,i=t.utils;i.Common,i.HtmlTag;t.controls.TextArea=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.ControlWidth&&(i.Width=i.ControlWidth),i.Width=i.Width||200,i.ClassName=i.ClassName||"TextArea",i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){this.SetAttribute("name",this.Name),this.ClassName&&this.SetAttribute("class",this.ClassName);var t=[];t.push("width:"+this.Width+"px;");var e=this.Height-8;t.push("height:"+e+"px;"),t.length>0&&this.SetAttribute("style",t.join(""));var i=[];return i.push('<textarea  cols="100" rows="100"" id="'+this.Id+'"'),i.push(this.GetAttributeHtml()),i.push(">"),i.push("</textarea>"),i.join("")}}]),e}(e)}($ns),function(t){var e=t.controls.TextBox,i=t.utils,n=i.Common,a=i.HtmlTag;t.controls.TextSelect=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.DataList=i.DataList||[],i.SelectDataList=[],i.ValueName=i.ValueName||"Value",i.TextName=i.TextName||"Text",i.SelectValue="",i.SelectText="",i.MaxItemLength=100,i}return _inherits(e,t),_createClass(e,[{key:"EventLoad3",value:function(){var t=this;a.BindEvent(this.Element,"click",function(e){t.LoadSelect(e)}),a.BindEvent(this.Element,"change",function(e){t.InputChange(e)}),a.BindEvent(this.Element,"keydown",function(e){t.SearchByKeyword(e)}),a.BindEvent(this.Element,"keypress",function(e){t.SearchByKeyword(e)})}},{key:"SearchByKeyword",value:function(t){var e=this;this.TimeoutId&&window.clearInterval(this.TimeoutId),this.TimeoutId=window.setTimeout(function(){return e.BandKeywordData()},150)}},{key:"BandKeywordData",value:function(){if(this.IsEnable||this.LoadSelect(),this.IsEnable){this.SelectDataList=this.SearchData(),this.SetSelectOffSet();var t=this.SelectOffSet,e=t.Width,i=t.Height;a.SetStyle(this.SelectTag,{width:e+"px",height:i+"px"}),a.SetHtml(this.ContentTag,this.GetItemHtml(this.SelectDataList)),this.BindSelectEvents()}}},{key:"InputChange",value:function(t){var e=n.Trim(t.target.value);n.IsEquals(e,this.SelectText)||(this.SelectValue="",this.SelectText="",t.target.value="")}},{key:"LoadSelect",value:function(){if(0!=this.DataList.length&&!this.IsEnable){var t=a.GetOffSet(this.Element);this.SelectOffSet={Top:t.top+t.height+1,Left:t.left+1},a.AppendHtml(document.body,this.GetSelectHtml()),this.IsEnable=!0,this.SelectEventLoad()}}},{key:"SetSelectOffSet",value:function(){var t=this.GetDataMaxWidth(this.SelectDataList)+20;t=t>this.Width+2?t:this.Width+2;var e=30*this.SelectDataList.length;e=e>300?300:e,this.SelectOffSet.Width=t,this.SelectOffSet.Height=e}},{key:"GetSelectHtml",value:function(){this.SelectDataList=this.SearchData(),this.SetSelectOffSet();var t=this.SelectOffSet,e=t.Top,i=t.Left,a=t.Width,s=t.Height,o=n.GetZIndex(),r=[];return r.push('<div class="TextSelect" style="z-index:'+o+";top:"+e+"px;left:"+i+"px;width:"+a+"px;height:"+s+'px;" id="divSelect_'+this.Id+'">'),r.push('<div class="SelectArea" id="divContent_'+this.Id+'">'),r.push(this.GetItemHtml(this.SelectDataList)),r.push("</div></div>"),r.join("")}},{key:"GetItemHtml",value:function(t){var e=this,i=[],a="",s="";return i.push("<ul>"),t.forEach(function(t){t.Id=n.CreateGuid(),a=t[e.ValueName],s=t[e.TextName],n.IsNullOrEmpty(a)||n.IsNullOrEmpty(s)||i.push('<li><a class="DivRadiusBorder" id='+t.Id+' href="javascript:void(0);">'+s+"</a></li>")}),i.push("</ul>"),i.join("")}},{key:"GetDataMaxWidth",value:function(t){var e=this,i=0,a=0,s=null;return t.forEach(function(t){(s=t[e.TextName])&&(a=n.ComputeStringWidth(s),i=a>i?a:i)}),i}},{key:"SearchData",value:function(){var t=this,e=a.GetValue(this.Element),i=[],n=0;if(e){var s="",o="";this.DataList.forEach(function(n){s=n[t.ValueName],o=n[t.TextName],s&&o&&o.indexOf(e)>=0&&i.push(n)})}else{n=this.DataList.length>this.MaxItemLength?this.MaxItemLength:this.DataList.length;for(var r=0;r<n;r++)i.push(this.DataList[r])}return i}},{key:"SelectEventLoad",value:function(){var t=this;this.SelectTag=a.GetById("divSelect_"+this.Id),this.ContentTag=a.GetById("divContent_"+this.Id),a.OffBindEvent(document.body,"click.TextSelect"),a.BindEvent(document.body,"click.TextSelect",function(e){var i=t.SelectOffSet,n=i.Top,a=i.Left,s=i.Width,o=i.Height,r=e.pageX,u=e.pageY,l=!0;r<a||r>a+s?l=!1:(u<n-35||u>n+o)&&(l=!1),l||t.Destory()}),this.BindSelectEvents()}},{key:"BindSelectEvents",value:function(){var t=this;this.SelectDataList.forEach(function(e){a.BindEvent(a.GetById(e.Id),"click",function(e){t.SetSelectItem(e.target.id)})})}},{key:"SetSelectItem",value:function(t){var e=this.SelectDataList.filter(function(e){return e.Id===t});1===e.length&&(this.SelectText=e[0][this.TextName],this.SelectValue=e[0][this.ValueName],a.SetValue(this.Element,this.SelectText),this.Destory())}},{key:"GetValue",value:function(){return this.SelectValue||""}},{key:"SetValue",value:function(t){var e=this;this.SelectValue=t;var i=this.DataList.filter(function(i){return n.IsEquals(i[e.ValueName],t)});1===i.length&&(this.SelectText=i[0][this.TextName],a.SetValue(this.Element,this.SelectText))}},{key:"DataLoad3",value:function(){var t=this;this.DataSource&&(this.Element.placeholder="数据源加载中……",this.GetDataList().then(function(){t.Element.placeholder="",!t.SelectText&&t.SelectValue&&t.SetValue(t.SelectValue)}))}},{key:"Destory",value:function(){this.IsEnable=!1,a.RemoveElement(document.body,this.SelectTag),a.OffBindEvent(document.body,"click.TextSelect")}}]),e}(e)}($ns),function(t){var e=t.utils.Common,i=t.data.Index.GetStateValue;t.components.Index=function(){function t(i){_classCallCheck(this,t),this.Id=e.CreateGuid(),i&&Object.assign(this,i)}return _createClass(t,[{key:"GetHtml",value:function(){return""}},{key:"InitTagObject",value:function(){}},{key:"EventLoad2",value:function(){}},{key:"DataLoad2",value:function(){}},{key:"EventLoad",value:function(){this.InitTagObject(),this.ComponentList&&this.ComponentList.forEach(function(t){return t.EventLoad()}),this.ControlList&&this.ControlList.forEach(function(t){return t.EventLoad()}),this.EventLoad2()}},{key:"DataLoad",value:function(){this.ComponentList&&this.ComponentList.forEach(function(t){return t.DataLoad()}),this.ControlList&&this.ControlList.forEach(function(t){return t.DataLoad()}),this.DataLoad2()}},{key:"GetDataValue",value:function(t,e){var n=this;return i(t,this.KeyName,e,this[e]).then(function(t){return null!=t&&(n[e]=t),Promise.resolve(null!=t)})}},{key:"IsFailMessage",value:function(t){return!!t.ActionFailedMessage&&(e.Alert(t.ActionFailedMessage),!0)}}]),t}()}($ns),function(t){var e=t.components.Index,i=t.controls.Button;t.components.Buttons=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.Actions=n.Actions||[],n.ControlList=n.Actions.map(function(t){return new i({Action:t,Width:t.Width})}),n.Styles=n.Styles||{UlButton:"UlButton"},n}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=[];return t.push('<ul cass="UlButton">'),t=t.concat(this.ControlList.map(function(t){return"<li>"+t.GetHtml()+"</li>"})),t.push("</ul>"),t.join("")}}]),e}(e)}($ns),function(t){var e=t.components.Index,i=t.controls,n=i.SpanLabel,a=i.SpanText,s=i.TextBox,o=i.GridView,r=i.DownList,u=i.TextArea,l=i.TextSelect,h=i.Button,c=t.utils.Common;t.components.PropertyItem=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.InitControls(),e.IsPassword="Password"===e.Property.ControlType,e}return _inherits(i,e),_createClass(i,[{key:"InitControls",value:function(){var e=this.Property;!e.Action&&e.ActionInvoke&&(e.Action=new t.actions.Index(this),e.Action.Invoke=e.ActionInvoke),this.ControlList=[],this.ControlList.push(new n(this.Property)),this.ControlList.push(this.GetControl())}},{key:"GetControl",value:function(){switch(this.Property.ControlType){case"GridView":return new o(this.Property);case"DownList":return new r(this.Property);case"TextArea":return new u(this.Property);case"Button":return new h(this.Property);case"SpanText":return new a(this.Property);case"TextSelect":return new l(Object.assign({EnterControl:this.EnterControl},this.Property));default:return new s(Object.assign({EnterControl:this.EnterControl},this.Property))}}},{key:"GetRowClassName",value:function(){return this.ControlList[1].GetRowClassName()}},{key:"GetHtml",value:function(){var t=[],e=null,i=0,n=0;return!this.IsTd&&t.push("<dl>"),e=this.ControlList[0],this.IsTd?t.push('<td style="text-align:right;">'+e.GetHtml()+"</td>"):t.push("<dt>"+e.GetHtml()+"</dt>"),i+=e.Width,n=e.Height,e=this.ControlList[1],this.IsTd?t.push('<td style="text-align:left;">'+e.GetHtml()+"</td>"):t.push("<dd>"+e.GetHtml()+"</dd>"),i+=e.Width+10,n=e.Height>n?e.Height:n,this.Width=i,this.Height=n,!this.IsTd&&t.push("</dl>"),t.join("")}},{key:"GetValue",value:function(){return this.ControlList[1].GetValue()}},{key:"Validate",value:function(t,e){e=void 0===e||e;var i=this.Property,n=i.IsNullable,a=i.Label,s=i.MaxLength,o=i.DataType,r="",u=!0;!1===n&&c.IsNullOrEmpty(t)&&e&&(r=a+"不能为空！",u=!1),u&&s>0&&t&&t.length>s&&(r=a+"字符长度超过"+s+"个！",u=!1);var l="int"===o||"long"===o||"float"===o||"money"===o,h=this.ControlList[1];return u&&l&&h.ValidateNumber&&(r=h.ValidateNumber(t))&&(u=!1),u&&"date"===o&&h.ValidateDate&&(r=h.ValidateDate(t))&&(u=!1),u||c.Alert(r),u}},{key:"SetValue",value:function(t){this.ControlList[1].SetValue(t)}}]),i}(e)}($ns),function(t){var e=t.components.Index,i=t.controls,n=i.DataSpan,a=i.LinkButton,s=i.LinkButtonList,o=i.DataCheckBox,r=t.utils.HtmlTag;t.components.DataItem=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.BorderColor=i.BorderColor||"#a6c9e2",i.InitControls(),i}return _inherits(e,t),_createClass(e,[{key:"InitControls",value:function(){var t=this;this.ControlList=[],this.IsCheckBox&&(this.CheckBoxControl=new o({CheckChanged:function(e){return t.CheckChanged(e)}}),this.ControlList.push(this.CheckBoxControl)),this.Data&&(this.ControlList=this.ControlList.concat(this.Properties.map(function(e){return t.GetControl(e)})))}},{key:"CheckChanged",value:function(t){if(t){for(var e=this.DataGrid.GetCheckBoxControlList(),i=0;i<e.length;i++)if(!e[i].GetChecked()){t=!1;break}t&&this.DataGrid.GridHeaderComponent.CheckBoxControl.SetChecked(!0)}else this.DataGrid.GridHeaderComponent.CheckBoxControl.SetChecked(!1)}},{key:"GetControl",value:function(t){switch(t.ControlType){case"LinkButton":return new a(Object.assign({RowData:this.Data},t));case"LinkButtonList":return new s(Object.assign({RowData:this.Data},t));default:return new n(Object.assign({Value:this.Data[t.Name]},t))}}},{key:"InitTagObject",value:function(){this.TrTag=r.GetById(this.Id)}},{key:"EventLoad2",value:function(){var t=this;r.BindEvent(this.TrTag,"click",function(e){return t.ClickRow(e)})}},{key:"DataLoad2",value:function(){if(this.Data&&this.SelectIdList&&this.SelectIdList.length>0){var t=this.Data[this.PrimaryKey],e=this.SelectIdList.filter(function(e){return e===t});e&&e.length>0&&(this.DataSelected=!0,this.SetSelectRow())}}},{key:"ClickRow",value:function(){if(!this.TrTag.Selected||this.DataSelected){if(this.DataSelected=!1,this.TrTag.parentNode&&this.TrTag.parentNode.childNodes.length>0)for(var t=null,e=0;e<this.TrTag.parentNode.childNodes.length;e++)t=this.TrTag.parentNode.childNodes[e],t.Selected=!1,r.RemoveClass(t,"SelectTr");this.SetSelectRow()}}},{key:"SetSelectRow",value:function(){r.AddClass(this.TrTag,"SelectTr"),this.TrTag.Selected=!0,this.CheckBoxControl&&this.CheckBoxControl.SetChecked()}},{key:"GetValue",value:function(){return this.Data}},{key:"GetHtml",value:function(){var t=this,e=[];e.push("<tr id="+this.Id+' style="border-bottom:1px solid '+this.BorderColor+'">');var i="",n="",a="";return this.ControlList.forEach(function(s,o){a=s.GetHtml(),n=s.TextAlign?" text-align:"+s.TextAlign:"",i=o>0?"border-left:1px solid "+t.BorderColor+";":"",e.push('<td style="width:'+s.ColumnWidth+"px;"+i+n+'">'),e.push(a+"</td>")}),e.push("</tr>"),e.join("")}}]),e}(e)}($ns),function(t){var e=t.components.Index,i=t.controls,n=i.DataSpan,a=i.DataCheckBox,s=t.utils.HtmlTag;t.components.GridHeader=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.BorderColor=i.BorderColor||"#a6c9e2",i.Styles=i.Styles||{DivHeader:"DivHeader"},i.InitControls(),i}return _inherits(e,t),_createClass(e,[{key:"InitControls",value:function(){var t=this;this.ControlList=[],this.IsCheckBox&&(this.CheckBoxControl=new a({CheckChanged:function(e){return t.CheckChanged(e)}}),this.ControlList.push(this.CheckBoxControl)),this.ControlList=this.ControlList.concat(this.Properties.map(function(t){return new n(Object.assign({Value:t.Label||t.Name,IsLabel:!0},t))}))}},{key:"CheckChanged",value:function(t){this.DataGrid.GetCheckBoxControlList().forEach(function(e){return e.SetChecked(t)})}},{key:"InitTagObject",value:function(){this.TableTag=s.GetById(this.Id)}},{key:"GetGridWidth",value:function(){return s.GetWindowWidth()-40}},{key:"GetHtml",value:function(){var t=this,e=[],i=this.IsFixedWidth?this.Width:this.GetGridWidth();i=i>this.Width?i:this.Width,e.push('<div class="'+this.Styles.DivHeader+'"><div style="padding-right:20px;">'),e.push('<table cellpadding="0" cellspacing="0" border="0" style="width:'+i+'px" id="'+this.Id+'"><thead><tr>');var n="";return this.ControlList.forEach(function(i,a){n=a>0?"border-left:1px solid "+t.BorderColor+";":"",e.push('<th style="width:'+i.ColumnWidth+"px;"+n+'">'),e.push(i.GetHtml()+"</th>")}),e.push("</tr></thead></table></div></div>"),e.join("")}}]),e}(e)}($ns),function(t){var e=t.components,i=e.Index,n=e.GridHeader,a=e.DataItem,s=t.data.Index.Connect,o=t.utils,r=o.Common,u=o.HtmlTag,l=t.actions,h=l.EditAction,c=l.DeleteAction,d=l.UpdateStatusAction,f=l.LookRejectRecordAction,p=l.LookOperationLogAction;t.components.DataGrid=function(e){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.Styles=e.Styles||{DivGrid:"DivGrid",DivGridContent:"DivGridContent"},e}return _inherits(i,e),_createClass(i,[{key:"InitControls",value:function(){var e=this;this.DataList=[],this.GetDataActions(),this.Properties.forEach(function(i){!i.Action&&i.ActionInvoke&&(i.Action=new t.actions.Index(e),i.Action.Invoke=i.ActionInvoke)}),this.Properties=this.Properties.sort(function(t,e){return t.X>e.X?1:-1}),this.IsDataStatus&&this.Properties.push({Name:"DataStatusName",Label:"状态",ColumnWidth:40,TextAlign:"center"}),this.DataActions.length>0&&this.Properties.push({Name:"Operation",Label:"操作",Actions:this.DataActions,ColumnWidth:40*this.DataActions.length,ControlType:"LinkButtonList",TextAlign:"center"}),this.ComputeWidth(),this.GridHeaderComponent=new n({Properties:this.Properties,DataGrid:this,IsCheckBox:this.IsCheckBox,Width:this.Width,IsFixedWidth:this.IsFixedWidth}),this.ComponentList=[this.GridHeaderComponent]}},{key:"ComputeWidth",value:function(){var t=0,e=0;this.Properties.forEach(function(i){t+=i.ColumnWidth>0?i.ColumnWidth:0,e+=i.ColumnWidth>0?0:1});if(e>0&&800>t){var i=Math.floor((800-t-10)/e);this.Properties.forEach(function(t){t.ColumnWidth=t.ColumnWidth>0?t.ColumnWidth:i})}this.Width=this.Width||t}},{key:"GetDataActions",value:function(){return this.DataActions=[],this.IsDataStatus&&this.DataActions.push(new d(this)),this.IsDataStatus&&this.DataActions.push(new f(this)),this.IsLookLog&&this.DataActions.push(new p(this)),this.IsEdit&&this.DataActions.push(new h(this)),this.IsDelete&&this.DataActions.push(new c(this)),this.DataActions}},{key:"GetGridWidth",value:function(){return u.GetWindowWidth()-40}},{key:"GetHtml",value:function(){this.InitControls();var t=[],e=this.IsFixedWidth?this.Width:this.GetGridWidth();e=e>this.Width?e:this.Width,t.push('<div class="'+this.Styles.DivGrid+'">'),t.push(this.ComponentList[0].GetHtml());var i="",n=[];return this.Height>0&&n.push("height:"+(this.Height-60)+"px;"),n.length>0&&(i=' style="'+n.join("")+'"'),t.push('<div class="'+this.Styles.DivGridContent+'"'+i+">"),t.push('<table cellpadding="0" cellspacing="0" border="0" style="width:'+e+'px;" id="'+this.Id+'">'),t.push("<tbody></tbody></table></div></div>"),t.join("")}},{key:"InitTagObject",value:function(){this.TableTag=u.GetById(this.Id),this.TableTbodyTag=r.ArrayFirst(u.Find(this.TableTag,"tbody"))}},{key:"EventLoad2",value:function(){var t=this,e=this.TableTag.parentNode,i=this.GridHeaderComponent.TableTag;u.BindEvent(e,"scroll",function(t){i.CurrentLeft!==t.target.scrollLeft&&(i.CurrentLeft=t.target.scrollLeft,i.style.left=-t.target.scrollLeft+"px")}),this.IsLocalData||this.Height||(this.SetReSize(),u.BindEvent(window,"resize."+this.Id,function(e){return window.setTimeout(function(){return t.SetReSize(e)},10)})),this.ChangeTdWidth()}},{key:"DataLoad",value:function(){var e=this;this.Properties.forEach(function(e){t.data.Cache.GetPropertyDataList(e)}),s(function(t){e.GetDataValue(t,"QueryResponse").then(function(t){t&&e.SetQueryResponse()})})}},{key:"ChangeTdWidth",value:function(){var t=this;u.Find(this.GridHeaderComponent.TableTag,"thead>tr>th").forEach(function(e){u.BindEvent(e,"mousedown",function(e){return t.ThMouseDown(e)}),u.BindEvent(e,"mousemove",function(e){return t.ThMouseMove(e)})}),u.BindEvent(window,"mousemove."+this.Id,function(e){return t.WindowMouseMove(e)}),u.BindEvent(window,"mouseup."+this.Id,function(e){return t.WindowMouseUp(e)})}},{key:"ThMouseDown",value:function(t){if("checkbox"!==t.target.type&&(!t.target.childNodes||"checkbox"!==t.target.childNodes[0].type)){if(this.IsCanMove){this.IsThMouseDown=!0,this.SelectTh="span"===t.target.tagName?t.target.parentNode:t.target,this.MoveLineId=this.MoveLineId||r.CreateGuid(),this.StartX=t.pageX;var e=u.GetOffSet(this.TableTag.parentNode),i=e.top-32,n=e.height+32;e=u.GetOffSet(this.SelectTh);var a=e.left+e.width;a=a<this.StartX?this.StartX:a;var s=r.GetZIndex(),o='<div class="DivMoveLine" id="'+this.MoveLineId+'" style="height:'+n+"px;top:"+i+"px;left:"+a+"px;z-index:"+s+'"></div>';u.AppendHtml(document.body,o)}return!1}}},{key:"ThMouseMove",value:function(t){if("checkbox"!==t.target.type&&(!t.target.childNodes||"checkbox"!==t.target.childNodes[0].type)){var e="span"===t.target.tagName?t.target.parentNode:t.target,i=u.GetOffSet(e),n=i.width;if(this.IsThMouseDown){u.SetStyleValue(e,"cursor","e-resize"),this.IsMoveTh=!0;var a=u.GetById(this.MoveLineId);return u.SetStyleValue(a,"left",t.pageX+"px"),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),!1}t.pageX+10>i.left+n-this.TableTag.parentNode.scrollLeft?(u.SetStyleValue(e,"cursor","e-resize"),this.IsCanMove=!0):u.SetStyleValue(e,"cursor","default")}}},{key:"WindowMouseMove",value:function(t){if(this.IsThMouseDown)return document.unselectable="on",document.onselectstart=function(){return!1},void(window.getSelection?window.getSelection().removeAllRanges():document.selection.empty())}},{key:"WindowMouseUp",value:function(t){if(this.IsThMouseDown&&this.IsMoveTh&&this.SelectTh){var e=t.pageX-this.StartX,i=this.SelectTh,n=u.GetOffSet(i),a=n.width,s=a+e;s=s<30?30:s,e=s-a,this.SetThTdWidth(i,s),u.SetStyleValue(i,"cursor","default"),n=u.GetOffSet(this.TableTag),s=n.width+e,u.SetWidth(this.TableTag,s),u.SetWidth(this.GridHeaderComponent.TableTag,s)}u.RemoveElement(document.body,u.GetById(this.MoveLineId)),this.IsThMouseDown=!1,this.IsMoveTh=!1,this.SelectTh=null,this.IsCanMove=!1,document.unselectable="off",document.onselectstart=null}},{key:"SetThTdWidth",value:function(t,e){var i=-1,n=null,a=u.Find(this.GridHeaderComponent.TableTag,"thead>tr>th"),s=[];a.forEach(function(e,a){e===t&&(i=a),n=u.GetOffSet(e),s.push(n.width),u.SetWidth(e,n.width)}),u.SetWidth(t,e);var o=u.Find(this.TableTag,"tbody>tr"),r=null,l=[];o.forEach(function(t){for(var e=0;e<t.childNodes.length;e++)r=t.childNodes[e],e===i&&l.push(r),u.SetWidth(r,s[e])}),l.forEach(function(t){u.SetWidth(t,e)})}},{key:"SetReSize",value:function(t){var e=this.TableTag.parentNode.parentNode.parentNode,i=u.GetOffSet(e),n=u.GetWindowHeight();if(n=n-i.top-90,n=n<250?250:n,u.SetHeight(this.TableTag.parentNode,n),!this.IsFixedWidth){var a=this.GetGridWidth();a>this.Width&&(u.SetWidth(this.TableTag,a),u.SetWidth(this.GridHeaderComponent.TableTag,a))}}},{key:"SaveData",value:function(t){var e=this.Entity.PrimaryKey,i=this.DataList.filter(function(i){return i[e]===t[e]});i&&1===i.length?i[0]=Object.assign(i[0],t):this.DataList.push(t),this.BindData([t[e]])}},{key:"DeleteData",value:function(t){for(var e=-1,i=this.Entity.PrimaryKey,n=0;n<this.DataList.length;n++)if(this.DataList[n][i]===t){e=n;break}e>=0&&(this.DataList.splice(e,1),this.BindData([]))}},{key:"GetValue",value:function(){return this.DataList}},{key:"SetValue",value:function(t){t&&t.length>0&&(this.DataList=t.map(function(t){return Object.assign({},t)})),this.BindData([])}},{key:"BindData",value:function(t){var e=this;this.RowCount=this.DataList.length,this.DataItemComponentList=this.DataList.map(function(i,n){return new a({RowIndex:n,Properties:e.Properties,Data:i,IsCheckBox:e.IsCheckBox,IsFixedWidth:e.IsFixedWidth,PrimaryKey:e.Entity.PrimaryKey,DataGrid:e,SelectIdList:t})});var i=this.DataItemComponentList.map(function(t,e){return t.GetHtml()});if(u.SetHtml(this.TableTbodyTag,i.join("")),this.DataItemComponentList.forEach(function(t){t.EventLoad(),t.DataLoad()}),this.IsLocalData&&this.SpanRecord){var n="共 "+this.RowCount+" 条记录";u.SetHtml(this.SpanRecord,n)}this.IsCheckBox&&this.GridHeaderComponent.CheckBoxControl.SetChecked(!1)}},{key:"SetQueryResponse",value:function(){var t=this.QueryResponse;if(null!=t&&!this.IsFailMessage(t)&&null!=t.DataList){var e=t.Ids?t.Ids.split(","):[];this.DataList=t.DataList,this.BindData(e)}}},{key:"GetCheckBoxControlList",value:function(){return this.DataItemComponentList.map(function(t){return t.CheckBoxControl})}},{key:"GetCheckedValue",value:function(){var t=[];return this.DataItemComponentList.forEach(function(e){e.CheckBoxControl.GetChecked()&&t.push(e.Data)}),t}}]),i}(i)}($ns),function(t){var e=t.components.Index,i=t.data.Index.Connect,n=t.controls,a=n.Button,s=n.SpanLabel,o=n.TextBox,r=t.actions.PagingIndexQueryAction,u=t.utils,l=u.Common,h=u.HtmlTag;t.components.DataPaging=function(e){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.Styles=e.Styles||{DivPage:"DivPage"},e}return _inherits(n,e),_createClass(n,[{key:"InitControls",value:function(){var t=new a({Action:new r(this),Width:50});this.ControlList=[],this.ControlList.push(this.GetPagingButton("PagingFirstAction")),this.ControlList.push(this.GetPagingButton("PagingPreAction")),this.ControlList.push(new s({Label:1,IsColon:!1,IsWidth:!1,ClassName:"SpanIndex"})),this.ControlList.push(this.GetPagingButton("PagingNextAction")),this.ControlList.push(this.GetPagingButton("PagingLastAction")),this.ControlList.push(new s({Label:"到",IsColon:!1,IsWidth:!1})),this.ControlList.push(new o({Name:"IndexCount",MaxLength:10,Width:50,EnterControl:t})),this.ControlList.push(new s({Label:"页",IsColon:!1,IsWidth:!1})),this.ControlList.push(t),this._ctls={First:this.ControlList[0],Pre:this.ControlList[1],Next:this.ControlList[3],Last:this.ControlList[4],IndexCount:this.ControlList[6],IndexQuery:this.ControlList[8]}}},{key:"GetPagingButton",value:function(e){return new a({Action:new t.actions[e](this),ClassName:"Button",Width:35})}},{key:"GetHtml",value:function(){this.IsPage&&this.InitControls();var t=[];return t.push('<div class="'+this.Styles.DivPage+'" style="display:none;" id="'+this.Id+'">'),t.push('<div class="DivLeft"><span class="SpanRecord" id="record_'+this.Id+'"></span></div>'),this.IsPage&&(t.push('<div class="DivRight"><ul>'),t=t.concat(this.ControlList.map(function(t){return"<li>"+t.GetHtml()+"</li>"})),t.push("</ul></div>")),t.push("</div>"),t.join("")}},{key:"InitTagObject",value:function(){this.PageTag=h.GetById(this.Id),this.SpanRecord=h.GetById("record_"+this.Id)}},{key:"DataLoad",value:function(){var t=this;i(function(e){t.GetDataValue(e,"QueryResponse").then(function(e){e&&t.SetQueryResponse()})})}},{key:"SetQueryResponse",value:function(){var t=this.QueryResponse;null!=t&&(t.PageRecord>=0?this.PageRecord=t.PageRecord:t.DataList&&0!==t.DataList.length||(this.PageRecord=0),this.IsPage?this.BindPage():(this.PageRecord=t.DataList.length,this.BindRecord()))}},{key:"BindRecord",value:function(){if(0==this.PageRecord)return void h.SetHide(this.PageTag);var t="共 "+this.PageRecord+" 条记录";h.SetHtml(this.SpanRecord,t),h.SetShow(this.PageTag)}},{key:"BindPage",value:function(){if(this.PageIndex=this.SearchAction.PageIndex,0==this.PageRecord)return this.PageIndex=1,this.PageCount=0,void h.SetHide(this.PageTag);this.PageRecord%this.PageSize==0?this.PageCount=parseInt(this.PageRecord/this.PageSize):this.PageCount=parseInt(this.PageRecord/this.PageSize)+1,this.PageIndex=this.PageIndex<1?1:this.PageIndex,this.PageIndex=this.PageIndex>this.PageCount?this.PageCount:this.PageIndex,this.ControlList[2].SetValue(this.PageIndex);var t=(this.PageIndex-1)*this.PageSize+1,e=this.PageIndex*this.PageSize;e=e>this.PageRecord?this.PageRecord:e;var i=t+" - "+e+" 共 "+this.PageCount+" 页 "+this.PageRecord+" 条记录";h.SetHtml(this.SpanRecord,i),this.SetPageControlDisabled(),h.SetShow(this.PageTag)}},{key:"SetPageControlDisabled",value:function(){var t=this,e=this.JudgePage();e.Enableds.forEach(function(e){return t._ctls[e].SetDisabled(!1)}),e.Disbleds.forEach(function(e){return t._ctls[e].SetDisabled(!0)})}},{key:"JudgePage",value:function(){var t={};return this.PageCount<=1?(t.Enableds=[],t.Disbleds=["First","Pre","Next","Last","IndexCount","IndexQuery"]):1==this.PageIndex?(t.Enableds=["Next","Last","IndexCount","IndexQuery"],t.Disbleds=["First","Pre"]):this.PageIndex==this.PageCount?(t.Enableds=["First","Pre","IndexCount","IndexQuery"],t.Disbleds=["Next","Last"]):(t.Enableds=["First","Pre","Next","Last","IndexCount","IndexQuery"],t.Disbleds=[]),t}},{key:"GetInputPageIndex",value:function(){var t=this.ControlList[6],e=parseInt(t.GetValue());return e>0&&e<=this.PageCount?(this.PageIndex=e,t.SetValue(""),this.PageIndex):(l.Alert("对不起，请输入1至"+this.PageCount+"之间的自然数页索引！").then(function(){return t.Element.focus()}),!1)}}]),n}(e)}($ns),function(t){var e=t.components.Index,i=t.utils,n=i.Common,a=i.HtmlTag,s=t.actions,o=s.DialogOkAction,r=s.DialogCancelAction,u=t.components.Buttons;t.components.Dialog=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Styles=i.Styles||{DialogBackground:"DialogBackground",DivDialog:"DivDialog"},n.InitValue(i,["IsClosed","IsOkButton"],!0),i.DialogKey="Dialog_"+i.Id.substring(0,8),i}return _inherits(e,t),_createClass(e,[{key:"InitControls",value:function(){this.Actions=this.Actions||this.GetActions(),this.ButtonsComponent=new u({Actions:this.Actions}),this.ComponentList=[this.ButtonsComponent],this.Width+=50,this.Height+=100}},{key:"GetActions",value:function(){var t=[],e=new o(this);return this.OkLabel&&(e.Label=this.OkLabel),this.IsOkButton&&t.push(e),this.IsClosed&&t.push(new r(this)),t}},{key:"GetHtml",value:function(){var t=a.GetWindowWidth(),e=a.GetWindowHeight(),i=n.GetZIndex(),s=[];s.push('<div class="'+this.Styles.DialogBackground+'" id="bg_'+this.Id+'" style="z-index:'+i+';">'),s.push("</div>");var o=Math.round(e/2-this.Height/2-30),r=Math.round(t/2-this.Width/2);return o=o<10?10:o,r=r<10?10:r,t=this.Width,e=this.Height,i=n.GetZIndex(),s.push('<div class="DivRadiusBorder '+this.Styles.DivDialog+'" id="'+this.Id+'"'),s.push(' style="position:absolute;width:'+t+"px;height:"+e+"px;z-index:"+i+";top:"+o+"px;left:"+r+'px;">'),s.push(this.GetHeaderHtml()),e-=80,s.push('<div class="DivContent" style="height:'+e+'px;">'+this.Html+"</div>"),s.push(this.GetButtonsHtml()),s.push("</div>"),s.join("")}},{key:"GetButtonsHtml",value:function(){return'<div class="DivButton">'+this.ButtonsComponent.GetHtml()+"</div>"}},{key:"GetHeaderHtml",value:function(){var t=[];return t.push('<div class="DivRadiusBorder DivTitleHeader" id="header_'+this.Id+'">'),t.push('<span class="SpanTitle">'+this.Title+"</span>"),this.IsClosed&&t.push('<a href="javascript:void(0);" id="close_'+this.Id+'"><span class="ui-icon ui-icon-closethick"></span></a>'),t.push("</div>"),t.join("")}},{
    key:"Show",value:function(){var t=this;this.InitControls(),a.AppendHtml(document.body,this.GetHtml()),this.DivBackground=a.GetById("bg_"+this.Id),this.DivDialog=a.GetById(this.Id),this.IsClosed&&a.BindEvent(a.GetById("close_"+this.Id),"click",function(){return t.Close()});var e=a.GetById("header_"+this.Id);a.BindEvent(e,"mousedown",function(e){return t.Down(e)}),a.OffBindEvent(window,"mousemove."+this.DialogKey),a.BindEvent(window,"mousemove."+this.DialogKey,function(e){return t.Move(e)}),a.BindEvent(e,"mouseup",function(e){return t.Up(e)}),this.EventLoad(),this.DataLoad()}},{key:"Down",value:function(t){this.IsStart=!0;var e=a.GetOffSet(this.DivDialog);this.StartX=t.pageX-e.left,this.StartY=t.pageY-e.top}},{key:"Move",value:function(t){if(this.IsStart){this.IsMove=!0;var e=a.GetWindowWidth(),i=a.GetWindowHeight(),n=t.pageX-this.StartX,s=t.pageY-this.StartY;n=n+this.Width>e-20?e-this.Width-20:n,s=s+this.Height>i-20?i-this.Height-20:s,n=n<1?1:n,s=s<1?1:s,a.SetStyle(this.DivDialog,{left:n+"px",top:s+"px"})}}},{key:"Up",value:function(t){this.IsMove&&(this.IsStart=!1)}},{key:"Close",value:function(){a.RemoveElement(document.body,this.DivDialog),a.RemoveElement(document.body,this.DivBackground),a.OffBindEvent(window,"mousemove."+this.DialogKey)}}]),e}(e)}($ns),function(t){var e=t.utils.Common;t.components.AlertConfirm=function(){function i(t){_classCallCheck(this,i),this.Id=e.CreateGuid(),t&&Object.assign(this,t),this.Init()}return _createClass(i,[{key:"Init",value:function(){this.Message=e.IsNullOrEmpty(this.Message)?"":this.Message.toString(),this.Message=this.Message.replace(/</g,"&lt;"),this.Message=this.Message.replace(/>/g,"&gt;"),this.ImgDivClassName=this.IsConfirm?"DivConfirm":"DivWarn";var t=300,i=100,n=15*this.Message.length;n>500?(t=500,i=150):n>t&&(t=n),this.Width=t,this.Height=i}},{key:"GetHtml",value:function(){var t=[];return t.push('<table class="Alert" border="0"cellpadding="0" cellspacing="0"><tr align="left">'),t.push('<td valign="top" width="40px"><div class="'+this.ImgDivClassName+'"></div></td>'),t.push('<td valign="top"><div class="Text"><span>'+this.Message+"</span></div></td>"),t.push("</tr></table>"),t.join("")}},{key:"ShowDialog",value:function(e){var i=new t.components.Dialog({Width:this.Width,Height:this.Height,Html:this.GetHtml(),IsClosed:!1,OkAction:{Invoke:function(){i.Close(),e()}},Title:this.IsConfirm?"确认信息":"提示信息"}),n=[new t.actions.DialogOkAction(i)];n[0].IsOkFocus=!0,this.IsConfirm&&(i.IsClosed=!0,n.push(new t.actions.DialogCancelAction(i))),i.Actions=n,i.Show()}},{key:"Show",value:function(){var t=this;return new Promise(function(e,i){t.ShowDialog(e)})}}]),i}()}($ns),function(t){var e=t.utils,i=e.Common,n=e.HtmlTag;t.components.ExcelImport=function(){function e(t){_classCallCheck(this,e),this.Id=i.CreateGuid(),t&&Object.assign(this,t)}return _createClass(e,[{key:"Import",value:function(){window.FileReader?this.ExcelImportForFileReader():i.Alert("对不起，浏览器不支持Excel导入方式，请使用Chrome或Chrome内核浏览器！")}},{key:"ExcelImportForFileReader",value:function(){var e=this;this.ExcelImportDialog=new t.components.Dialog({Width:600,Height:100,Html:this.GetHtml(),Title:"Excel导入",OkLabel:"导入",OkAction:{Invoke:function(t,i){e.ExecExcelImport(i)}}}),this.ExcelImportDialog.Show()}},{key:"ExecExcelImport",value:function(t){var e=n.GetById("file_"+this.Id),a=e.files;if(0==a.length)return void i.Alert("对不起，请选择Excel导入文件！");var s=a[0],o="";return"application/vnd.ms-excel"==s.type?o=".xls":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==s.type&&(o=".xlsx"),""==o?void i.Alert("对不起，只能导入Excel文件！"):s.size>1048576?void i.Alert("对不起，Excel文件大小不能大于1M"):(t.SetDisabled(!0),void this.SendFileRequest(s,o,t))}},{key:"GetHtml",value:function(){var t=[];return t.push('<div class="DivText"><dl><dt><span>Excel文件：</span></dt>'),t.push('<dd><input type="file" id="file_'+this.Id+'"'),t.push(' accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="width:500px;" class="TextBox"></dd>'),t.push("</dl></div>"),t.join("")}},{key:"SendFileRequest",value:function(t,e,n){var a=this,s="ExcelImportHandler.ashx?EntityName="+this.Entity.Name+"&ft="+e,o=i.GetStorage("LoginUserId");o||i.ToLogin(),s=i.AddURLParameter(s,"LoginUserId",o);var r=new FileReader;r.onloadend=function(){a.Api.PostStreamFetch(s,r.result).then(function(t){n.SetDisabled(!1),t.MessageList&&t.MessageList.length>0?(a.ShowMessageList(t),t.Message&&0===t.Message.indexOf("操作成功")&&(a.SearchAction.ExcelRefresh(),a.ExcelImportDialog.Close())):t.Message&&i.Alert(unescape(t.Message)).then(function(){0===t.Message.indexOf("操作成功")&&(a.SearchAction.ExcelRefresh(),a.ExcelImportDialog.Close())})},function(t){n.SetDisabled(!1);var e=t&&t.message?t.message:t;i.Alert(e)})},r.readAsArrayBuffer(t)}},{key:"ShowMessageList",value:function(e){var n=[],a="错误提示";n.push('<div class="DivList">'),i.IsNullOrEmpty(e.Message)||(n.push('<div class="DivText"><span>'+e.Message+"</span></div>"),0==e.Message.indexOf("操作成功")&&(a="信息")),n.push('<div class="DivData"><div class="DivGridView">'),n.push('<table cellpadding="0" cellspacing="0" border="0">'),n.push('<thead><tr><td width="40">行号</td><td width="800">'+a+"</td></tr></thead>"),n.push("<tbody>"),e.MessageList.forEach(function(t){n.push("<tr>"),n.push("<td>"+t.RowNum+"</td>"),n.push("<td>"+t.Message+"</td>"),n.push("</tr>")}),n.push("</tbody></table></div></div></div>"),this.ExcelMessageDialog=new t.components.Dialog({Width:850,Height:500,Html:n.join(""),Title:"Excel导入提示信息",IsOkButton:!1}),this.ExcelMessageDialog.Show()}}]),e}()}($ns),function(t){var e=t.components.Index,i=t.controls,n=i.SpanLabel,a=i.LinkButton,s=t.actions.ChangePasswordAction;t.components.Login=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Init(),i}return _inherits(e,t),_createClass(e,[{key:"Init",value:function(){var t=this.Page.LoginUser,e=t.LoginName+"，欢迎您";t.LastLoginDate?e=e+"，上一次登录时间："+t.LastLoginDate:e+="，第一次登录系统",this.ControlList=[],this.ControlList.push(new n({IsWidth:!1,IsColon:!1,Label:e})),this.ControlList.push(new a({Action:new s(this.Page)}))}},{key:"GetHtml",value:function(){var t=[];t.push('<div class="DivLogin"><ul>'),t=t.concat(this.ControlList.map(function(t){return"<li>"+t.GetHtml()+"</li>"})),t.push('<li><a href="Index.aspx?page=Default">首页</a></li>');var e=escape("登录");this.Page.LoginUser&&this.Page.LoginUser.UserId;return t.push('<li><a href="Index.aspx?page='+e+'">退出</a></li>'),t.push("</ul></div>"),t.join("")}}]),e}(e)}($ns),function(t){var e=t.components.Index,i=t.utils,n=i.Common,a=i.HtmlTag;t.components.Menu=function(e){function i(t){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return _inherits(i,e),_createClass(i,[{key:"GetHtml",value:function(){var t=[];return t.push('<div class="DivMenu" id='+this.Id+">"),t.push('<div class="DivMenu1">'),t.push("</div>"),t.push('<div class="DivMenu2">'),t.push("</div>"),t.push("</div>"),t.join("")}},{key:"InitTagObject",value:function(){this.MenuTag=a.GetById(this.Id)}},{key:"DataLoad2",value:function(){var t=this;this.GetFirstMenuList().then(function(){t.GetPageMenuList().then(function(){t.GetAdminMenu().then(function(){t.SetMenuList()})})})}},{key:"GetFirstMenuList",value:function(){var t=this;return this.GetKeyValueList("菜单","=","菜单").then(function(e){if(t.FirstMenuList=[],null!=e){var i=n.ArrayFirst(e);i&&(t.FirstMenuList=n.Split(i["值"],["，",","]).map(function(t){return{Name:t}}))}return Promise.resolve()})}},{key:"GetKeyValueList",value:function(e,i,n){return t.data.Cache.GetDataList(e,"键值配置",["键名","值"],[{Name:"键名",Logic:i,Value:n}])}},{key:"GetAdminMenu",value:function(){var t=this;return this.GetKeyValueList("管理员菜单","in","管理员，管理员菜单").then(function(e){if(t.AdminUserList=[],t.AdminMenuList=[],null!=e&&(e.forEach(function(e){"管理员"===e["键名"]&&(t.AdminUserList=n.Split(e["值"],["，",","])),"管理员菜单"===e["键名"]&&(t.AdminMenuList=n.Split(e["值"],["，",","]))}),t.Page.LoginUser)){var i=t.AdminUserList.filter(function(e){return n.IsEquals(e,t.Page.LoginUser.LoginName)});t.IsAdmin=1===i.length,t.SetLogoutHref()}return Promise.resolve()})}},{key:"SetLogoutHref",value:function(){if(this.IsAdmin){var t=a.GetById("alogout_"+this.Page.LoginUser.UserId),e=a.GetAttribute(t,"href");e&&(e+="&debug=true",a.SetAttribute(t,"href",e))}}},{key:"GetPageMenuList",value:function(){var t=this,e=this.FirstMenuList.map(function(t){return"菜单-"+t.Name});return this.GetKeyValueList("页面菜单","in",e.join(",")).then(function(e){return t.PageDataList=[],null!=e&&e.forEach(function(e){n.Split(e["值"],["，",","]).forEach(function(i){t.PageDataList.push({Name:i,MenuName:e["键名"].replace("菜单-","")})})}),Promise.resolve()})}},{key:"SetMenuList",value:function(){var t=this;this.MenuList=[];var e=[],i=null,a=!1,s=!1,o="";this.IsAdmin?e=this.FirstMenuList:this.FirstMenuList.forEach(function(a){i=t.AdminMenuList.filter(function(t){return n.IsEquals(t,a.Name)}),0===i.length&&e.push(a)}),e.forEach(function(e){(i=t.PageDataList.filter(function(t){return t.MenuName===e.Name}))&&i.length>0&&(s=!1,e.ChildMenuList=i.map(function(e){return o=e.Name,a=t.Page.Name===o,a&&(s=!0),{Name:o,Selected:a,Url:t.GetUrl(o)}}),e.Selected=s,e.Id=n.CreateGuid(),t.MenuList.push(e))}),this.LoadMenuHtml(e)}},{key:"LoadMenuHtml",value:function(t){var e=this;a.SetHtml(this.MenuTag,this.GetMenuHtml()),t.forEach(function(i){a.BindEvent(a.GetById(i.Id),"click",function(){t.forEach(function(t){t.Selected=i.Id===t.Id}),e.LoadMenuHtml(t)})})}},{key:"GetUrl",value:function(t){return"Index.aspx?page="+escape(t)}},{key:"GetMenuHtml",value:function(){var t=[];t.push('<div class="DivMenu1"><div class="DivMenuRight">');var e=null;this.MenuList.forEach(function(i){i.Selected?(t.push("<p>"+i.Name+"</p>"),e=i):t.push('<a href="javascript:void(0);" id='+i.Id+">"+i.Name+"</a>")}),t.push("</div></div>"),t.push('<div class="DivMenu2"><ul>');var i="";return e&&e.ChildMenuList.length>0&&e.ChildMenuList.forEach(function(e){i=e.Selected?' class="Active"':"",t.push('<li><a href="'+e.Url+'"'+i+">"+e.Name+"</a></li>")}),t.push("</ul></div>"),t.join("")}}]),i}(e)}($ns),function(t){var e=t.utils,i=e.Common,n=e.HtmlTag;t.components.Loading=function(){function t(){_classCallCheck(this,t),this.Id=i.CreateGuid()}return _createClass(t,[{key:"GetHtml",value:function(){var t=i.GetZIndex(),e=[];return e.push('<div class="DivLoading" id="'+this.Id+'" style="z-index:'+t+';">'),e.push("</div>"),e.join("")}},{key:"Show",value:function(){n.AppendHtml(document.body,this.GetHtml()),this.DivLoading=n.GetById(this.Id)}},{key:"Close",value:function(){n.RemoveElement(document.body,this.DivLoading)}}]),t}()}($ns),function(t){var e=t.utils,i=e.Common;e.HtmlTag;t.components.SelectGridView=function(){function e(t){_classCallCheck(this,e),this.Id=i.CreateGuid(),t&&Object.assign(this,t),i.InitValue(this,["IsSingle"],!0)}return _createClass(e,[{key:"Load",value:function(){var e=this;this.Page=new t.pages.DialogListPage({Width:this.Width,Height:this.Height,GridWidth:this.GridWidth,GridHeight:this.GridHeight,Title:this.Title,IsPage:this.IsPage||!1,Entity:this.Entity,OkAction:{Invoke:function(t,i){return e.OkActionInvoke(t,i)}},IsCheckBox:!this.IsSingle}),this.Page.Load()}},{key:"OkActionInvoke",value:function(t,e){var n=this,a=this.Page.GetDataGridCheckedValue();if(0===a.length)return void i.Alert("请选择数据行！");if(this.SetSelectRows)this.SetSelectRows(a).then(function(){return n.Page.ListDialog.Close()});else{var s=this.SelectDataGrid.DataList.length,o=null,r=[],u=0;a.forEach(function(t){o=n.SelectDataGrid.DataList.filter(function(e){return e[n.Entity.PrimaryKey]===t[n.Entity.PrimaryKey]}),0===o.length&&(u++,r.push(n.SetSelectRowData(t,u,s)))}),r.length>0&&(this.SelectDataGrid.DataList=this.SelectDataGrid.DataList.concat(r),this.SelectDataGrid.SetValue()),this.Page.ListDialog.Close()}}}]),e}()}($ns),function(t){var e=t.utils.Common;t.layouts.Index=function(){function t(i){_classCallCheck(this,t),this.Id=e.CreateGuid(),this.ComponentList=[],i&&Object.assign(this,i)}return _createClass(t,[{key:"ExpandRowComponents",value:function(){}},{key:"GetRowList",value:function(){var t=this,e=0;this.ComponentList.forEach(function(t){t.Property.X>e&&(e=t.Property.X)}),this.RowCount=e,this.RowList=[];for(var i=null,n=null,a=null,s=0;s<e;s++)!function(e){n=t.ComponentList.filter(function(t){return t.Property.X===e+1}),n=n.sort(function(t,e){return t.Property.Y>e.Property.Y?1:-1}),n.length>0&&n[0].GetRowClassName&&(a=n[0].GetRowClassName()),i={Components:n,ClassName:a},t.ExpandRowComponents(i,e),i.Components.length>0&&t.RowList.push(i)}(s);return this.RowList}}]),t}()}($ns),function(t){var e=t.layouts.Index;t.layouts.Search=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Styles=i.Styles||{DivSearch:"DivSearch",DivRow:"DivRow"},i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=this;this.GetRowList();var e=[];return e.push('<div class="'+this.Styles.DivSearch+'">'),e=e.concat(this.RowList.map(function(e){return t.GetRowHtml(e)})),e.push("</div>"),e.join("")}},{key:"GetRowHtml",value:function(t){var e=[];return e.push('<div class="'+this.Styles.DivRow+'"><ul>'),e=e.concat(t.Components.map(function(t){return"<li>"+t.GetHtml()+"</li>"})),e.push("</ul></div>"),e.join("")}},{key:"ExpandRowComponents",value:function(t,e){e===this.RowCount-1&&this.ButtonComponentList&&this.ButtonComponentList.length>0&&(t.Components=t.Components.concat(this.ButtonComponentList))}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.GridView=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Styles=i.Styles||{DivGridView:"DivGridView"},i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=[];return t.push('<div class="'+this.Styles.DivGridView+'">'),t.push(this.DataGridComponent.GetHtml()),this.DataPagingComponent&&t.push(this.DataPagingComponent.GetHtml()),t.push("</div>"),t.join("")}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.EditLayout=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Styles=i.Styles||{DivEdit:"DivEdit",DivRow:"DivRow"},i.Width=0,i.Height=0,i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=this;this.GetRowList();var e=[];return e.push('<div class="'+this.Styles.DivEdit+'">'),e=e.concat(this.RowList.map(function(e){return t.GetRowHtml(e)})),e.push("</div>"),e.join("")}},{key:"GetRowHtml",value:function(t){var e=[],i=0,n=0,a=t.ClassName?t.ClassName:this.Styles.DivRow;return e.push('<div class="'+a+'"><ul>'),t.Components.forEach(function(t){e.push("<li>"+t.GetHtml()+"</li>"),i+=t.Width,n=t.Height>n?t.Height:n}),this.Width=i>this.Width?i:this.Width,this.Height+=n,e.push("</ul></div>"),e.join("")}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.DataOperationLayout=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Styles=i.Styles||{DivOperation:"DivOperation"},i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=[];return t.push('<div class="'+this.Styles.DivOperation+'">'),t.push(this.OpeartionComponent.GetHtml()),t.push("</div>"),t.join("")}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.MenuLayout=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Styles=i.Styles||{DivLoginMenu:"DivLoginMenu"},i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=[];return t.push('<div class="'+this.Styles.DivLoginMenu+'">'),t.push(this.LoginComponent.GetHtml()),t.push(this.MenuComponent.GetHtml()),t.push("</div>"),t.join("")}}]),e}(e)}($ns),function(t){var e=t.layouts.Index;t.layouts.TableLayout=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.Styles=i.Styles||{DivTable:"DivTable"},i.Width=0,i.Height=0,i}return _inherits(e,t),_createClass(e,[{key:"GetHtml",value:function(){var t=this;this.GetRowList();var e=[];return e.push('<div class="'+this.Styles.DivTable+'">'),e.push('<table cellpadding="0" cellspacing="0" border="0" style="width:100%" id="'+this.Id+'"><tbody>'),e=e.concat(this.RowList.map(function(e){return t.GetRowHtml(e)})),e.push("</tbody></table></div>"),e.join("")}},{key:"GetRowHtml",value:function(t){var e=[];return e.push('<tr">'),t.Components.forEach(function(t){e.push(t.GetHtml())}),e.push("</tr>"),e.join("")}}]),e}(e)}($ns),function(t){var e=t.utils.Common,i=t.actions;i.SearchAction,i.NewAddActions;t.pages.Index=function(){function t(i){var n=this;_classCallCheck(this,t),this.Id=e.CreateGuid(),this.Entity={Properties:[]},i&&Object.assign(this,i),this.Styles=this.Styles||{HtmlPage:"HtmlPage"},this.InitEntity(),this.Entity.Properties.forEach(function(t){return n.InitProperty(t)}),this.KeyName=this.PageName+"_"+this.Entity.Id}return _createClass(t,[{key:"Load",value:function(){this.PageInit(),this.PageLoad()}},{key:"PageInit",value:function(){}},{key:"InitEntity",value:function(){this.Entity.Label=this.Entity.Label||this.Entity.Name,this.Entity.Id=this.Entity.Id||e.CreateGuid(),e.InitValue(this.Entity,["IsSelectKey"],!0)}},{key:"InitProperty",value:function(t){e.InitValue(t,["IsSearch"],void 0!==t.SearchOptions),e.InitValue(t,["IsData"],void 0!==t.DataOptions),e.InitValue(t,["IsEdit"],void 0!==t.EditOptions),e.InitValue(t,["IsVisible"],!0),t.Label=t.Label||t.Name}},{key:"PageLoad",value:function(){}}]),t}()}($ns),function(t){var e=t.utils,i=e.Common,n=e.HtmlTag,a=t.pages.Index,s=t.layouts,o=s.Search,r=s.GridView,u=s.DataOperationLayout,l=s.MenuLayout,h=s.TableLayout,c=t.components,d=c.Buttons,f=c.PropertyItem,p=c.DataGrid,v=c.DataPaging,g=t.actions,y=g.SearchAction,m=g.NewAddAction,C=g.ExcelExportAction,I=g.ExcelImportAction,D=g.LookOperationLogAction2,k=g.BatchDeleteAction,S=g.BatchSubmitAction,L=g.BatchRejectAction;t.pages.ListPage=function(e){function a(t){_classCallCheck(this,a);var e=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));e.Title=e.Title||e.Entity.Label+"列表",e.IsDialog||(document.title=e.Title);var n=["IsPage","IsBatchSubmit","IsBatchReject","IsBatchDelete","IsNewAdd","IsExcelExport","IsExcelImport","IsEdit","IsDelete2","IsDataRight","IsDataStatus","IsLookLog"];return i.InitValue(e,n,!0),e.PageSize=e.PageSize||20,e.IsDefault="Default"===e.Name,e}return _inherits(a,e),_createClass(a,[{key:"PageInit",value:function(){this.IsDialog||(this.QueryString=i.GetQueryString()),this.SetLoginUser(),t.data.Index.InitListPageEntityState(this.KeyName),this.IsDialog||(this.MenuLayout=new l(this.GetMenuComponents())),this.IsDefault||(this.Entity.ExpandPageInit&&this.Entity.ExpandPageInit.call(this,t),this.SearchProperties=this.Entity.Properties.filter(function(t){return t.IsSearch}).map(function(t){return Object.assign({},t,t.SearchOptions)}),this.DataProperties=this.Entity.Properties.filter(function(t){return t.IsData&&t.IsVisible}).map(function(t){return Object.assign({},t,t.DataOptions)}),this.SelectNames=this.Entity.Properties.filter(function(t){return t.IsData}).map(function(t){return t.Name}),this.SerachLayout=new o(this.GetSearchComponents()),this.GridViewLayout=new r(this.GetGridViewComponents()),this.DataOperationLayout=new u(this.GetOperationComponents()))}},{key:"SetLoginUser",value:function(){var t=i.GetStorage("LoginInfo");t?this.LoginUser=JSON.parse(t):i.ToLogin()}},{key:"GetMenuComponents",value:function(){return this.MenuComponent=new t.components.Menu({Page:this}),this.LoginComponent=new t.components.Login({Page:this}),{MenuComponent:this.MenuComponent,LoginComponent:this.LoginComponent}}},{key:"GetOperationComponents",value:function(){var t=this.IsExcelExport,e=this.IsExcelImport,i=this.IsDelete2,n=this.IsDataStatus,a=this.IsLookLog,s=this.IsBatchDelete,o=this.IsBatchSubmit,r=this.IsBatchReject;this.OpeartionActions=[];var u=this.LoginUser&&3===this.LoginUser.DataRight;return t&&this.OpeartionActions.push(new C(this)),e&&this.OpeartionActions.push(new I(this)),i&&s&&this.OpeartionActions.push(new k(this)),n&&o&&this.OpeartionActions.push(new S(this)),n&&r&&u&&this.OpeartionActions.push(new L(this)),a&&u&&this.OpeartionActions.push(new D(this)),this.OperationButtonsComponent=new d({Actions:this.OpeartionActions}),{OpeartionComponent:this.OperationButtonsComponent}}},{key:"GetOrderByList",value:function(){return this.Entity.OrderByList?this.Entity.OrderByList:[{Name:"CreateDate",IsDesc:!0}]}},{key:"GetIsCheckBox",value:function(){if(void 0!==this.IsCheckBox)return this.IsCheckBox;if(!this.IsDelete2&&!this.IsDataStatus)return!1;var t=!1;return t=this.IsDelete2&&this.IsBatchDelete,t||(t=this.IsDataStatus&&(this.IsBatchReject||this.IsBatchSubmit)),t}},{key:"GetGridViewComponents",value:function(){return this.DataGridComponent=new p({Entity:this.Entity,Properties:this.DataProperties,KeyName:this.KeyName,IsEdit:this.IsEdit,IsDelete:this.IsDelete2,IsDataRight:this.IsDataRight,IsDataStatus:this.IsDataStatus,IsLookLog:this.IsLookLog,LoginUser:this.LoginUser,IsCheckBox:this.GetIsCheckBox(),IsFixedWidth:this.IsFixedWidth}),this.IsDialog&&this.GridWidth&&(this.DataGridComponent.Width=this.GridWidth,this.DataGridComponent.Height=this.GridHeight),this.DataPagingComponent=new v({KeyName:this.KeyName,PageSize:this.PageSize,IsPage:this.IsPage,SearchAction:this.SearchActions[0]}),{DataGridComponent:this.DataGridComponent,DataPagingComponent:this.DataPagingComponent}}},{key:"GetSearchComponents",value:function(){var t=this;return this.SearchButtonsComponent=new d({Actions:this.GetSearchActions()}),this.SearchComponents=this.SearchProperties.filter(function(t){return t.IsVisible}).map(function(e){return new f({Property:e,EnterControl:t.SearchButtonsComponent.ControlList[0]})}),{ComponentList:this.SearchComponents,ButtonComponentList:[this.SearchButtonsComponent]}}},{key:"GetSearchActions",value:function(){return this.SearchActions=[],this.SearchActions.push(new y(this)),this.IsNewAdd&&this.SearchActions.push(new m(this)),this.SearchActions}},{key:"PageLoad",value:function(){n.SetHtml(document.body,this.GetHtml()),this.EventLoad(),this.DataLoad(),this.SearchActions&&this.SearchActions[0].Invoke()}},{key:"GetHtml",value:function(){var t=[];return t.push('<div class="'+this.Styles.HtmlPage+'">'),this.MenuLayout&&t.push(this.MenuLayout.GetHtml()),this.IsDefault?t.push('<div id="divDefault_'+this.Id+'"></div>'):(t.push(this.SerachLayout.GetHtml()),this.OpeartionActions.length>0&&t.push(this.DataOperationLayout.GetHtml()),t.push(this.GridViewLayout.GetHtml())),t.push("</div>"),t.join("")}},{key:"EventLoad",value:function(){this.MenuComponent&&this.MenuComponent.EventLoad(),this.LoginComponent&&this.LoginComponent.EventLoad(),this.IsDefault||(this.SearchComponents.forEach(function(t){return t.EventLoad()}),this.SearchButtonsComponent.EventLoad(),this.DataGridComponent.EventLoad(),this.DataPagingComponent&&this.DataPagingComponent.EventLoad(),this.SearchActions[0].InitConditionList=this.GetSearchCondition(),this.OpeartionActions.length>0&&this.OperationButtonsComponent.EventLoad())}},{key:"DataLoad",value:function(){if(this.MenuComponent&&this.MenuComponent.DataLoad(),this.LoginComponent&&this.LoginComponent.DataLoad(),this.IsDefault)return void this.SetDefaultHtml();this.SearchComponents.forEach(function(t){return t.DataLoad()}),this.SearchButtonsComponent.DataLoad(),this.DataGridComponent.DataLoad(),this.DataPagingComponent&&this.DataPagingComponent.DataLoad(),this.OpeartionActions.length>0&&this.OperationButtonsComponent.DataLoad()}},{key:"SetDefaultHtml",value:function(){var e=this;t.data.Cache.GetDataList("首页配置","默认页",["属性名","属性值","行位置","列位置"],[]).then(function(t){if(null!=t){var i=n.GetById("divDefault_"+e.Id);n.SetHtml(i,e.GetDefaultHtml(t)),e.DefaultPropertyComponents.forEach(function(t){t.EventLoad(),t.DataLoad()})}})}},{key:"GetDefaultHtml",value:function(t){var e=this,i=t.map(function(t){return{Name:t["属性名"],Label:t["属性名"],ControlType:"SpanText",IsWidth:!1,DefaultValue:t["属性值"],X:t["行位置"],Y:t["列位置"]}});return this.DefaultPropertyComponents=i.map(function(t){return new f({Property:t,IsTd:!0,Page:e})}),this.DefaultPageTableLayout=new h({ComponentList:this.DefaultPropertyComponents}),this.DefaultPageTableLayout.GetHtml()}},{key:"GetSearchCondition",value:function(){for(var t=[],e=!0,n="",a=null,s=0;s<this.SearchComponents.length;s++){if(a=this.SearchComponents[s],n=a.GetValue(),!1===a.Validate(n,!1)){e=!1;break}i.IsNullOrEmpty(n)||t.push({Name:a.Property.Name,Logic:a.Property.Logic||"=",Value:a.GetValue()||""})}return!!e&&(this.SearchProperties.filter(function(t){return!t.IsVisible}).forEach(function(e){t.push({Name:e.Name,Logic:e.Logic||"=",Value:e.DefaultValue||""})}),t)}},{key:"SetInitConditionList",value:function(t){var e={};t.forEach(function(t){return e[t.Name]=t.Value});var i="";this.SearchComponents.forEach(function(t){i=void 0===e[t.Property.Name]?"":e[t.Property.Name],t.SetValue(i)})}},{key:"GetHeaderInfoList",value:function(){return this.DataProperties.map(function(t){return{Name:t.Name,Label:t.Label}})}},{key:"GetDataGridCheckedValue",value:function(){return this.DataGridComponent.GetCheckedValue()}}]),a}(a)}($ns),function(t){var e=t.pages.Index,i=t.utils.Common,n=t.components,a=n.PropertyItem,s=(n.Dialog,t.layouts.EditLayout),o=t.actions,r=o.CreateAction,u=o.UpdateAction;t.pages.EditPage=function(e){function n(t){_classCallCheck(this,n),t.PageName=t.PageName||"EditPage";var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return i.InitValue(e,["IsDialog"],!0),e.Title=e.Title||(e.IsUpdate?e.IsLook?"查看":"修改":"新增")+e.Entity.Label,e.Styles.EditPage=e.Styles.EditPage||"EditPage",e}return _inherits(n,e),_createClass(n,[{key:"PageInit",value:function(){t.data.Index.InitEditPageEntityState(this.KeyName),this.Entity.ExpandPageInit&&this.Entity.ExpandPageInit.call(this,t),this.EditProperties=this.Entity.Properties.filter(function(t){return t.IsEdit}).map(function(t){return Object.assign({IsVisible:!0},t,t.EditOptions)}),this.EditLayout=new s(this.GetEditComponents()),this.IndexAction=new t.actions.Index(this)}},{key:"GetEditComponents",value:function(){var t=this;return this.EditComponents=this.EditProperties.filter(function(t){return t.IsVisible}).map(function(e){return new a({Property:e,Page:t})}),{ComponentList:this.EditComponents}}},{key:"PageLoad",value:function(){if(this.IsDialog){var e=this.GetHtml(),i=this.Width>0?this.Width:this.EditLayout.Width,n=this.Height>0?this.Height:this.EditLayout.Height;this.EditDialog=new t.components.Dialog({Width:i,Height:n,Html:e,Title:this.Title,IsOkButton:!this.IsLook,OkAction:this.IsUpdate?new u(this):new r(this)}),this.OkAction&&(this.EditDialog.OkAction=this.OkAction),this.IsDataStatus&&!this.IsLook&&(this.EditDialog.Actions=this.GetDialogActions(this.EditDialog)),this.EditDialog.Show()}else HtmlTag.SetHtml(document.body,this.GetHtml());this.EventLoad(),this.DataLoad()}},{key:"GetDialogActions",value:function(e){var i=[];return i.push(new t.actions.DialogSaveAction(e)),i.push(new t.actions.DialogSubmitAction(e)),i.push(new t.actions.DialogCancelAction(e)),i}},{key:"GetHtml",value:function(){var t=[];return t.push('<div class="'+this.Styles.EditPage+'">'),t.push(this.EditLayout.GetHtml()),t.push("</div>"),t.join("")}},{key:"EventLoad",value:function(){this.EditComponents.forEach(function(t){return t.EventLoad()})}},{key:"DataLoad",value:function(){var t=this;this.EditComponents.forEach(function(t){return t.DataLoad()}),this.IsUpdate&&(this.IsLocalData?(this.Entity.EntityData=this.RowData,this.EditComponents.forEach(function(e){return e.SetValue(t.RowData[e.Property.Name])})):this.GetEntityData())}},{key:"GetEntityData",value:function(){var e=this;this.IndexAction.GetEntityData(this.Entity,this.EditProperties.map(function(t){return t.Name}),this.RowData[this.Entity.PrimaryKey]).then(function(n){if(n.IsSuccess){var a=i.ArrayFirst(n.Data.DataList);a&&(e.EntityData=a,e.Entity.EntityData=a,e.Entity.ExpandGetEditData&&e.Entity.ExpandGetEditData.call(e,a,t),e.EditComponents.forEach(function(t){return t.SetValue(a[t.Property.Name])}))}else i.Alert(n.Message)})}},{key:"GetEditData",value:function(){var e={};this.IsUpdate&&(e[this.Entity.PrimaryKey]=this.RowData[this.Entity.PrimaryKey],e.RowVersion=this.RowData.RowVersion);for(var n=!0,a="",s=null,o=0;o<this.EditComponents.length;o++){if(s=this.EditComponents[o],a=s.GetValue(),!1===s.Validate(a)){n=!1;break}i.IsNullOrEmpty(a)?this.IsUpdate&&!s.IsPassword&&(e[s.Property.Name]=null):e[s.Property.Name]=a}return!!n&&(this.Entity.ExpandSetEditData&&(e=this.Entity.ExpandSetEditData.call(this,e,this.IsUpdate,t)),!1!==e&&(!(this.IsUpdate&&!this.IsLocalData&&this.CompareValueEquals(e))&&e))}},{key:"CompareValueEquals",value:function(t){if(!this.EntityData)return!1;var e=!0;for(var n in t)if(n!=this.Entity.PrimaryKey&&"RowVersion"!=n&&!i.IsEquals(this.EntityData[n],t[n])){e=!1;break}return e&&i.Alert("对不起，您未对信息进行编辑！"),e}},{key:"ClearControlValue",value:function(){this.EditComponents.forEach(function(t){return t.SetValue("")})}},{key:"GetDataGridComponent",value:function(t){var e=this.EditComponents.filter(function(e){return e.Property.Name===t});return 0===e.length?null:e[0].ControlList[1].DataGridComponent}}]),n}(e)}($ns),function(t){var e=t.utils,i=(e.Common,e.HtmlTag,t.pages.ListPage),n=t.layouts,a=(n.Search,n.GridView,t.components);a.Buttons,a.PropertyItem,a.DataGrid,a.DataPaging,t.actions.SearchAction;t.pages.DialogListPage=function(e){function i(t){return _classCallCheck(this,i),t.PageName="DialogListPage",t.IsDialog=!0,t.IsNewAdd=!1,t.IsExcelExport=!1,t.IsExcelImport=!1,t.IsEdit=!1,t.IsDelete2=!1,t.IsDataRight=!1,t.IsDataStatus=!1,t.IsLookLog=!1,t.IsFixedWidth=!0,_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return _inherits(i,e),_createClass(i,[{key:"PageLoad",value:function(){this.ListDialog=new t.components.Dialog({Width:this.Width,Height:this.Height,Html:this.GetHtml(),Title:this.Title,IsOkButton:void 0!==this.OkAction,OkAction:this.OkAction}),this.ListDialog.Show(),this.EventLoad(),this.DataLoad(),this.SearchActions&&this.SearchActions[0].Invoke()}}]),i}(i)}($ns);