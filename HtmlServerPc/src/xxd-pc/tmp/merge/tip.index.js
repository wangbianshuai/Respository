define(["base"],function(t){function a(a){var o=a.self,e=a.formatCallback,r=a.cache,l=t(o);this._hash||(this._hash={});var c={self:o,$content:t("<div id='J_calculatorTipToolTip' class='mui-calculator-tip-tooltip clearfix'><div class='mui-calculator-tip-arrow mui-calculator-tip-arrowTop'><div class='mui-calculator-tip-arrowIn'></div></div><div class='mui-calculator-tip-block'></div></div>"),showCall:a.showCall||void 0,hideCall:a.hideCall||void 0},n=l.attr("tipContent"),s=l.attr("dataUrl");if(n){var u=l.attr("_tipDate");if(u){var d=this._hash,f=d[l.attr("_tipDate")];if(f){if(c.$content=t("#"+f),!r&&e){var p=e(n,l);c.$content.find(".mui-calculator-tip-block").html(p)}i(c)}else t.log("dom is error")}else{var d=this._hash,u=(new Date).getTime();d[u]="J_calculatorTipToolTip"+u,l.attr("_tipDate",u);var p="";p=e?e(n,l):n,c.$content.attr("id",d[u]).find(".mui-calculator-tip-block").html(p),i(c)}}else if(s){var d=this._hash,f=d[s];if(f&&r)c.$content=t("#"+f),i(c);else{var h=l.attr("tipType");if("jsonp"==h)t.ajax({dataType:"jsonp",url:s,jsonp:"jsonpcallback",success:function(t){if(200==t.status){var a=e(t.data);d[s]="J_calculatorTipToolTip"+(new Date).getTime(),c.$content.attr("id",d[s]).find(".mui-calculator-tip-block").html(a),i(c)}}});else{"get"!=h&&"post"!=h&&(h="get");var v=l.attr("dataType")||"json";t.ajax({type:h,dataType:v,url:s,success:function(t){var a="";if("json"!=v)a=t;else{if(200!=t.status)return;a=t.data}var o=e(a,l);d[s]="J_calculatorTipToolTip"+(new Date).getTime(),c.$content.attr("id",d[s]).find(".mui-calculator-tip-block").html(o),i(c)}})}}}else t.log("params is error , tipContent or dataUrl must choose a parameter ")}var o={fnMouseTip:function(a,o,i,e){var r=t(o),l=this;if(t(a).on("mouseover",function(){l.fnTip(params)}),e){r.find(".close").addClass("hide"),e()}},fnTip:function(a,o,i,e){function r(i){var n=i||window.event,s=n.target,u=c.attr("id"),d=t(s).attr("id");("false"===l||d!=u&&!o.contains(s))&&(t(a).attr("id")==u||a.contains(s)||(e&&e(),c.hide(),t(document).unbind("mousemove",r)))}var i=i||void 0,e=e||void 0,l=a.getAttribute("overTipShow")||void 0,c=t(o);c.show(),i&&i(),t(document).on("mousemove",r)},loadTpl:function(a,o){var i=t.ajax({url:a,async:!1});if(4==i.readyState)return i.responseData}},i=function(a){function i(){var t=0;(j<=20||C<=20)&&(t=20),C>=W&&j>=W||_<b?(H=h-W,J=L-10):C>=j&&C>=W?(H=h-b+j+N+t,J=b-j-10-t):(H=h-C-t,J=C+N-10+t)}function e(){var t=0;(y<=20||D<=20)&&(t=20),y>=M&&D>=M||$<k?(S=v-M,x=U-10):y>D&&y>=M?(S=v-k+D+A+t,x=k-D-10-t):(S=v-y-t,x=y+A-10+t)}function r(){I="mui-calculator-tip-arrow-right",x=k-12,S=v-k,i()}function l(){I="mui-calculator-tip-arrow-left",x=0,S=v+T,i()}function c(){I="mui-calculator-tip-arrow-down",J=b-12,H=h-b,e()}function n(){I="mui-calculator-tip-arrow-top",J=0,H=h+m,e()}var s=a.self,u=a.$content,d=a.showCall,f=a.hideCall;$self=t(s),contentId=u.attr("id"),checkNode=t("#"+contentId),checkNode.length?u=checkNode:t("body").append(u);var p=$self.offset(),h=p.top,v=p.left,m=$self.outerHeight(),T=$self.outerWidth(),w=t(document);_docScrollTop=w.scrollTop(),_docScrollLeft=w.scrollLeft(),_docHeight=w.outerHeight();var g=t(window),_=g.outerHeight(),$=g.outerWidth(),b=u.outerHeight(),k=u.outerWidth(),C=h-_docScrollTop,j=_-C-m,y=v-_docScrollLeft,D=$-y-T,S=0,H=0,x=0,J=0,I="mui-calculator-tip-arrow-down",L=b/2,N=m/2,W=L-N,U=k/2,A=T/2,M=U-A,q=$self.attr("position");"left"==q?r():"right"==q?l():"top"==q?c():"bottom"==q?n():"slide"==q?function(){y>D?r():l()}():"fluctuate"==q?function(){C>j?c():n()}():function(){for(var t=[c,l,n,r],a=[C,D,j,y],o=0,i=a[0],e=1,s=a.length;e<s;e++)i<a[e]&&(i=a[e],o=e);t[o]()}(),u.css({left:S,top:H}),u.find(".mui-calculator-tip-arrow").css({left:x,top:J}).attr("class","mui-calculator-tip-arrow "+I);var z=u[0];o.fnTip(s,z,d,f)};return{init:a,manual:i}});